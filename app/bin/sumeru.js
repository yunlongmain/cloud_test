function BigInteger(e,t,n){null!=e&&("number"==typeof e?this.fromNumber(e,t,n):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function nbi(){return new BigInteger(null)}function am1(e,t,n,r,i,o){for(;--o>=0;){var s=t*this[e++]+n[r]+i;i=Math.floor(s/67108864),n[r++]=67108863&s}return i}function am2(e,t,n,r,i,o){for(var s=32767&t,a=t>>15;--o>=0;){var u=32767&this[e],l=this[e++]>>15,c=a*u+l*s;u=s*u+((32767&c)<<15)+n[r]+(1073741823&i),i=(u>>>30)+(c>>>15)+a*l+(i>>>30),n[r++]=1073741823&u}return i}function am3(e,t,n,r,i,o){for(var s=16383&t,a=t>>14;--o>=0;){var u=16383&this[e],l=this[e++]>>14,c=a*u+l*s;u=s*u+((16383&c)<<14)+n[r]+i,i=(u>>28)+(c>>14)+a*l,n[r++]=268435455&u}return i}function int2char(e){return BI_RM.charAt(e)}function intAt(e,t){var n=BI_RC[e.charCodeAt(t)];return null==n?-1:n}function bnpCopyTo(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s}function bnpFromInt(e){this.t=1,this.s=0>e?-1:0,e>0?this[0]=e:-1>e?this[0]=e+DV:this.t=0}function nbv(e){var t=nbi();return t.fromInt(e),t}function bnpFromString(e,t){var n;if(16==t)n=4;else if(8==t)n=3;else if(256==t)n=8;else if(2==t)n=1;else if(32==t)n=5;else{if(4!=t)return this.fromRadix(e,t),void 0;n=2}this.t=0,this.s=0;for(var r=e.length,i=!1,o=0;--r>=0;){var s=8==n?255&e[r]:intAt(e,r);0>s?"-"==e.charAt(r)&&(i=!0):(i=!1,0==o?this[this.t++]=s:o+n>this.DB?(this[this.t-1]|=(s&(1<<this.DB-o)-1)<<o,this[this.t++]=s>>this.DB-o):this[this.t-1]|=s<<o,o+=n,o>=this.DB&&(o-=this.DB))}8==n&&0!=(128&e[0])&&(this.s=-1,o>0&&(this[this.t-1]|=(1<<this.DB-o)-1<<o)),this.clamp(),i&&BigInteger.ZERO.subTo(this,this)}function bnpClamp(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t}function bnToString(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var n,r=(1<<t)-1,i=!1,o="",s=this.t,a=this.DB-s*this.DB%t;if(s-->0)for(a<this.DB&&(n=this[s]>>a)>0&&(i=!0,o=int2char(n));s>=0;)t>a?(n=(this[s]&(1<<a)-1)<<t-a,n|=this[--s]>>(a+=this.DB-t)):(n=this[s]>>(a-=t)&r,0>=a&&(a+=this.DB,--s)),n>0&&(i=!0),i&&(o+=int2char(n));return i?o:"0"}function bnNegate(){var e=nbi();return BigInteger.ZERO.subTo(this,e),e}function bnAbs(){return this.s<0?this.negate():this}function bnCompareTo(e){var t=this.s-e.s;if(0!=t)return t;var n=this.t;if(t=n-e.t,0!=t)return this.s<0?-t:t;for(;--n>=0;)if(0!=(t=this[n]-e[n]))return t;return 0}function nbits(e){var t,n=1;return 0!=(t=e>>>16)&&(e=t,n+=16),0!=(t=e>>8)&&(e=t,n+=8),0!=(t=e>>4)&&(e=t,n+=4),0!=(t=e>>2)&&(e=t,n+=2),0!=(t=e>>1)&&(e=t,n+=1),n}function bnBitLength(){return this.t<=0?0:this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)}function bnpDLShiftTo(e,t){var n;for(n=this.t-1;n>=0;--n)t[n+e]=this[n];for(n=e-1;n>=0;--n)t[n]=0;t.t=this.t+e,t.s=this.s}function bnpDRShiftTo(e,t){for(var n=e;n<this.t;++n)t[n-e]=this[n];t.t=Math.max(this.t-e,0),t.s=this.s}function bnpLShiftTo(e,t){var n,r=e%this.DB,i=this.DB-r,o=(1<<i)-1,s=Math.floor(e/this.DB),a=this.s<<r&this.DM;for(n=this.t-1;n>=0;--n)t[n+s+1]=this[n]>>i|a,a=(this[n]&o)<<r;for(n=s-1;n>=0;--n)t[n]=0;t[s]=a,t.t=this.t+s+1,t.s=this.s,t.clamp()}function bnpRShiftTo(e,t){t.s=this.s;var n=Math.floor(e/this.DB);if(n>=this.t)return t.t=0,void 0;var r=e%this.DB,i=this.DB-r,o=(1<<r)-1;t[0]=this[n]>>r;for(var s=n+1;s<this.t;++s)t[s-n-1]|=(this[s]&o)<<i,t[s-n]=this[s]>>r;r>0&&(t[this.t-n-1]|=(this.s&o)<<i),t.t=this.t-n,t.clamp()}function bnpSubTo(e,t){for(var n=0,r=0,i=Math.min(e.t,this.t);i>n;)r+=this[n]-e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r-=e.s;n<this.t;)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<e.t;)r-=e[n],t[n++]=r&this.DM,r>>=this.DB;r-=e.s}t.s=0>r?-1:0,-1>r?t[n++]=this.DV+r:r>0&&(t[n++]=r),t.t=n,t.clamp()}function bnpMultiplyTo(e,t){var n=this.abs(),r=e.abs(),i=n.t;for(t.t=i+r.t;--i>=0;)t[i]=0;for(i=0;i<r.t;++i)t[i+n.t]=n.am(0,r[i],t,i,0,n.t);t.s=0,t.clamp(),this.s!=e.s&&BigInteger.ZERO.subTo(t,t)}function bnpSquareTo(e){for(var t=this.abs(),n=e.t=2*t.t;--n>=0;)e[n]=0;for(n=0;n<t.t-1;++n){var r=t.am(n,t[n],e,2*n,0,1);(e[n+t.t]+=t.am(n+1,2*t[n],e,2*n+1,r,t.t-n-1))>=t.DV&&(e[n+t.t]-=t.DV,e[n+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(n,t[n],e,2*n,0,1)),e.s=0,e.clamp()}function bnpDivRemTo(e,t,n){var r=e.abs();if(!(r.t<=0)){var i=this.abs();if(i.t<r.t)return null!=t&&t.fromInt(0),null!=n&&this.copyTo(n),void 0;null==n&&(n=nbi());var o=nbi(),s=this.s,a=e.s,u=this.DB-nbits(r[r.t-1]);u>0?(r.lShiftTo(u,o),i.lShiftTo(u,n)):(r.copyTo(o),i.copyTo(n));var l=o.t,c=o[l-1];if(0!=c){var f=c*(1<<this.F1)+(l>1?o[l-2]>>this.F2:0),p=this.FV/f,d=(1<<this.F1)/f,h=1<<this.F2,g=n.t,_=g-l,m=null==t?nbi():t;for(o.dlShiftTo(_,m),n.compareTo(m)>=0&&(n[n.t++]=1,n.subTo(m,n)),BigInteger.ONE.dlShiftTo(l,m),m.subTo(o,o);o.t<l;)o[o.t++]=0;for(;--_>=0;){var v=n[--g]==c?this.DM:Math.floor(n[g]*p+(n[g-1]+h)*d);if((n[g]+=o.am(0,v,n,_,0,l))<v)for(o.dlShiftTo(_,m),n.subTo(m,n);n[g]<--v;)n.subTo(m,n)}null!=t&&(n.drShiftTo(l,t),s!=a&&BigInteger.ZERO.subTo(t,t)),n.t=l,n.clamp(),u>0&&n.rShiftTo(u,n),0>s&&BigInteger.ZERO.subTo(n,n)}}}function bnMod(e){var t=nbi();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(BigInteger.ZERO)>0&&e.subTo(t,t),t}function Classic(e){this.m=e}function cConvert(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e}function cRevert(e){return e}function cReduce(e){e.divRemTo(this.m,null,e)}function cMulTo(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function cSqrTo(e,t){e.squareTo(t),this.reduce(t)}function bnpInvDigit(){if(this.t<1)return 0;var e=this[0];if(0==(1&e))return 0;var t=3&e;return t=15&t*(2-(15&e)*t),t=255&t*(2-(255&e)*t),t=65535&t*(2-(65535&(65535&e)*t)),t=t*(2-e*t%this.DV)%this.DV,t>0?this.DV-t:-t}function Montgomery(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function montConvert(e){var t=nbi();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(BigInteger.ZERO)>0&&this.m.subTo(t,t),t}function montRevert(e){var t=nbi();return e.copyTo(t),this.reduce(t),t}function montReduce(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var n=32767&e[t],r=n*this.mpl+((n*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(n=t+this.m.t,e[n]+=this.m.am(0,r,e,t,0,this.m.t);e[n]>=e.DV;)e[n]-=e.DV,e[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function montSqrTo(e,t){e.squareTo(t),this.reduce(t)}function montMulTo(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function bnpIsEven(){return 0==(this.t>0?1&this[0]:this.s)}function bnpExp(e,t){if(e>4294967295||1>e)return BigInteger.ONE;var n=nbi(),r=nbi(),i=t.convert(this),o=nbits(e)-1;for(i.copyTo(n);--o>=0;)if(t.sqrTo(n,r),(e&1<<o)>0)t.mulTo(r,i,n);else{var s=n;n=r,r=s}return t.revert(n)}function bnModPowInt(e,t){var n;return n=256>e||t.isEven()?new Classic(t):new Montgomery(t),this.exp(e,n)}function Arcfour(){this.i=0,this.j=0,this.S=new Array}function ARC4init(e){var t,n,r;for(t=0;256>t;++t)this.S[t]=t;for(n=0,t=0;256>t;++t)n=255&n+this.S[t]+e[t%e.length],r=this.S[t],this.S[t]=this.S[n],this.S[n]=r;this.i=0,this.j=0}function ARC4next(){var e;return this.i=255&this.i+1,this.j=255&this.j+this.S[this.i],e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[255&e+this.S[this.i]]}function prng_newstate(){return new Arcfour}function rng_seed_int(e){rng_pool[rng_pptr++]^=255&e,rng_pool[rng_pptr++]^=255&e>>8,rng_pool[rng_pptr++]^=255&e>>16,rng_pool[rng_pptr++]^=255&e>>24,rng_pptr>=rng_psize&&(rng_pptr-=rng_psize)}function rng_seed_time(){rng_seed_int((new Date).getTime())}function rng_get_byte(){if(null==rng_state){for(rng_seed_time(),rng_state=prng_newstate(),rng_state.init(rng_pool),rng_pptr=0;rng_pptr<rng_pool.length;++rng_pptr)rng_pool[rng_pptr]=0;rng_pptr=0}return rng_state.next()}function rng_get_bytes(e){var t;for(t=0;t<e.length;++t)e[t]=rng_get_byte()}function SecureRandom(){}function parseBigInt(e,t){return new BigInteger(e,t)}function linebrk(e,t){for(var n="",r=0;r+t<e.length;)n+=e.substring(r,r+t)+"\n",r+=t;return n+e.substring(r,e.length)}function byte2Hex(e){return 16>e?"0"+e.toString(16):e.toString(16)}function pkcs1pad2(e,t){if(t<e.length+11)return console.log("Message too long for RSA"),null;for(var n=new Array,r=e.length-1;r>=0&&t>0;){var i=e.charCodeAt(r--);128>i?n[--t]=i:i>127&&2048>i?(n[--t]=128|63&i,n[--t]=192|i>>6):(n[--t]=128|63&i,n[--t]=128|63&i>>6,n[--t]=224|i>>12)}n[--t]=0;for(var o=new SecureRandom,s=new Array;t>2;){for(s[0]=0;0==s[0];)o.nextBytes(s);n[--t]=s[0]}return n[--t]=2,n[--t]=0,new BigInteger(n)}function RSAKey(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function RSASetPublic(e,t){null!=e&&null!=t&&e.length>0&&t.length>0?(this.n=parseBigInt(e,16),this.e=parseInt(t,16)):console.log("Invalid RSA public key")}function RSADoPublic(e){return e.modPowInt(this.e,this.n)}function RSAEncrypt(e){var t=pkcs1pad2(e,this.n.bitLength()+7>>3);if(null==t)return null;var n=this.doPublic(t);if(null==n)return null;var r=n.toString(16);return 0==(1&r.length)?r:"0"+r}function bnClone(){var e=nbi();return this.copyTo(e),e}function bnIntValue(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function bnByteValue(){return 0==this.t?this.s:this[0]<<24>>24}function bnShortValue(){return 0==this.t?this.s:this[0]<<16>>16}function bnpChunkSize(e){return Math.floor(Math.LN2*this.DB/Math.log(e))}function bnSigNum(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1}function bnpToRadix(e){if(null==e&&(e=10),0==this.signum()||2>e||e>36)return"0";var t=this.chunkSize(e),n=Math.pow(e,t),r=nbv(n),i=nbi(),o=nbi(),s="";for(this.divRemTo(r,i,o);i.signum()>0;)s=(n+o.intValue()).toString(e).substr(1)+s,i.divRemTo(r,i,o);return o.intValue().toString(e)+s}function bnpFromRadix(e,t){this.fromInt(0),null==t&&(t=10);for(var n=this.chunkSize(t),r=Math.pow(t,n),i=!1,o=0,s=0,a=0;a<e.length;++a){var u=intAt(e,a);0>u?"-"==e.charAt(a)&&0==this.signum()&&(i=!0):(s=t*s+u,++o>=n&&(this.dMultiply(r),this.dAddOffset(s,0),o=0,s=0))}o>0&&(this.dMultiply(Math.pow(t,o)),this.dAddOffset(s,0)),i&&BigInteger.ZERO.subTo(this,this)}function bnpFromNumber(e,t,n){if("number"==typeof t)if(2>e)this.fromInt(1);else for(this.fromNumber(e,n),this.testBit(e-1)||this.bitwiseTo(BigInteger.ONE.shiftLeft(e-1),op_or,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(BigInteger.ONE.shiftLeft(e-1),this);else{var r=new Array,i=7&e;r.length=(e>>3)+1,t.nextBytes(r),i>0?r[0]&=(1<<i)-1:r[0]=0,this.fromString(r,256)}}function bnToByteArray(){var e=this.t,t=new Array;t[0]=this.s;var n,r=this.DB-e*this.DB%8,i=0;if(e-->0)for(r<this.DB&&(n=this[e]>>r)!=(this.s&this.DM)>>r&&(t[i++]=n|this.s<<this.DB-r);e>=0;)8>r?(n=(this[e]&(1<<r)-1)<<8-r,n|=this[--e]>>(r+=this.DB-8)):(n=255&this[e]>>(r-=8),0>=r&&(r+=this.DB,--e)),0!=(128&n)&&(n|=-256),0==i&&(128&this.s)!=(128&n)&&++i,(i>0||n!=this.s)&&(t[i++]=n);return t}function bnEquals(e){return 0==this.compareTo(e)}function bnMin(e){return this.compareTo(e)<0?this:e}function bnMax(e){return this.compareTo(e)>0?this:e}function bnpBitwiseTo(e,t,n){var r,i,o=Math.min(e.t,this.t);for(r=0;o>r;++r)n[r]=t(this[r],e[r]);if(e.t<this.t){for(i=e.s&this.DM,r=o;r<this.t;++r)n[r]=t(this[r],i);n.t=this.t}else{for(i=this.s&this.DM,r=o;r<e.t;++r)n[r]=t(i,e[r]);n.t=e.t}n.s=t(this.s,e.s),n.clamp()}function op_and(e,t){return e&t}function bnAnd(e){var t=nbi();return this.bitwiseTo(e,op_and,t),t}function op_or(e,t){return e|t}function bnOr(e){var t=nbi();return this.bitwiseTo(e,op_or,t),t}function op_xor(e,t){return e^t}function bnXor(e){var t=nbi();return this.bitwiseTo(e,op_xor,t),t}function op_andnot(e,t){return e&~t}function bnAndNot(e){var t=nbi();return this.bitwiseTo(e,op_andnot,t),t}function bnNot(){for(var e=nbi(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e}function bnShiftLeft(e){var t=nbi();return 0>e?this.rShiftTo(-e,t):this.lShiftTo(e,t),t}function bnShiftRight(e){var t=nbi();return 0>e?this.lShiftTo(-e,t):this.rShiftTo(e,t),t}function lbit(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function bnGetLowestSetBit(){for(var e=0;e<this.t;++e)if(0!=this[e])return e*this.DB+lbit(this[e]);return this.s<0?this.t*this.DB:-1}function cbit(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function bnBitCount(){for(var e=0,t=this.s&this.DM,n=0;n<this.t;++n)e+=cbit(this[n]^t);return e}function bnTestBit(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<e%this.DB)}function bnpChangeBit(e,t){var n=BigInteger.ONE.shiftLeft(e);return this.bitwiseTo(n,t,n),n}function bnSetBit(e){return this.changeBit(e,op_or)}function bnClearBit(e){return this.changeBit(e,op_andnot)}function bnFlipBit(e){return this.changeBit(e,op_xor)}function bnpAddTo(e,t){for(var n=0,r=0,i=Math.min(e.t,this.t);i>n;)r+=this[n]+e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r+=e.s;n<this.t;)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<e.t;)r+=e[n],t[n++]=r&this.DM,r>>=this.DB;r+=e.s}t.s=0>r?-1:0,r>0?t[n++]=r:-1>r&&(t[n++]=this.DV+r),t.t=n,t.clamp()}function bnAdd(e){var t=nbi();return this.addTo(e,t),t}function bnSubtract(e){var t=nbi();return this.subTo(e,t),t}function bnMultiply(e){var t=nbi();return this.multiplyTo(e,t),t}function bnSquare(){var e=nbi();return this.squareTo(e),e}function bnDivide(e){var t=nbi();return this.divRemTo(e,t,null),t}function bnRemainder(e){var t=nbi();return this.divRemTo(e,null,t),t}function bnDivideAndRemainder(e){var t=nbi(),n=nbi();return this.divRemTo(e,t,n),new Array(t,n)}function bnpDMultiply(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()}function bnpDAddOffset(e,t){if(0!=e){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=e;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}}function NullExp(){}function nNop(e){return e}function nMulTo(e,t,n){e.multiplyTo(t,n)}function nSqrTo(e,t){e.squareTo(t)}function bnPow(e){return this.exp(e,new NullExp)}function bnpMultiplyLowerTo(e,t,n){var r=Math.min(this.t+e.t,t);for(n.s=0,n.t=r;r>0;)n[--r]=0;var i;for(i=n.t-this.t;i>r;++r)n[r+this.t]=this.am(0,e[r],n,r,0,this.t);for(i=Math.min(e.t,t);i>r;++r)this.am(0,e[r],n,r,0,t-r);n.clamp()}function bnpMultiplyUpperTo(e,t,n){--t;var r=n.t=this.t+e.t-t;for(n.s=0;--r>=0;)n[r]=0;for(r=Math.max(t-this.t,0);r<e.t;++r)n[this.t+r-t]=this.am(t-r,e[r],n,0,0,this.t+r-t);n.clamp(),n.drShiftTo(1,n)}function Barrett(e){this.r2=nbi(),this.q3=nbi(),BigInteger.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}function barrettConvert(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=nbi();return e.copyTo(t),this.reduce(t),t}function barrettRevert(e){return e}function barrettReduce(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)}function barrettSqrTo(e,t){e.squareTo(t),this.reduce(t)}function barrettMulTo(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function bnModPow(e,t){var n,r,i=e.bitLength(),o=nbv(1);if(0>=i)return o;n=18>i?1:48>i?3:144>i?4:768>i?5:6,r=8>i?new Classic(t):t.isEven()?new Barrett(t):new Montgomery(t);var s=new Array,a=3,u=n-1,l=(1<<n)-1;if(s[1]=r.convert(this),n>1){var c=nbi();for(r.sqrTo(s[1],c);l>=a;)s[a]=nbi(),r.mulTo(c,s[a-2],s[a]),a+=2}var f,p,d=e.t-1,h=!0,g=nbi();for(i=nbits(e[d])-1;d>=0;){for(i>=u?f=e[d]>>i-u&l:(f=(e[d]&(1<<i+1)-1)<<u-i,d>0&&(f|=e[d-1]>>this.DB+i-u)),a=n;0==(1&f);)f>>=1,--a;if((i-=a)<0&&(i+=this.DB,--d),h)s[f].copyTo(o),h=!1;else{for(;a>1;)r.sqrTo(o,g),r.sqrTo(g,o),a-=2;a>0?r.sqrTo(o,g):(p=o,o=g,g=p),r.mulTo(g,s[f],o)}for(;d>=0&&0==(e[d]&1<<i);)r.sqrTo(o,g),p=o,o=g,g=p,--i<0&&(i=this.DB-1,--d)}return r.revert(o)}function bnGCD(e){var t=this.s<0?this.negate():this.clone(),n=e.s<0?e.negate():e.clone();if(t.compareTo(n)<0){var r=t;t=n,n=r}var i=t.getLowestSetBit(),o=n.getLowestSetBit();if(0>o)return t;for(o>i&&(o=i),o>0&&(t.rShiftTo(o,t),n.rShiftTo(o,n));t.signum()>0;)(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),(i=n.getLowestSetBit())>0&&n.rShiftTo(i,n),t.compareTo(n)>=0?(t.subTo(n,t),t.rShiftTo(1,t)):(n.subTo(t,n),n.rShiftTo(1,n));return o>0&&n.lShiftTo(o,n),n}function bnpModInt(e){if(0>=e)return 0;var t=this.DV%e,n=this.s<0?e-1:0;if(this.t>0)if(0==t)n=this[0]%e;else for(var r=this.t-1;r>=0;--r)n=(t*n+this[r])%e;return n}function bnModInverse(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return BigInteger.ZERO;for(var n=e.clone(),r=this.clone(),i=nbv(1),o=nbv(0),s=nbv(0),a=nbv(1);0!=n.signum();){for(;n.isEven();)n.rShiftTo(1,n),t?(i.isEven()&&o.isEven()||(i.addTo(this,i),o.subTo(e,o)),i.rShiftTo(1,i)):o.isEven()||o.subTo(e,o),o.rShiftTo(1,o);for(;r.isEven();)r.rShiftTo(1,r),t?(s.isEven()&&a.isEven()||(s.addTo(this,s),a.subTo(e,a)),s.rShiftTo(1,s)):a.isEven()||a.subTo(e,a),a.rShiftTo(1,a);n.compareTo(r)>=0?(n.subTo(r,n),t&&i.subTo(s,i),o.subTo(a,o)):(r.subTo(n,r),t&&s.subTo(i,s),a.subTo(o,a))}return 0!=r.compareTo(BigInteger.ONE)?BigInteger.ZERO:a.compareTo(e)>=0?a.subtract(e):a.signum()<0?(a.addTo(e,a),a.signum()<0?a.add(e):a):a}function bnIsProbablePrime(e){var t,n=this.abs();if(1==n.t&&n[0]<=lowprimes[lowprimes.length-1]){for(t=0;t<lowprimes.length;++t)if(n[0]==lowprimes[t])return!0;return!1}if(n.isEven())return!1;for(t=1;t<lowprimes.length;){for(var r=lowprimes[t],i=t+1;i<lowprimes.length&&lplim>r;)r*=lowprimes[i++];for(r=n.modInt(r);i>t;)if(0==r%lowprimes[t++])return!1}return n.millerRabin(e)}function bnpMillerRabin(e){var t=this.subtract(BigInteger.ONE),n=t.getLowestSetBit();if(0>=n)return!1;var r=t.shiftRight(n);e=e+1>>1,e>lowprimes.length&&(e=lowprimes.length);for(var i=nbi(),o=0;e>o;++o){i.fromInt(lowprimes[Math.floor(Math.random()*lowprimes.length)]);var s=i.modPow(r,this);if(0!=s.compareTo(BigInteger.ONE)&&0!=s.compareTo(t)){for(var a=1;a++<n&&0!=s.compareTo(t);)if(s=s.modPowInt(2,this),0==s.compareTo(BigInteger.ONE))return!1;if(0!=s.compareTo(t))return!1}}return!0}function pkcs1unpad2(e,t){for(var n=e.toByteArray(),r=0;r<n.length&&0==n[r];)++r;if(n.length-r!=t-1||2!=n[r])return null;for(++r;0!=n[r];)if(++r>=n.length)return null;for(var i="";++r<n.length;){var o=255&n[r];128>o?i+=String.fromCharCode(o):o>191&&224>o?(i+=String.fromCharCode((31&o)<<6|63&n[r+1]),++r):(i+=String.fromCharCode((15&o)<<12|(63&n[r+1])<<6|63&n[r+2]),r+=2)}return i}function RSASetPrivate(e,t,n){null!=e&&null!=t&&e.length>0&&t.length>0?(this.n=parseBigInt(e,16),this.e=parseInt(t,16),this.d=parseBigInt(n,16)):console.log("Invalid RSA private key")}function RSASetPrivateEx(e,t,n,r,i,o,s,a){null!=e&&null!=t&&e.length>0&&t.length>0?(this.n=parseBigInt(e,16),this.e=parseInt(t,16),this.d=parseBigInt(n,16),this.p=parseBigInt(r,16),this.q=parseBigInt(i,16),this.dmp1=parseBigInt(o,16),this.dmq1=parseBigInt(s,16),this.coeff=parseBigInt(a,16)):console.log("Invalid RSA private key")}function RSAGenerate(e,t){var n=new SecureRandom,r=e>>1;this.e=parseInt(t,16);for(var i=new BigInteger(t,16);;){for(;this.p=new BigInteger(e-r,1,n),0!=this.p.subtract(BigInteger.ONE).gcd(i).compareTo(BigInteger.ONE)||!this.p.isProbablePrime(10););for(;this.q=new BigInteger(r,1,n),0!=this.q.subtract(BigInteger.ONE).gcd(i).compareTo(BigInteger.ONE)||!this.q.isProbablePrime(10););if(this.p.compareTo(this.q)<=0){var o=this.p;this.p=this.q,this.q=o}var s=this.p.subtract(BigInteger.ONE),a=this.q.subtract(BigInteger.ONE),u=s.multiply(a);if(0==u.gcd(i).compareTo(BigInteger.ONE)){this.n=this.p.multiply(this.q),this.d=i.modInverse(u),this.dmp1=this.d.mod(s),this.dmq1=this.d.mod(a),this.coeff=this.q.modInverse(this.p);break}}}function RSADoPrivate(e){if(null==this.p||null==this.q)return e.modPow(this.d,this.n);for(var t=e.mod(this.p).modPow(this.dmp1,this.p),n=e.mod(this.q).modPow(this.dmq1,this.q);t.compareTo(n)<0;)t=t.add(this.p);return t.subtract(n).multiply(this.coeff).mod(this.p).multiply(this.q).add(n)}function RSADecrypt(e){var t=parseBigInt(e,16),n=this.doPrivate(t);return null==n?null:pkcs1unpad2(n,this.n.bitLength()+7>>3)}var SUMERU_APP_FW_DEBUG=!1;!function(e,t){var n="NAMESPACE",r="sumeru_AppFW",i={},o=!1,s=function(e,t){Library.net.get({url:e,callback:function(e){var n={};new Function("exports",e).call(null,n),t&&t(n)}})},a=function(e){function t(){}var r,o={};return Object.create?r=Object.create(o):(t.prototype=o,r=new t,r.__getPrototypeof=function(){return o}),r.__namespace=n,r.__isSeal=!1,r.__require=function(e,t,n){s(e,function(e){t&&t(e),n&&r.__reg(n,e)})},r.__runTraps=function(t){var n=i[e].traps[t];n&&n.length>0&&n.forEach(function(e){e(r[t])})},r.__reg=function(e,t,n){return n?r[e]=t:o[e]=t,r.__runTraps(e),t},r.__regAsync=function(e,t){return function(n){t?r[e]=n:o[e]=n,r.__runTraps(e)}},r.__load=function(e){return r[e]},r.__loadAsync=function(t,n){var o;o=i[e].traps[t]?i[e].traps[t]:i[e].traps[t]=[],o.push(n),void 0!==r[t]&&n(r[t])},r.addSubPackage=function(t){var n=e+"."+t;if(i[e].isSeal)throw'package ["'+e+'"] has sealed.';if(i[n])throw'package ["'+n+'"] already exists';return o[t]=a(n),i[n]={spaceObj:r[t],isSeal:!1,traps:{}},o[t]},r.__clear=function(){var t;if(!i[e].isSeal){for(var s in o)t=o[s],t.__namespace===n&&(t.__clear(),o[s]=Object.getPrototypeOf?Object.getPrototypeOf(t):t.__getPrototypeof(),r[s]=t);i[e].isSeal=!0}},r};if(o=e[t],e[t]=a(r),i[r]={spaceObj:e[t],isSeal:!1,traps:{}},o)for(var u in o)e[t].__reg([u],o[u]);e[t].clear=function(){e[t].__clear(),e[t].seal=void 0,delete e[t].seal,e[t]=Object.getPrototypeOf(e[t])},"undefined"!=typeof module&&module.exports&&(module.exports=function(){return e[t]}),SUMERU_APP_FW_DEBUG&&(e.DEBUG_PKG_MAPPING=i,e[t].__reg("SUMERU_APP_FW_DEBUG",!0))}(this,"sumeru");var Run_UnitTest_PKG=function(){var e=sumeru;a=fw.addSubPackage("a"),b=a.addSubPackage("b"),a.__loadAsync("name",function(e){console.log("fire trap...fw.a.name : "+e)}),b.__loadAsync("name",function(e){console.log("fire trap...fw.b.name : "+e)}),fw.a.b.__reg("age",100,!0),b.__loadAsync("age",function(e){console.log("fire trap...fw.b.age : "+e)});var t=a.__regAsync("name"),n=fw.a.b.__regAsync("name");setTimeout(function(){t("package fw.a"),n("package fw.a.b");for(var e=100;110>e;e++)n("name _ "+e);console.log(a.b.age),console.log(fw.a.b.age),console.log("async done...")},1e3),fw.clear(),console.log(void 0===fw.a.b.age),console.log(100===e.a.b.age),console.log(void 0===fw.addSubPackage),console.log(void 0===fw.a.addSubPackage),console.log(void 0===fw.a.b.addSubPackage),console.log(void 0===a.addSubPackage),console.log(void 0===b.addSubPackage)},runnable=function(e){function t(e){s(e).forEach(function(t){this[t]=e[t]},this)}var n=e.addSubPackage("utils"),r=Array.prototype.splice,i=Array.prototype.concat,o=function(e){return r.apply(e,r.call(arguments,1))},s=Object.keys,a=function(e){return i.apply(o(e,0),o(arguments,1))},u=n.__reg("cpp",function(e){var n=o(arguments,1);return n.forEach(t,e),e});n.__reg("extendFrom",function(e,t){var n=null,r=function(){};return Object.create?n=Object.create(e):(r.prototype=e,n=new r),u(n,t)}),n.__reg("getProxy",function(e,t){var n={};return t.forEach(function(e){var t=this;n[e]=function(){if(t[e]instanceof Function)return t[e].apply(t,arguments);throw e+" is not a function"}},e),n}),n.__reg("cleanObj",function(e,t){var n=Object.keys(e);n.forEach(function(e){try{"isDestroy"!=e&&(t&&t(this[e]),"array"==typeof this[e]&&(this[e].length=0),delete this[e])}catch(n){}},e)});var l=n.__reg("encodeURIComponentFull",function(e){var t=encodeURIComponent(e);return t=t.replace(/!/g,"%21"),t=t.replace(/\*/g,"%2A"),t=t.replace(/'/g,"%27"),t=t.replace(/\(/g,"%28"),t=t.replace(/\)/g,"%29"),t=t.replace(/\./g,"%2E"),t=t.replace(/\-/g,"%2D"),t=t.replace(/\_/g,"%5F"),t=t.replace(/\~/g,"%7E")});n.__reg("uriParamToMap",function(e){var t={};if(!e)return t;var n=e.split("&");return n.forEach(function(e){var t=e.split("=");t[0]&&(this[t[0]]=decodeURIComponent(t[1]))},t),t});var c=function(e,t){var n=[];return e.forEach(function(e){n.push(l(e))}),n.join(t)};n.__reg("mapToUriParam",function(e){var t=[],n=null;return"object"!=typeof e||Array.isArray(e)?"":(n=Object.keys(e),n.forEach(function(n){var r=e[n];switch(typeof r){case"string":case"number":case"boolean":t.push(n+"="+l(r));case"object":Array.isArray(r)&&t.push(n+"="+c(r));default:return}}),t.join("&"))});var f=n.__reg("randomInt",function(e,t){return Math.floor(Math.random()*(t-e+1)+e)}),p="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ",d=p.length-1;n.__reg("randomStr",function(e){for(var t="",n=0;e>n;n++)t+=p[f(0,d)];return t}),n.__reg("parseJSON",function(e){return new Function("window","document","sumeru","XMLHttpRequest","return "+e+";").call({},void 0,void 0,void 0,void 0)}),n.__reg("isSimpleType",function(e){switch(typeof e){case"string":case"number":case"boolean":return!0}return!1}),n.__reg("setStyles",function(e,t){var n=e.style,r="",i=/^(left|top|bottom|right|width|height)$/i;for(var o in t)r=t[o],"number"==typeof t[o]&&i.test(o)&&(r+="px"),n[o]=r;return e}),e.utils.__reg("chain",function(e,t){if(!Array.isArray(e))return!1;var n=e[0].length;if(!e.every(function(e){return e instanceof Function&&e.length===n}))return!1;var r=0,i=null;return i=function(){var n=e[r++];if(void 0!==n){var s=a(arguments,i);n.apply(this,s)}else t.apply(this,o(arguments,0))}}),e.utils.__reg("getTimeStamp",function(){return(new Date).valueOf()});var h={};e.__random=function(e){e=e||10;for(var t="qwertyuiopasdfghjklzxcvbnm1234567890",n=t.length,r=e,i="";r--;)i+=t.charAt(Math.floor(Math.random()*n));return h[i]?random(e):(h[i]=1,i)}};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru),function(e){e.event=e.event||{},e.event.domReady=function(e){/complete|loaded|interactive/.test(document.readyState)?e():document.addEventListener("DOMContentLoaded",function(){e()},!1)},e.event.onload=function(e){/complete/.test(document.readyState)?e():window.onload=function(){e()}},e.event.mapEvent=function(e,t){var n=document.querySelector(e);if(n)for(var r in t)"function"==typeof t[r]&&(r=r.split(","),r.forEach(function(e){n.addEventListener(e.trim(),t[r])}))}}(sumeru);var dbits,canary=0xdeadbeefcafe,j_lm=15715070==(16777215&canary);BigInteger.prototype.am=am3,dbits=28,BigInteger.prototype.DB=dbits,BigInteger.prototype.DM=(1<<dbits)-1,BigInteger.prototype.DV=1<<dbits;var BI_FP=52;BigInteger.prototype.FV=Math.pow(2,BI_FP),BigInteger.prototype.F1=BI_FP-dbits,BigInteger.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz",BI_RC=new Array,rr,vv;for(rr="0".charCodeAt(0),vv=0;9>=vv;++vv)BI_RC[rr++]=vv;for(rr="a".charCodeAt(0),vv=10;36>vv;++vv)BI_RC[rr++]=vv;for(rr="A".charCodeAt(0),vv=10;36>vv;++vv)BI_RC[rr++]=vv;Classic.prototype.convert=cConvert,Classic.prototype.revert=cRevert,Classic.prototype.reduce=cReduce,Classic.prototype.mulTo=cMulTo,Classic.prototype.sqrTo=cSqrTo,Montgomery.prototype.convert=montConvert,Montgomery.prototype.revert=montRevert,Montgomery.prototype.reduce=montReduce,Montgomery.prototype.mulTo=montMulTo,Montgomery.prototype.sqrTo=montSqrTo,BigInteger.prototype.copyTo=bnpCopyTo,BigInteger.prototype.fromInt=bnpFromInt,BigInteger.prototype.fromString=bnpFromString,BigInteger.prototype.clamp=bnpClamp,BigInteger.prototype.dlShiftTo=bnpDLShiftTo,BigInteger.prototype.drShiftTo=bnpDRShiftTo,BigInteger.prototype.lShiftTo=bnpLShiftTo,BigInteger.prototype.rShiftTo=bnpRShiftTo,BigInteger.prototype.subTo=bnpSubTo,BigInteger.prototype.multiplyTo=bnpMultiplyTo,BigInteger.prototype.squareTo=bnpSquareTo,BigInteger.prototype.divRemTo=bnpDivRemTo,BigInteger.prototype.invDigit=bnpInvDigit,BigInteger.prototype.isEven=bnpIsEven,BigInteger.prototype.exp=bnpExp,BigInteger.prototype.toString=bnToString,BigInteger.prototype.negate=bnNegate,BigInteger.prototype.abs=bnAbs,BigInteger.prototype.compareTo=bnCompareTo,BigInteger.prototype.bitLength=bnBitLength,BigInteger.prototype.mod=bnMod,BigInteger.prototype.modPowInt=bnModPowInt,BigInteger.ZERO=nbv(0),BigInteger.ONE=nbv(1),Arcfour.prototype.init=ARC4init,Arcfour.prototype.next=ARC4next;var rng_psize=256,rng_state,rng_pool,rng_pptr;if(null==rng_pool){rng_pool=new Array,rng_pptr=0;for(var t,z;rng_psize>rng_pptr;)t=Math.floor(65536*Math.random()),rng_pool[rng_pptr++]=t>>>8,rng_pool[rng_pptr++]=255&t;rng_pptr=0,rng_seed_time()}SecureRandom.prototype.nextBytes=rng_get_bytes,RSAKey.prototype.doPublic=RSADoPublic,RSAKey.prototype.setPublic=RSASetPublic,RSAKey.prototype.encrypt=RSAEncrypt,NullExp.prototype.convert=nNop,NullExp.prototype.revert=nNop,NullExp.prototype.mulTo=nMulTo,NullExp.prototype.sqrTo=nSqrTo,Barrett.prototype.convert=barrettConvert,Barrett.prototype.revert=barrettRevert,Barrett.prototype.reduce=barrettReduce,Barrett.prototype.mulTo=barrettMulTo,Barrett.prototype.sqrTo=barrettSqrTo;var lowprimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],lplim=(1<<26)/lowprimes[lowprimes.length-1];BigInteger.prototype.chunkSize=bnpChunkSize,BigInteger.prototype.toRadix=bnpToRadix,BigInteger.prototype.fromRadix=bnpFromRadix,BigInteger.prototype.fromNumber=bnpFromNumber,BigInteger.prototype.bitwiseTo=bnpBitwiseTo,BigInteger.prototype.changeBit=bnpChangeBit,BigInteger.prototype.addTo=bnpAddTo,BigInteger.prototype.dMultiply=bnpDMultiply,BigInteger.prototype.dAddOffset=bnpDAddOffset,BigInteger.prototype.multiplyLowerTo=bnpMultiplyLowerTo,BigInteger.prototype.multiplyUpperTo=bnpMultiplyUpperTo,BigInteger.prototype.modInt=bnpModInt,BigInteger.prototype.millerRabin=bnpMillerRabin,BigInteger.prototype.clone=bnClone,BigInteger.prototype.intValue=bnIntValue,BigInteger.prototype.byteValue=bnByteValue,BigInteger.prototype.shortValue=bnShortValue,BigInteger.prototype.signum=bnSigNum,BigInteger.prototype.toByteArray=bnToByteArray,BigInteger.prototype.equals=bnEquals,BigInteger.prototype.min=bnMin,BigInteger.prototype.max=bnMax,BigInteger.prototype.and=bnAnd,BigInteger.prototype.or=bnOr,BigInteger.prototype.xor=bnXor,BigInteger.prototype.andNot=bnAndNot,BigInteger.prototype.not=bnNot,BigInteger.prototype.shiftLeft=bnShiftLeft,BigInteger.prototype.shiftRight=bnShiftRight,BigInteger.prototype.getLowestSetBit=bnGetLowestSetBit,BigInteger.prototype.bitCount=bnBitCount,BigInteger.prototype.testBit=bnTestBit,BigInteger.prototype.setBit=bnSetBit,BigInteger.prototype.clearBit=bnClearBit,BigInteger.prototype.flipBit=bnFlipBit,BigInteger.prototype.add=bnAdd,BigInteger.prototype.subtract=bnSubtract,BigInteger.prototype.multiply=bnMultiply,BigInteger.prototype.divide=bnDivide,BigInteger.prototype.remainder=bnRemainder,BigInteger.prototype.divideAndRemainder=bnDivideAndRemainder,BigInteger.prototype.modPow=bnModPow,BigInteger.prototype.modInverse=bnModInverse,BigInteger.prototype.pow=bnPow,BigInteger.prototype.gcd=bnGCD,BigInteger.prototype.isProbablePrime=bnIsProbablePrime,BigInteger.prototype.square=bnSquare,RSAKey.prototype.doPrivate=RSADoPrivate,RSAKey.prototype.setPrivate=RSASetPrivate,RSAKey.prototype.setPrivateEx=RSASetPrivateEx,RSAKey.prototype.generate=RSAGenerate,RSAKey.prototype.decrypt=RSADecrypt;var runnable=function(e,t){var n={e:"3"};e.addSubPackage("myrsa");var r=function(e,t){var r=new RSAKey;
r.setPublic(t,n.e);var i=r.encrypt(e);return i&&(i=linebrk(i,64)),i},i=function(e){var t=new RSAKey;if(0==e.length)return e;t.setPrivateEx(n.n,n.e,n.d,n.p,n.q,n.dmp1,n.dmq1,n.coeff);var r=t.decrypt(e);return r&&(r=r),r},o=function(e,t){if("string"!=typeof e||!c())return console.log("RSA encrypt canceled",e),e;if(!n.pk2&&"undefined"==typeof t)return console.log("pk2 没传入，rsa加密不启用"),e;t="string"==typeof t?t:n.pk2;for(var i=[],o=0,s=e.length;s>o;o+=5)i.push(r(e.substr(o,5),t));return i.join("|")},s=function(e){if("string"!=typeof e||!c())return console.log("RSA decrypt canceled",e),e;for(var t="",n=e.split("|"),r=0,o=n.length;o>r;r++)t+=i(n[r]);return t},a=function(e){var t=new RSAKey;return n.bits="number"==typeof e?e:128,t.generate(parseInt(n.bits),n.e),n.n=linebrk(t.n.toString(16),64),n.d=linebrk(t.d.toString(16),64),n.p=linebrk(t.p.toString(16),64),n.q=linebrk(t.q.toString(16),64),n.dmp1=linebrk(t.dmp1.toString(16),64),n.dmq1=linebrk(t.dmq1.toString(16),64),n.coeff=linebrk(t.coeff.toString(16),64),n},u=function(){return n.n},l=function(e){n.pk2=e},c=function(){return e.config.get("rsa_enable")},f=function(){return n.pk2};"undefined"!=typeof t&&a(),e.myrsa.__reg("encrypt",o,"private"),e.myrsa.__reg("decrypt",s,"private"),e.myrsa.__reg("generate",a,"private"),e.myrsa.__reg("getPk",u,"private"),e.myrsa.__reg("setPk2",l,"private"),e.myrsa.__reg("getPk2",f,"private")};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru);var runnable=function(e){if(e.netMessage)return console.log("netMessage is exist."),void 0;var t=e.addSubPackage("netMessage"),n={0:"onLocalMessage",100:"onError",200:"onMessage",300:"onGlobalError",400:"onGlobalMessage",500:"onLogMessage"},r=Array.prototype.splice,i=e.IS_SUMERU_SERVER,o=Object.create(n),s=null,a=null,u=null,l=[],c=[],f=[],p=[],d=function(e){var t=[];return e.forEach(function(e){t.push(e.filter)}),t},h=function(e){var t=sumeru.utils.parseJSON(e);return void 0===t.number||void 0===t.type||void 0===t.content?!1:t},g=function(t,n,r){var i={number:n+"",type:null,target:r+"",content:null};return e.utils.isSimpleType(t)?(i.type="simple",i.content=t):(i.type="json",i.content="0"!==n?JSON.stringify(t):t),i},_=function(e){var t=null;if("0"===e.number)return y(e);if(t=i===!0&&"600"===e.number?u:a,null===t)throw"no output";return Array.prototype.splice.call(arguments,0,1,JSON.stringify(e)),t.apply({},arguments)},m=function(t){return function(n,i){var o=g(n,t,i),s=r.call(arguments,0),a=s[s.length-2];if(0!==p.length){var u=e.utils.chain(p,function(e){s.splice(0,2,e),_.apply({},s)});u(o,a instanceof Function?a:function(){})}else s.splice(0,2,o),_.apply({},s)}},v=function(){var e;for(var n in o)e=o[n],e="send"+e.substr(2),t.__reg(e,m(n))},b=function(e,t){return e.order<t.order};t.__reg("addInFilter",function(e,t){var n=2==e.length?function(t,n,r){var i=null;try{i=e(t,n)}catch(o){return console.log(o),void 0}r(i,n)}:e;l.push({filter:n,order:void 0===t?Number.MIN_VALUE:t}),l.sort(b),c=d(l)},!1),t.__reg("addOutFilter",function(e,t){var n=1==e.length?function(t,n,r){var i=null;try{i=e(t)}catch(o){n(o)}r(i,n)}:e;f.push({filter:n,order:void 0===t?Number.MIN_VALUE:t}),f.sort(b),p=d(f)},!1),t.__reg("onData",function(t,n){var r=h(t);if(i&&e.SUMERU_APP_FW_DEBUG===!1)try{y(r,n)}catch(o){console.error(o)}else y(r,n)},!1),t.__reg("addACL",function(e,t){var r=t;0!==t.indexOf("on")&&(r="on"+t.substr(0,1).toUpperCase()+t.substr(1)),void 0===n[e]&&(o[e]=r,v())},!1),t.__reg("setOutput",function(e){if(!(e instanceof Function))throw"__output is not a function.";a=e},!1),i&&(n["600"]="onS2SMessage",t.__reg("setOutputToServer",function(e){if(!(e instanceof Function))throw"__output is not a function.";u=e})),t.__reg("setReceiver",function(e){s=s||{};var t,n,r,i,a;for(var u in o)if(t=o[u],a=e[t],void 0!==a){if(a instanceof Function)n="",r=a;else if(n=a.target||"",!(r=a.handle)instanceof Function)continue;i=s[t]=s[t]||{},Array.isArray(n)?n.forEach(function(e){this[e]=r},i):i[n]=r}Object.keys(o).forEach(function(e){this[o[e]]instanceof Function&&(s[o[e]]=this[o[e]])},e),v()},!1);var y=function(t,n){var r=null,i=null,a=null,u=null;if(null===s)throw"no receiver";if(void 0===t.number)return!1;if(void 0===(r=o[t.number]))return console.log("unidentifiable message number"),!1;if(void 0===s[r])return console.log("no receiver handle"),!1;if(i=s[r][t.target||""],void 0===i&&""!==t.target&&(i=s[r][""],void 0===i))return!1;var l=function(){return u="json"==t.type&&"0"!==t.number?e.utils.parseJSON(t.content):t.content,a=i(u,t.target,n),a===!1&&"100"==t.number?(t.number="300",y(t,n)):a===!1&&"200"==t.number?(t.number="400",y(t,n)):void 0};if(0!==c.length){var f=e.utils.chain(c,l);f(t,n)}else l()};"undefined"!=typeof module&&module.exports&&(module.exports=function(){return t}),console.log("runing [NetMessage] in "+(e.IS_SUMERU_SERVER?"server":"client"))};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru);var runnable=function(e){!function(e){var t=e.addSubPackage("sense");t.__reg("runSenseContext",function(e){t.__reg("_senseInspector",function(t,n){t.addObserver(n,e)},!0),e(),t.__reg("_senseInspector",function(){},!0)});var n={get:function(e){return t._senseInspector&&t._senseInspector(this,e),this.container[e]},set:function(e,t){if(this.container[e]=t,0!=this.observer.length)for(var n=0,r=this.observer.length;r>n;n++)this.observer[n].key!=e||this.toBeCommited.some(function(e){return e(this.observer[n])},this)||this.toBeCommited.push(function(t,n){return function(r){return 0!==arguments.length?r==n:(console.log("exec customCloser",n.customClosure.length),n.customClosure.call(t,e),void 0)}}(this,this.observer[n]))},commit:function(){var t=this.toBeCommited;if(0===t.length)return!0;var n=[];e.controller.__reg("_tapped_blocks",n,!0);for(var r=0,i=t.length;i>r;r++)t[r]();e.controller.__load("reactiveRender")(n),t.length=0},addObserver:function(e,t){for(var n=0,r=this.observer.length;r>n;n++)if(this.observer[n].key===e&&this.observer[n].customClosure==t)return;this.observer.push({key:e,customClosure:t})},removeObserver:function(e){for(var t=0,n=this.observer.length;n>t;t++)if(this.observer[t].customClosure===e)return this.observer.splice(t,1),void 0},cleanObserver:function(){this.observer.length=0,this.toBeCommited.length=0}};t.__reg("extend",function(t,r){var i=function(){return function(){this.toBeCommited=[],this.observer=[],this.container={},t.apply(this,arguments)}}(t);return i.prototype=e.utils.cpp(r||t.prototype,n),i})}(e)};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru),function(e){var t,n,r,i=e.addSubPackage("session"),o={},s={},a=e.utils.parseJSON,u=e.utils.isSimpleType,l=e.sense.extend(function(e){this.__identifier=e,this.__hashKey=[],this.__snapshot={},this.__getId=function(){return e}});t=l.prototype.get,n=l.prototype.set,r=l.prototype.commit,l.prototype.get=function(e){return function(){return e.apply(this,arguments)}}(t),l.prototype.set=function(e){return function(t,n,r){var i=r;if(r&&this.__hashKey.push(t),(i||-1!=this.__hashKey.indexOf(t))&&!u(n))throw"data type error";return e.call(this,t,n)}}(n),l.prototype.setIfNull=function(e){return function(t,n,r){if(!this.container.hasOwnProperty(t)){if(r&&-1==this.__hashKey.indexOf(t)&&this.__hashKey.push(t),(r||-1!=this.__hashKey.indexOf(t))&&!u(n))throw"data type error";return e.call(this,t,n)}}}(n),l.prototype.commit=function(e){return function(){var t={},n=e.apply(this,arguments);return this.__hashKey.forEach(function(e){t[e]=this.container[e]},this),o[this.__identifier]=JSON.stringify(t),"{}"==o[this.__identifier]?delete o[this.__identifier]:this.__snapshot[o[this.__identifier]]=JSON.stringify(this.container),i.serialize(),n}}(r),l.prototype.__unserialize=function(){var e,t,n=!1,r=this.__identifier,i=o[r];if(this.__snapshot[i]&&(e=a(this.__snapshot[i])))this.container=e,n=!0;else if(""!==i&&null!=i){for(var s in t=a(i))this.container[s]=t[s],-1==this.__hashKey.indexOf(s)&&this.__hashKey.push(s);n=!0}return n},i.__reg("create",function(e){var t=null;return(t=s[e])?t:(t=s[e]=new l(e),t.__unserialize(),t)}),i.__reg("destroy",function(t){var n="string"==typeof t?s[t]:t;t=n.__identifier,e.utils.cleanObj(n),s[t]=void 0,o[t]=void 0,delete s[t],delete o[t]}),i.__reg("serialize",function(){var t=JSON.stringify(o);e.router.joinSessionToHash(t),SUMERU_APP_FW_DEBUG&&console.log("call serialize, serializeDat : ",t)},!0),i.__reg("setResume",function(e){o=e&&a("{"+e+"}")||{};for(var t in s)s[t].__unserialize()&&s[t].commit();SUMERU_APP_FW_DEBUG&&console.log("serialize_pool",o)},!0)}(sumeru);var ObjectId=function(){var e=0,t=Math.floor(32767*Math.random()),n=Math.floor(16777216*Math.random());if("undefined"!=typeof localStorage){var r=parseInt(localStorage.mongoMachineId);r>=0&&16777215>=r&&(n=Math.floor(localStorage.mongoMachineId)),localStorage.mongoMachineId=n,document.cookie="mongoMachineId="+n+";expires=Tue, 19 Jan 2038 05:00:00 GMT"}else{var i=document.cookie.split("; ");for(var o in i){var s=i[o].split("=");if("mongoMachineId"==s[0]&&s[1]>=0&&s[1]<=16777215){n=s[1];break}}document.cookie="mongoMachineId="+n+";expires=Tue, 19 Jan 2038 05:00:00 GMT"}return function(){return this instanceof ObjectId?("object"==typeof arguments[0]?(this.timestamp=arguments[0].timestamp,this.machine=arguments[0].machine,this.pid=arguments[0].pid,this.increment=arguments[0].increment):"string"==typeof arguments[0]&&24==arguments[0].length?(this.timestamp=Number("0x"+arguments[0].substr(0,8)),this.machine=Number("0x"+arguments[0].substr(8,6)),this.pid=Number("0x"+arguments[0].substr(14,4)),this.increment=Number("0x"+arguments[0].substr(18,6))):4==arguments.length&&null!=arguments[0]?(this.timestamp=arguments[0],this.machine=arguments[1],this.pid=arguments[2],this.increment=arguments[3]):(this.timestamp=Math.floor((new Date).valueOf()/1e3),this.machine=n,this.pid=t,e>16777215&&(e=0),this.increment=e++),void 0):new ObjectId(arguments[0],arguments[1],arguments[2],arguments[3]).toString()}}();ObjectId.prototype.getDate=function(){return new Date(1e3*this.timestamp)},ObjectId.prototype.toString=function(){var e=this.timestamp.toString(16),t=this.machine.toString(16),n=this.pid.toString(16),r=this.increment.toString(16);return"00000000".substr(0,6-e.length)+e+"000000".substr(0,6-t.length)+t+"0000".substr(0,4-n.length)+n+"000000".substr(0,6-r.length)+r},sumeru.__reg("__ObjectId",ObjectId,!0),delete ObjectID,App="undefined"!=typeof App?App:{};var runnable=function(e){!function(e){var t=e.sense.extend(function(){}),n=function(){var e=function(){this.configMap={}},n=new t,r=function(){};return r.prototype=n,e.prototype=new r,e.prototype.set=function(){this.define.apply(this,arguments)},e.prototype.get=function(e){return n.get(e),this.configMap[e]},e.prototype.define=function(){var e;if(1==arguments.length)e=arguments[0];else{if(2!=arguments.length)throw new Error("config define error");e={},e[arguments[0]]=arguments[1]}for(var t in e)e.hasOwnProperty(t)&&(n.set(t,e[t]),this.configMap[t]=e[t])},new e},r=function(t){if("undefined"!=typeof t){var i=n(),o=function(){i.set.apply(i,arguments)};return o.defineModule=r,o.config=function(){i.set.apply(i,arguments)},o.get=function(){return i.get.apply(i,arguments)},o.set=function(){i.set.apply(i,arguments)},o.commit=function(){i.commit.apply(i,arguments),"undefined"!=typeof module&&"undefined"!=typeof exports?e.pushUpdateOfConfig(i.configMap):e.netMessage.sendMessage(i.configMap,"config_push",function(){},function(){})},this[t]=o,o}};r.call(e,"defineConfig"),e.config=e.defineConfig}(e)};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru),function(e){e.addSubPackage("transition");var t="__viewBlock__",n=function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},r=function(e){return document.createElement(e)},i=function(e,t){if("string"!=typeof t||!o(e,t)){var r=n(e.className).replace(/\s+/g," ").split(" ");r=r.concat(t),e.className=r.join(" ")}},o=function(e,t){var n=new RegExp("( |^)"+t+"( |$)",["i"]);return e.className.match(n)?!0:void 0},s=function(e,t){var r=n(e.className).replace(/\s+/g," ").split(" ");if(t instanceof Array)for(var i=0,o=r.length;o>i;i++)t.indexOf(r[i])>-1&&r.splice(i,1);else if(0===t.search("^"))for(var s=new RegExp(t,""),i=0,o=r.length;o>i;i++)r[i]&&r[i].match(s)&&r.splice(i,1);else for(var i=0,o=r.length;o>i;i++)r[i]===t&&r.splice(i,1);e.className=r.join(" ")},a=function(e,t,r){var i=n(e.className).replace(/\s+/g," ").split(" ");if(r instanceof Array)for(var o=0,s=i.length;s>o;o++)r.indexOf(i[o])>-1&&i.splice(o,1);else for(var o=0,s=i.length;s>o;o++)i[o]===r&&i.splice(o,1);i=i.concat(t),e.className=i.join(" ")},u=function(e,t,r){var i=n(e.className).replace(/\s+/g," ").split(" "),o=i.indexOf(t),s=r?i.indexOf(r):-1;o>=0?(i.splice(o,1),r&&i.push(r)):(i.push(t),s>=0&&i.splice(s,1)),e.className=i.join(" ")},l=function(e){e.style.width="100%"},c={push:[1,1,1,1],rotate:[0,1,0,1],fade:[0,0,0,0,2],shake:[0,1,0,1],none:[0,0,0,0,2]},f={show:"_g_{$}_sw",standby:"_g_{$}_sb",hide:"_g_{$}_hd"},p=["top","right","bottom","left",""],d={push:{up:"Up",down:"Down",left:"Left",right:"Right"},bounce:{"":"",up:"Up",down:"Down",left:"Left",right:"Right"},fade:{"":"",up:"Up",down:"Down",left:"Left",right:"Right"},rotate:{"":"",up:"UpLeft",down:"DownRight",left:"DownLeft",right:"UpRight"},flip:{x:"X",y:"Y"},expand:{x:"X",y:"Y","":""},none:{none:""},1:1},h={push:["_fw_pushIn","_fw_pushOut"],bounce:["_fw_bounceIn","_fw_bounceOut"],fade:["_fw_fadeIn","_fw_fadeOut"],rotate:["_fw_rotateIn","_fw_rotateOut"],flip:["_fw_flipIn","_fw_flipOut"],expand:["_fw_expand","_fw_collapse"],none:["_fw_none","_fw_hide"],1:1},g=null,_=function(e,t){t instanceof Array&&t.length>1||(t=["push",1]);var n=t[0]+(p[t[1]].length>0?"_"+p[t[1]]:"");return f[e].replace("{$}",n)},m={showScene:{type:null,dom:null,anim:null,classname:null},hideScene:{type:null,dom:null,anim:null,classname:null}},v=!0,b=function(){g=document.createElement("div"),g.className="warp",document.body.appendChild(g),v=!1,l(g)},y=function(e,t){var n=r("div"),i=r("div"),o=r("div"),s=r("div");return n.style.webkitPerspective=1e3,i.className="animated _g_flip_card",o.className="_g_flip_front",s.className="_g_flip_back",o.appendChild(e),s.appendChild(t),i.appendChild(s),i.appendChild(o),n.appendChild(i),n},S=function(e){var t={up:0,right:1,down:2,left:3,z:4,none:4};c[e.anim[0]][t[e.anim[1]]]<=0&&(e.anim=["push",1]),e.transitionOut&&c[e.transitionOut[0]][t[e.transitionOut[1]]]<=0&&(e.transitionOut=["push",1]),e.type||(e.type="common"),e.anim&&"undefined"!=typeof e.anim[1]&&"undefined"!=typeof t[e.anim[1]]&&(e.anim[1]=t[e.anim[1]]),(!e.anim||"undefined"==typeof c[e.anim[0]]||"undefined"==typeof c[e.anim[0]][e.anim[1]]||c[e.anim[0]][e.anim[1]]<=0)&&(e.anim=["push",1]),e.transitionOut&&("object"!=typeof e.transitionOut?e.anim[1]=(e.anim[1]+2)%4:(e.transitionOut[1]=(e.transitionOut[1]+2)%4,e.anim=e.transitionOut))},w=function(e){v&&b(),S(e);var n=m.showScene,r=m.hideScene,o=n&&n.anim?n.anim[0]!=e.anim[0]||n.anim[1]!=e.anim[1]:!0;switch(e.type){case"common":if(e.dom instanceof Array&&(e.dom_front=e.dom[0],e.dom_back=e.dom[1]),e.cloneDom)n.dom.parentNode.appendChild(e.cloneDom),n.dom.addEventListener("webkitTransitionEnd",function(){e.cloneDom&&e.cloneDom.parentNode&&(e.cloneDom.parentNode.removeChild(e.cloneDom),delete e.cloneDom)},!1),n.dom=e.cloneDom;else{if(n.dom==e.dom)return!1;delete e.cloneDom}if(e.dom instanceof Array&&(n.dom==e.dom_front||n.dom==e.dom_back)||("undefined"!=typeof n.dom_front?n.dom_front==e.dom_front||n.dom_front==e.dom_back||n.dom_front==e.dom:!1)||("undefined"!=typeof n.dom_back?n.dom_back==e.dom_front||n.dom_back==e.dom_back||n.dom_back==e.dom:!1))return!1;if(e.dom instanceof Array&&(e.dom=y(e.dom[0],e.dom[1])),r&&r.dom)if(r.dom_front){var l=0;r.dom_front!=e.dom&&r.dom_front!=e.dom_front&&r.dom_front!=e.dom_back&&(r.dom_front.className=r.front_classname?"hide "+r.front_classname:"hide",g.appendChild(r.dom_front),l++),r.dom_back!=e.dom&&r.dom_back!=e.dom_front&&r.dom_back!=e.dom_back&&(r.dom_back.className=r.back_classname?"hide "+r.back_classname:"hide",g.appendChild(r.dom_back),l++),g.removeChild(r.dom)}else r.dom!=e.dom&&r.dom!=e.dom_front&&r.dom!=e.dom_back&&(r.dom.className=r.classname?"hide "+r.classname:"hide");e.dom_front?(e.front_classname=e.dom_front.className.replace(/(_g_[\S]*)|(transi)|(hide)|(animated)/g,"").replace(new RegExp(t,"g"),"").replace(/(^\s*)|(\s*$)/g,"")+t,e.dom_front.className=e.front_classname,e.back_classname=e.dom_back.className.replace(/(_g_[\S]*)|(transi)|(hide)|(animated)/g,"").replace(new RegExp(t,"g"),"").replace(/(^\s*)|(\s*$)/g,"")+t,e.dom_back.className=e.back_classname):(e.classname=e.dom.className.replace(/(_g_[\S]*)|(transi)|(hide)|(animated)/g,"").replace(new RegExp(t,"g"),"").replace(/(^\s*)|(\s*$)/g,"")+t,e.dom.className=e.classname?"hide "+e.classname:"hide");var f=e.dom;r.dom?r.dom:!1;var p=n.dom?n.dom:!1;o&&p&&(p.className=n.classname?t+" "+n.classname:t,i(p,_("show",e.anim))),i(f,[_("standby",e.anim),t]),g!=f.parentElement&&g.appendChild(f),s(f,"hide");var d=o?10:1;setTimeout(function(){1==c[e.anim[0]][e.anim[1]]&&(p&&i(p,"transi"),i(f,"transi")),p&&a(p,_("hide",e.anim),_("show",e.anim)),a(f,_("show",e.anim),_("standby",e.anim)),2==c[e.anim[0]][e.anim[1]]&&(p&&i(p,"animated"),i(f,"animated"))},d),m.showScene.anim&&(m.showScene.anim=e.anim),m.hideScene=m.showScene,m.showScene=e,m.hideScene.callback&&m.hideScene.callback.hide&&m.hideScene.callback.hide(),e.callback&&e.callback.load&&e.callback.load();break;case"flipleft":s(n.dom.firstChild,["_g_flip_card_right","_g_flip_card_right_def"]),u(n.dom.firstChild,"_g_flip_card_left","_g_flip_card_left_def");break;case"flipright":s(n.dom.firstChild,["_g_flip_card_left","_g_flip_card_left_def"]),u(n.dom.firstChild,"_g_flip_card_right","_g_flip_card_right_def")}return!0},E=function(e,t){var n=e.dom;e.anim||(e.anim=["push","down"]),t?(d[e.anim[0]]&&"undefined"!=typeof d[e.anim[0]][e.anim[1]]&&(s(n,"^_fw_"),i(n,h[e.anim[0]][1]+d[e.anim[0]][e.anim[1]])),n.style.display="",n.addEventListener("webkitAnimationEnd",T,!1)):(i(n,"animated"),d[e.anim[0]]&&"undefined"!=typeof d[e.anim[0]][e.anim[1]]&&(s(n,"^_fw_"),i(n,h[e.anim[0]][0]+d[e.anim[0]][e.anim[1]])),n.style.display="block",n.removeEventListener("webkitAnimationEnd",T,!1))},T=function(){this.style.display="none"};e.transition.__reg("_run",w,"private"),e.transition.__reg("_subrun",E,"private")}(sumeru),function(e){e.addSubPackage("pubsub");var t={},n={a:1},r=[],i=function(){},o=Array.prototype.pop,s=Array.prototype.slice;i.prototype={subscribe:function(i){var a=n[i.replace(/@@_sumeru_@@_page_([\d]+)/,"")],u=a.modelname,l=a.plainstruct;if("undefined"==typeof u)throw"publish "+i+" NOT FOUND";u="Model."+u;var c=null;"object"==typeof this&&"undefined"!=typeof this.isWaiting&&(c=this,c.wait());var f=e.collection.create({modelName:u});f.pubName=i;var p=o.call(arguments),d=s.call(arguments,1),h=f.getVersion();e.netMessage.sendMessage({name:i,args:d,version:h},"subscribe",function(e){console.log("Err : subscribe "+e)},function(){console.log("send subscribe "+i,h||"no version")}),t[i]||(r.push(i),t[i]={modelName:u,plainStruct:l,args:d,topPriority:!1,stub:[]});var g=this.__UK,_=Function.toString.call(p),m=this.subscribe.caller;t[i].stub=t[i].stub.filter(function(e){return e.id==g&&e.sourceCustomClosure==m&&e.callbackStr==_?!1:!0});var v=function(){p(arguments[0],arguments[1]),c&&c.start()};return t[i].stub.push({id:g,sourceCustomClosure:m,collection:f,callback:v,callbackStr:_,env:this}),f},subscribeByPage:function(e,t){var n={pagesize:10,page:1,uniqueField:"time"};t=Library.objUtils.extend(n,t);var r=arguments;r[0]=e+"@@_sumeru_@@_page_"+t.page;var i=this.subscribe.apply(this,r);return i},prioritySubscribe:function(e){var n=arguments,r=this.subscribe.apply(this,n);return t[e].topPriority=!0,r}};var a=function(){u(l)},u=function(n){cbHandler=Library.asyncCallbackHandler.create(function(){n(),e.pubsub.__reg("_priorityAsyncHandler",void 0,!0)}),e.pubsub.__reg("_priorityAsyncHandler",cbHandler,!0),cbHandler.add();for(var i=0,o=r.length;o>i;i++){var s=r[i];if("auth-init"!=s&&s in t&&t[s].topPriority!==!1){cbHandler.add();var a=t[s].stub[0].collection.getVersion();e.netMessage.sendMessage({name:s,args:t[s].args,version:a},"subscribe",function(){console.log("Err : redoPrioritySubscribe")},function(){console.log("sending redo priority subscribe "+s,a||"no version(redo)")})}}cbHandler.enableCallback(),cbHandler.decrease()},l=function(){for(var n=0,i=r.length;i>n;n++){var o=r[n];if("auth-init"!=o&&o in t&&t[o].topPriority!==!0){var s=t[o].stub[0].collection.getVersion();e.netMessage.sendMessage({name:o,args:t[o].args,version:s},"subscribe",function(){console.log("Err : redoNormalSubscribe")},function(){console.log("sending redo priority subscribe "+o,s||"no version(redo)")})}}};e.pubsub.__reg("clear",function(){var n;for(var i in t){n=t[i].stub||{};for(var o=n.length-1;o>=0;o--)n[o].env.isDestroy&&(n[o].collection=null,n[o].callback=null,n[o].env=null,n.splice(o,1));0==n.length&&(e.netMessage.sendMessage({name:i},"unsubscribe",function(){},function(){console.log("unsubscribe",i)}),delete t[i],r=r.filter(function(e){return e==i?!1:!0}))}},!0),e.pubsub.__reg("_pubsubObject",i,!0),e.pubsub.__reg("_subscribeMgr",t,!0),e.pubsub.__reg("_publishModelMap",n,!0),e.pubsub.__reg("_redoAllSubscribe",a,!0),e.pubsub.__reg("_postponeQueue",[],"private");var c=e.pubsub._postponeQueue,f=function(e){0!==c.length&&c.forEach(function(t,n){t.collection==e&&(t.runner(),c.splice(n,1))})};e.pubsub.__reg("_releaseHold",f,"private")}(sumeru),function(fw){var _controller=fw.addSubPackage("controller"),activeController=[],activeControllerId,cloneDom=null,transitionOut=!1,globalIsforce=null;_bindingMap={};var _bindingData=function(e,t){var n=this.__UK+"_"+e;_bindingMap[n]||(_bindingMap[n]={view_data:{},eventMap:{}});var r=_controller.__load("_tapped_blocks");"undefined"!=typeof r&&r.push({widgetId:n});for(var i in t)t.hasOwnProperty(i)&&(_bindingMap[n].view_data[i]=t[i])},_bindingDataByPage=function(e,t){var n=this.__UK+"_"+e;if(_bindingMap[n]||(_bindingMap[n]={view_data:{},eventMap:{}}),"undefined"==typeof t.page)throw"subscribeByPage always need a page parameter";_bindingMap[n].isByPage=!0;var r=_bindingMap[n].view_data[t.page]={},i=_controller.__load("_tapped_blocks");"undefined"!=typeof i&&i.push({widgetId:n,page:t.page,options:t.options||{}});for(var o in t)t.hasOwnProperty(o)&&(r[o]=t[o])},_cloneDom=function(e){cloneDom=e.getDom().cloneNode(!0),cloneDom.style.zIndex="0",cloneDom.removeAttribute("id");for(var t=cloneDom.querySelectorAll("[tpl-id]"),n=0,r=t.length;r>n;n++)t[n].removeAttribute("tpl-id")},_bindingEvent=function(e,t){var n=this.__UK+"_"+e;_bindingMap[n]||(_bindingMap[n]={view_data:{},eventMap:{}});var r=this;_bindingMap[n].eventMap.__default_key__=function(){t.call(r)},_bindingMap[n].eventMap.__default_key__()},queryElementsByTplId=function(e,t){return(t||document).querySelectorAll('block[tpl-id="'+e+'"]')||[]},doRenderByRelation=function(e,t){for(var n in e)t(n,e[n]),doRenderByRelation(e[n],t)},findAndDestroy=_controller.__reg("findAndDestroy",function(e,t){var n=activeController.filter(function(n){var r=n.__getID();if(r===t);else if(-1!==e.indexOf(r))return!0;return!1});n.forEach(function(e){e.destroy()})},!0),_Environment=function(){this.isWaiting=0,this.isWaitingChecker=null,this.callbackFunc=null,this.isDestroy=!1,this.withEnyo=!1},_pubSubObject=new fw.pubsub._pubsubObject;_Environment.prototype={__destroy:function(){fw.utils.cleanObj(this),this.isDestroy=!0,fw.pubsub.clear()},setClockChecker:function(){var e=8e3;this.isWaitingChecker=setTimeout(function(){if(this.isWaiting>0)throw"NOT call env.start after "+e/1e3+" seconds, do you forget it?"},e)},clearClockChecker:function(){clearTimeout(this.isWaitingChecker)},setCallback:function(e){this.callbackFunc=e},fireCallback:function(){this.isWaiting<=0&&this.callbackFunc&&this.callbackFunc()},redirect:function(e,t,n){var r=e;t&&(r+="!"+fw.utils.mapToUriParam(t)),fw.router.redirect(r,n)},refresh:function(){return this.__getControllerInstance().__refresh()},callSub:function(e){this.__getControllerInstance().__callSubController(e)},wait:function(){this.isWaiting++,this.setClockChecker()},start:function(){this.clearClockChecker(),--this.isWaiting<=0&&(this.isWaiting=0,this.fireCallback())},onload:function(){return[]},onrender:function(){},onready:function(){},onsleep:function(){},onresume:function(){},ondestroy:function(){},onerror:function(e){console.log(e)},subscribe:_pubSubObject.subscribe,subscribeByPage:_pubSubObject.subscribeByPage,prioritySubscribe:_pubSubObject.prioritySubscribe};var controllerBase={__init:function(){var e=null,t=[];if(this.__isInited===!1){e=this.getEnvironment(),session=this.getSession();var n=this;activeController.push(this),fw.controller.__reg("_tapped_blocks",t,!0);var r=e.onload(),i=function(t){return t>=r.length?(e.setCallback(null),void 0):(e.setCallback(function(){i(++t)}),fw.sense.runSenseContext(function(e){return function(){fw.controller.__reg("_tapped_blocks",[],!0),e.call({}),n.__render(fw.controller._tapped_blocks)}}(r[t])),e.fireCallback(),void 0)};i(0),this.__render(),this.__isInited=!0}},__render:function(e){var t=this,n=e.widgetId,r=this.getEnvironment();if(r.withEnyo)return this.__renderEnyo(e),!0;if("undefined"==typeof _bindingMap[n]||void 0==t.__templateBlocks[n])return!1;var i=_bindingMap[n];if(i.isByPage){for(var o=queryElementsByTplId(n),s=e.page,a=_bindingMap[n].view_data[s],u=0,l=o.length;l>u;u++){var c=o[u];if(e.options.cleanExist)for(var f,p=c.querySelectorAll("[__page-unit-rendered-page]"),d=0,h=p.length;h>d;d++)f=p[d],f.parentNode.removeChild(f),f.innerHTML="";if(0==c.querySelectorAll("[__page-unit-rendered-page]").length){var g=t.__templateBlocks[n](a);g=g.replace(/tpl-role[\s]*=[\s]*['"]page_unit['"]/,'__page-unit-rendered-page="'+s+'"'),c.innerHTML=g}else{var _=document.createElement("div");_.innerHTML=t.__templateBlocks[n](a);var m,v=_.querySelector('[tpl-role="page_unit"]');m=null==v?_:v,m.removeAttribute("tpl-role"),m.setAttribute("__page-unit-rendered-page",s);var b;if(b=c.querySelector('[__page-unit-rendered-page="'+s+'"]'))b.innerHTML=m.innerHTML;else{m.innerHTML=m.innerHTML.replace(/tpl-role[\s]*=[\s]*['"]page_unit['"]/,'__page-unit-rendered-page="'+s+'"');var y=c.querySelectorAll("[__page-unit-rendered-page]");b=y[y.length-1],b.parentNode.insertBefore(m,b.nextSibling)}c.innerHTML=c.innerHTML+" "}}var S=_bindingMap[n].eventMap;for(var u in S)S[u]()}else{for(var a=_bindingMap[n].view_data,o=queryElementsByTplId(n),u=0,l=o.length;l>u;u++){var c=o[u];c.innerHTML=t.__templateBlocks[n](a)}var S=_bindingMap[n].eventMap;for(var u in S)S[u]();var w=null;doRenderByRelation(t.__templateRelation,function(e,t){e==n&&(w=t)}),doRenderByRelation(w,function(e){if(_bindingMap[e]){for(var n=_bindingMap[e].view_data,r=queryElementsByTplId(e),i=0,o=r.length;o>i;i++){var s=r[i];s.innerHTML=t.__templateBlocks[e](n)}var a=_bindingMap[e].eventMap||{};for(var u in a)a[u]()}})}return!0},__renderEnyo:function(e){var t=session.get("enyoapp");if(!t)return console.log("__renderEnyo -> no enyoapp detacted!"),!1;if(!e){var n=document.getElementById("view/blank@@content");return t.renderInto(n),void 0}var r=e.widgetId,i=r.split(".").pop(),o=_bindingMap[r].eventMap;t.$[i].destroyClientControls(),t.$[i].fwdata=_bindingMap[r].view_data.fwdata,t.$[i].fwdataChanged(),t.$[i].render();for(var s in o)o[s]()},__refresh:function(){var e,t,n=this.__getID(),r=n.split("!");1===r.length&&r.push(""),e=findController(r[0]),e!==!1&&(this.destroy(!0,!0),t=new MainController(n,fw.utils.uriParamToMap(r[1]),e),t.__init())},destroy:function(e,t){var n=this.__getID(),r=this.__UK,i=this.getSession(),o=this.getEnvironment();!cloneDom&&"undefined"!=typeof this.getDom&&t&&_cloneDom(this);try{o.ondestroy()}catch(s){}if(fw.render.clearTplContent(i),e!==!0?fw.session.destroy(i):i.cleanObserver(),o.__destroy(),fw.render.delTpl(this.tplName),this.__subControllerList)for(var a in this.__subControllerList)this.__subControllerList[a].destroy();for(var a in _bindingMap)0===a.indexOf(r)&&(fw.utils.cleanObj(_bindingMap[a].view_data),fw.utils.cleanObj(_bindingMap[a].eventMap),fw.utils.cleanObj(_bindingMap[a]),delete _bindingMap[a]);this.getSession=null,this.getEnvironment=null,this.__getIdentifier=null,delete this.getSession,delete this.getEnvironment,delete this.__getIdentifier;var u=activeController;activeController=u.filter(function(e){return e.__getID()!==n}),u.length=0,SUMERU_APP_FW_DEBUG&&console.log('destory ["'+n+'"]')}},SubControler=function(e,t,n,r){var i,o,s=this;i=new _Environment,o=fw.session.create(e),o.bind=_bindingData,o.event=_bindingEvent,o.eventMap=fw.event.mapEvent,o.__isSubController=!0,o.getMain=function(){return n.session},i.isReady=function(){return!1},i.show=function(){throw"this controller not ready"},i.hide=function(){throw"this controller not ready"},i.destroy=function(){s.destroy()},i.__UK=o.__UK=this.__UK="T"+fw.utils.randomStr(10),this.getSession=function(){return o},this.getEnvironment=function(){return i},this.__getID=function(){return e},this.__isFirstRender=!0,this.__isInited=!1,this.__templateBlocks=!1,this.__templateRelation=!1,r(i,o,t,n),i.__getControllerInstance=function(){return s},SUMERU_APP_FW_DEBUG&&console.log("create new : "+e)};SubControler.prototype=fw.utils.extendFrom(controllerBase,{__render:function(e){var t=this,n=t.getEnvironment(),r=t.getSession(),i=null;n.onrender(function(o,s,a){r.__currentTplName=o;var u,l={position:"absolute",top:0,left:0,width:"100%",height:70,display:"none"};i="undefined"!=typeof a?a:null;var c=function(){if("undefined"==typeof e){var o=fw.render.buildRender(r);t.__templateBlocks=o.renderBlock,t.__templateRelation=o.blocksRelation,u=fw.render.getTplContent(r),fw.utils.setStyles(u,fw.utils.cpp(l,s)),doRenderByRelation(t.__templateRelation,function(e){for(var n=queryElementsByTplId(e),r=0,i=n.length;i>r;r++){var o=n[r];o.innerHTML=t.__templateBlocks[e]({})}}),n.show=function(e){fw.transition._subrun({dom:u,anim:e||i},!1),!i&&e&&(i=e)},n.hide=function(e){fw.transition._subrun({dom:u,anim:e||i},!0)},n.setPosition=function(e){fw.utils.setStyles(u,e)},n.isReady=function(){return!0},r.toBeCommited.length=0,n.onready(u),t.__isFirstRender=!1}else{if(!e.length)return;if(t.__isFirstRender)return setTimeout(function(){t.__render(e)},50),void 0;for(var a=0,c=e.length;c>a;a++)controllerBase.__render.call(t,e[a])}};fw.render.getTpl(o,r,function(){t.tplName=o,c()})})}});var MainController=function(e,t,n){var r,i,o=this;r=new _Environment,i=fw.session.create(e),i.bind=_bindingData,i.bindByPage=_bindingDataByPage,i.event=_bindingEvent,i.eventMap=fw.event.mapEvent,r.callSubController=function(e,t,n){return o.__callSubController(e,t,n)},r.__UK=i.__UK=this.__UK="T"+fw.utils.randomStr(10),i.__isSubController=!1,this.getSession=function(){return i},this.getEnvironment=function(){return r},this.__getID=function(){return e},this.__isFirstRender=!0,this.__isInited=!1,this.__templateBlocks=!1,this.__subControllerList={},n(r,i,t),r.__getControllerInstance=function(){return o},SUMERU_APP_FW_DEBUG&&console.log("create new : "+e)};MainController.prototype=fw.utils.extendFrom(controllerBase,{__render:function(e){var t=this,n=t.getEnvironment(),r=t.getSession();n.onrender(function(i,o){r.__currentTplName=i;var s,a=function(){if("undefined"==typeof e){var a=fw.render.buildRender(r);t.__templateBlocks=a.renderBlock,t.__templateRelation=a.blocksRelation,s=fw.render.getTplContent(r),doRenderByRelation(t.__templateRelation,function(e){for(var n=queryElementsByTplId(e),r=0,i=n.length;i>r;r++){var o=n[r];o.innerHTML=t.__templateBlocks[e]({})}}),t.__transition(i,o,function(){r.toBeCommited.length=0,n.onready(s)}),n.withEnyo&&t.__isFirstRender&&controllerBase.__renderEnyo(),t.__isFirstRender=!1}else{if(!e.length)return;if(t.__isFirstRender)return setTimeout(function(){t.__render(e)},50),void 0;for(var u=0,l=e.length;l>u;u++)controllerBase.__render.call(t,e[u])}};fw.render.getTpl(i,r,function(){a()
})})},__callSubController:function(e,t,n){var r=findController(e),i=this.__lastTransitionIn;if(r!==!1){var o,s,a=this.getEnvironment(),u="__subFrom/"+this.__getID()+"/"+e,l={session:this.getSession(),env:fw.utils.getProxy(a,["redirect","refresh"]),tplContent:i};if(!r)throw"can not find a sub controller";return s=this.__subControllerList[u],s&&"undefined"!=typeof n&&n&&s.destroy(),(s=this.__subControllerList[u])||(s=new SubControler(u,t,l,r),this.__subControllerList[u]=s,o=s.getEnvironment(),o.onready=function(e,t){return function(){e.apply(this,arguments),t&&t.apply({},arguments)}}(o.onready,t.oncreated),o.ondestroy=function(e,t,n,r){return function(){try{e.apply(this,arguments),t&&t()}catch(i){console.error(i)}finally{n.__subControllerList[r]=null,delete n.__subControllerList[r]}}}(o.ondestroy,t.ondestroy,this,u),o.onerror=function(e,t){return function(){e.apply(this,arguments),t&&t.apply({},arguments)}}(o.onerror)),s.__init(),fw.utils.getProxy(s.getEnvironment(),["show","hide","setPosition","isReady","destroy"])}},__transition:function(e,t,n){var r,i,o;this.urlToTplHistory=this.urlToTplHistory||{};var s=this.__getID(),a=this.getSession(),u=a.__hashKey.sort(),l={};if(u.forEach(function(e){l[e]=a.get(e)},u),s+=JSON.stringify(l),e||""===e)this.urlToTplHistory[s]=e,r=fw.render.getTplContent(a);else if(e=this.urlToTplHistory[s],r=e||""==e?fw.render.getTplContent(a):this.__lastTransitionIn,!r)return!1;return(o=fw.historyCache.hitUrl([s,t||this.__lastTransitionType],globalIsforce))&&(transitionOut=o[1]),i=fw.transition._run({dom:r,cloneDom:cloneDom,transitionOut:transitionOut,anim:t||this.__lastTransitionType,callback:{load:n||function(){}}}),transitionOut=!1,cloneDom=null,i||(n||function(){})(),this.__lastTransitionType=t||this.__lastTransitionType,this.__lastTransitionIn=r,!0},getDom:function(){return fw.render.getTplContent(this.getSession())}}),_controller.__reg("create",function(e){return e});var findController=_controller.__reg("findController",function(path){for(var routeMap=fw.router.getAll(),pattern,find,i=routeMap.length-1;i>=0;i--)if(pattern=new RegExp("^"+routeMap[i].path+"$"),""==routeMap[i].path&&""==path||""!==routeMap[i].path&&pattern.test(path)===!0){if(find=eval(routeMap[i].action))return find;throw"find a controller ["+path+"], but undefined."}for(var externalProcessors=sumeru.router.externalProcessor.getAll(),processor,i=0,l=externalProcessors.length;l>i;i++)if(processor=externalProcessors[i],!0===processor(path))return!1;if("undefined"!=typeof SUMERU_DEFAULT_CONTROLLER)return eval(SUMERU_DEFAULT_CONTROLLER);throw"Can NOT find a controller ["+path+"]"},SUMERU_APP_FW_DEBUG?!1:!0),_testReusing=function(e,t){var n=e.__getID();return 0==n.indexOf(t+"!")},dispatch=_controller.__reg("dispatch",function(e,t,n){var r,i=e+"!"+("string"!=typeof t?"":t),o=null,s=!1;if(r=findController(e),r!==!1){console.log("dispatch "+i),globalIsforce=n;var a=null;for(var u in activeController){if(s=activeController[u],a=s.__getID(),a==i){o=s,(!o.__transition()||n)&&(o.destroy(),s=!1),SUMERU_APP_FW_DEBUG&&console.log("ROUTER FULL QUERY PATH : "+i);break}_testReusing(o=s,e)?activeControllerId===e?(o.destroy(!1,!0),s=!1,SUMERU_APP_FW_DEBUG&&console.log("ROUTER SAME QUERY PATH: "+i)):(!o.__transition()||n)&&(o.destroy(),s=!1,SUMERU_APP_FW_DEBUG&&console.log("ROUTER FULL QUERY PATH: "+i)):(s=!1,SUMERU_APP_FW_DEBUG&&console.log("ROUTER NOT MATCH : "+i))}s||(o=new MainController(i,fw.utils.uriParamToMap(t),r)),activeControllerId=e,o.__init()}},SUMERU_APP_FW_DEBUG?!1:!0);_controller.__reg("reactiveRender",function(e){activeController.forEach(function(t){t.__render(e)})})}(sumeru),function(e){var t=e.addSubPackage("render"),n={},r="main_tpl";tplContentToController={};var i={top:"",left:"",right:"",bottom:"",width:"",height:"",display:"",position:"",margin:"",padding:""},o=function(e){return"view/"+e},s=function(e){return o(e)+"@@content"},a=t.__reg("getTplContent",function(e){var t=s(e.__currentTplName);return e.__isSubController&&(t=e.__UK+"_"+t),document.getElementById(t)});t.__reg("clearTplContent",function(t){var n=a(t);if(n)if(n.innerHTML="",t.__isSubController){var r=t.__UK+"_",s=r+o(t.__currentTplName);tplContentToController[s]=null,delete tplContentToController[s],n.parentElement.removeChild(n)}else e.utils.setStyles(n,i)}),t.__reg("buildRender",function(t){var n,i=t.__currentTplName,a=t.__isSubController,u=t.__UK+"_",l=o(i),c=(a?u:"")+l,f=(a?u:"")+s(i),p=t.__getId(),d=null;void 0===tplContentToController[c]&&(tplContentToController[c]={type:r,domId:"",usering:[]});var h=tplContentToController[c];h.type=t.__isSubController?t.getMain().__getId():r,h.domId=f,-1==h.usering.indexOf(p)&&h.usering.push(p),h.usering.length>1&&e.controller.findAndDestroy(h.usering,p);var h={tplContent:null,renderBone:null,renderBlock:{},blocksRelation:{}};d=t.__isSubController?s(t.getMain().__currentTplName):"Runtime@@Wrapper",(n=document.getElementById(f))||(n=document.createElement("section"),n.id=f,document.getElementById(d).appendChild(n));var g=/(<[\s]*block[^>]+tpl-id=['"])(.+)(['"][^>]*>)/gm,_=document.createElement("div"),m=document.getElementById(l).innerHTML;m=m.replace(g,function(e,t,n,r){var i=t+u+n+r;return i});var v={},b=/(<[\s]*block[^>]+tpl-id=['"]([^'"\s]+)['"][^>]*>)([\s\S]*)/im,y=/<[\s]*\/[\s]*block[\s]*>/im,S=/(<[\s]*\/[\s]*block[\s]*>)[\s\S]+/im;m+=" ";var w=m,E=[v],T=function(){for(var e,t,n,r,i,o;e=w.match(b);){if(i=e[2],n=e[1].length,t=w.indexOf(e[1]),r=w.search(y),-1==r&&(r=w.length),t>r)return;var s=E[E.length-1];if(s[i]={},w=w.substr(t+n),r-=t+n,o=w.search(b),E.push(s[i]),-1!=o&&r>o){T(s[i]),E.pop();var a=w.match(S);if(a){var u=w.search(S),l=a[1].length;w=w.substr(u+l);var c=new RegExp("<[\\s]*block[^>]+tpl-id=['\"]"+i+"['\"][^>]*>([\\s\\S]+)<[\\s]*/[\\s]*block[\\s]*>"+Library.string.escapeRegex(w)+"$","mi"),f=m.match(c);f&&(h.renderBlock[i]=Handlebars.compile(f[1]))}}else{E.pop(),h.renderBlock[i]=Handlebars.compile(w.substr(0,r));var a=w.match(S);if(a){var u=w.search(S),l=a[1].length;w=w.substr(u+l)}}}};T(),delete E,h.blocksRelation=v,_.innerHTML=m;var k=_.getElementsByTagName("block");for(var M in k){var I=k[M];1==I.nodeType&&I.getAttribute("tpl-id")&&h.renderBlock[I.getAttribute("tpl-id")]&&(I.innerHTML="")}var C=h.renderBone=Handlebars.compile(_.innerHTML);return _=null,n.innerHTML=C({}),h},!0),t.__reg("getTplStatus",function(e){var t=o(e);return n[t]}),t.__reg("delTpl",function(e){var t=o(e);delete n[t]}),t.__reg("getTpl",function(e,t,r){var i=o(e);if(t.__UK+"_","undefined"!=typeof n[i]){if("loaded"==n[i])r();else if("loading"==n[i]){var s=function(){"loaded"==n[i]?r():setTimeout(function(){s()},500)};s()}}else{var a=Library.net;n[i]="loading",a.get({url:sumeru.config.view.get("path")+i+".html",callback:function(e){n[i]="loaded";var t=document.createElement("script");t.id=i,t.type="text/x-sumeru-template",t.innerHTML=e,document.getElementById("Runtime@@Wrapper").appendChild(t),r()}})}},!0)}(sumeru),Library="undefined"==typeof Library?{}:Library;var runnable=function(fw){fw.addSubPackage("Library");var createLibrary=function(e){var t={};return e.call(this,t),t},loadLibrary=function(name){var library=eval(name);if("undefined"==typeof library)throw"Error finding the library "+name};fw.Library.__reg("create",createLibrary),fw.Library.__reg("load",loadLibrary)};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru);var runnable=function(e){Library.objUtils=e.Library.create(function(e){var t=e.isPlainObject=function(e){if(!e||"object"!==r(e)||e.nodeType||e===e.window)return!1;try{if(e.constructor&&!Object.prototype.hasOwnProperty.call(e,"constructor")&&!Object.prototype.hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}var n;for(n in e);return void 0===n||Object.prototype.hasOwnProperty.call(e,n)},n={};"Boolean Number String Function Array Date RegExp Object".split(" ").forEach(function(e){n["[object "+e+"]"]=e.toLowerCase()});var r=function(e){return null==e?"null":n[Object.prototype.toString.call(e)]||"object"},i=(e.isObject=function(e){return"object"===r(e)},e.isArray=function(e){return"array"===r(e)}),o=e.isFunction=function(e){return"function"===r(e)},s=(e.isString=function(e){return"string"===r(e)},e.isBoolean=function(e){return"bollean"===r(e)},e.isNumber=function(e){return"number"===r(e)},e.isDate=function(e){return"date"===r(e)},e.isRegExp=function(e){return"regexp"===r(e)},e.extend=function(){var e,n,r,a,u,l,c=arguments[0]||{},f=1,p=arguments.length,d=!1;if("boolean"==typeof c&&(d=c,c=arguments[1]||{},f=2),"object"==typeof c||o(c)||(c={}),p===f)return c;for(;p>f;f++)if(null!=(e=arguments[f]))for(n in e)r=c[n],a=e[n],c!==a&&(d&&a&&(t(a)||(u=i(a)))?(u?(u=!1,l=r&&i(r)?r:[]):l=r&&t(r)?r:{},c[n]=s(d,l,a)):void 0!==a&&(c[n]=a));return c});return e})};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru),function(e){e.addSubPackage("oquery");var t={};t.OPERATORS=[["=",">=",">","<=","<","!=","LIKE","IN","FUNC"],["AND"],["OR"]],t.OPENOPERATORS=["=",">=",">","<=","<","!=","LIKE","IN"],t.isUnitOp=function(e){return t.OPERATORS[0].indexOf(e)>=0},t.query=function(e,n){var r,i=!1;for(op in n)if(t.isUnitOp(op))if("FUNC"==op){var o=n[op];o instanceof Function?i=t.unitOp(op,o,e):(i=!1,console.error("value is not a function."))}else i=t.unitOp(op,e.get(n[op].key),n[op].value);else if(r=n[op],"AND"==op){i=!0;for(var s=0,a=r.length;a>s&&(i=t.query(e,r[s])&&i,i);s++);}else if("OR"==op)for(var s=0,a=r.length;a>s&&!(i=t.query(e,r[s])||i);s++);return i},t.unitOp=function(e,t,n){var r=!1;switch(e){case"=":t===n&&(r=!0);break;case">=":t>=n&&(r=!0);break;case">":t>n&&(r=!0);break;case"<=":n>=t&&(r=!0);break;case"<":n>t&&(r=!0);break;case"!=":t!=n&&(r=!0);break;case"LIKE":(t+"").indexOf(n)>=0&&(r=!0);break;case"IN":n.indexOf(t)>=0&&(r=!0);break;case"FUNC":r=!!t.call(this,n);break;default:r=!1,console.error("unit operator not support.")}return r},e.oquery.__reg("_query",t.query,"private"),e.oquery.__reg("_queryop",t.OPENOPERATORS,"private")}(sumeru);var runnable=function(e){e.addSubPackage("validation");var t=t||{};t.copyArgs=function(e){for(var t=[],n=0,r=e.length;r>n;n++)t.push(e[n]);return t},t.validations={},t.getErrorMsg=function(e,n,r){console.log(JSON.stringify(arguments));var i="";if(t.validations[r]&&t.validations[r].msg){i=Library.objUtils.isNumber(e)&&e>=0?t.validations[r].msg[e]:t.validations[r].msg,i=i.replace("$1",n);for(var o=2,s=arguments.length;s>o;o++)i=i.replace("$"+(o-1),arguments[o])}return i},t.unitValidation=function(e,n,r,i,o,s,a){var u=!0,l="";if(Library.objUtils.isFunction(o))u=o.call(this,i);else if(Library.objUtils.isRegExp(o))u=o.test(i);else if(Library.objUtils.isString(o)){var c=t.validations[o];if(c){if(c.runat.indexOf(e)<0&&"both"!=c.runat)return!1;if(c.regexp)u=new RegExp(c.regexp).test(i);else if(c.func){var f=t.copyArgs(arguments);f.splice(0,5,i),u=c.func.apply(this,f)}else if(c.asyncFunc)return c.asyncFunc.call(this,s,r,i,a),"asyn"}}if(!u||Library.objUtils.isNumber(u)&&u>=0){var f=t.copyArgs(arguments);f.splice(0,5,u,n,o),l=t.getErrorMsg.apply(this,f),u={value:u,msg:l}}else u=!1;return u},t.clientValidation=function(){var e=t.copyArgs(arguments);return e.unshift("client"),t.unitValidation.apply(this,e)},t.serverValidation=function(){var e=t.copyArgs(arguments);return e.unshift("server"),t.unitValidation.apply(this,e)},t.isAsynVali=function(e){return"undefined"!=typeof t.validations[e]&&"undefined"!=typeof t.validations[e].asyncFunc},t.addRule=function(e,n){t.validations[e]=n},e.validation.__reg("addrule",t.addRule,"publish"),e.validation.__reg("_svalidation",t.serverValidation,"private"),e.validation.__reg("_cvalidation",t.clientValidation,"private"),e.validation.__reg("_getvalidationmsg",t.getErrorMsg,"private"),e.validation.__reg("_isasynvali",t.isAsynVali,"private")};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru);var runnable=function(e){e.validation.addrule("length",{runat:"both",func:function(e,t,n){var e=e+""||"",r=e.length;return r>parseInt(n)?r<parseInt(t)?0:1:r<parseInt(t)?2:-1},msg:["$1长度不能大于$3，且不能小于$2。","$1长度不能大于$3。","$1长度不能小于$2。"]}),e.validation.addrule("minlength",{runat:"both",func:function(e,t){var e=e+""||"",n=e.length;return n>parseInt(t)},msg:"$1长度不能小于$2。"}),e.validation.addrule("maxlength",{runat:"both",func:function(e,t){var e=e+""||"",n=e.length;return n<parseInt(t)},msg:"$1长度不能大于$2。"}),e.validation.addrule("required",{runat:"both",func:function(){var e=e+""||"",t=e.length;return t>0},msg:"$1为必填项。"}),e.validation.addrule("number",{runat:"both",regexp:"^[0-9]+$",msg:"$1必须为数字。"}),e.validation.addrule("telephone",{runat:"both",regexp:"^(0[0-9]{2,3}-)?([2-9][0-9]{6,7})+(-[0-9]{1,4})?$",msg:"$1必须为电话号码格式。"}),e.validation.addrule("mobilephone",{runat:"both",regexp:"(^0?[1][358][0-9]{9}$)",msg:"$1必须为手机号码格式。"}),e.validation.addrule("email",{runat:"both",regexp:"^[a-zA-Z0-9_.-+]+@([a-zA-Z0-9-]+.)+[a-zA-Z0-9]{2,4}$",msg:"$1必须为email格式。"}),e.validation.addrule("onlyletter",{runat:"both",regexp:"^[a-zA-Z]+$",msg:"$只能是字母。"}),e.validation.addrule("nospecialchars",{runat:"both",regexp:"^[0-9a-zA-Z]+$",msg:"$1不能包含特殊字符。"}),e.validation.addrule("date",{runat:"both",regexp:"^[0-9]{2,4}[/-]{1}[0,1]{0,1}[0-9]{1}[/-]{1}[0,3]{0,1}[0-9]{1}$",msg:"$1格式不正确。"}),e.validation.addrule("chinese",{runat:"both",regexp:"/^[一-龥]+$/",msg:"$1必须为中文。"}),e.validation.addrule("url",{runat:"both",regexp:"/^[a-zA-z]:\\/\\/[^s]$/",msg:"$1必须为URL。"}),e.validation.addrule("unique",{runat:"server",asyncFunc:function(e,t,n){var r={};r[t]=n,this.find(r).toArray(function(t,n){var r=!0;t?e.call(this,t):(n.length>0&&(r=!1),e.call(this,t,r))})},msg:"$1不能重复。"})};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru),Model="undefined"==typeof Model?{}:Model;var fw=fw||{};"undefined"!=typeof module&&module.exports&&(module.exports=function(e){fw=e}),function(fw){fw.addSubPackage("model"),fw.model.__reg("models",[]);var modelTools={defineProperty:function(e){Object.defineProperty(this,e,{get:function(){return this.__smr__.dataMap[e]},set:function(t){t!=this.__smr__.dataMap[e]&&(this.__smr__.dataMap[e]=t,this._setDirty())}})},setDefineProperties:function(e,t,n,r,i){var n=n||!1,r=r||!1,i=i||!1;if("undefined"!=typeof Object.defineProperty)for(var o in t)Object.defineProperty(e,o,{value:t[o],configueable:n,writable:r,enumerable:i});else for(var o in t)e[o]=t[o]}},modelBaseProto={_isModel:!0,_idField:"smr_id",_clientIdField:"__clientId",_isClean:function(){return!this.__smr__.isDirty&&!this.__smr__.isPhantom},_isDeleted:function(){return this.__smr__.isDeleted},_setDirty:function(e){e="undefined"==typeof e?!0:e,this.__smr__.isDirty=!!e},_setDeleted:function(e){e="undefined"==typeof e?!0:e,this.__smr__.isDeleted=!!e},_setPhantom:function(e){e="undefined"==typeof e?!0:e,this.__smr__.isPhantom=e,this.set(this._idField,0),this.set(this._clientIdField,fw.__random())},_setModelChain:function(e,t){this.__smr__.modelchain=e.slice(0),this.__smr__.modelchain.push(t)},_getModelChain:function(){return this.__smr__.modelchain},_delete:function(e){this.__smr__.dataMap[e]=void 0},_clean:function(){if(this.__smr__.isDirty=!1,this.__smr__.isDeleted=!1,this.__smr__.isPhantom=!1,key in this._fieldsMap){var e=this._fieldsMap[key],t=e.type;"model"===t&&this[key]._clean()}},_getModelName:function(){return this._modelName},_baseSet:function(e,t){this.__smr__.dataMap[e]=t},_set:function(e,t,n){if(e in this._fieldsMap){var r=this._fieldsMap[e],i=r.type;if("model"===i){var o=r.model,s=r.relation;if("many"===s)if(t._isCollection)t._getModelName()===o?this._baseSet(e,t):console.log("model.set arguments format error");else{this[e]._isCollection?this[e].truncate():this._baseSet(e,fw.collection.create({modelName:o}));for(var a,u=0,l=t.length;l>u;u++)a=t[u]._isModel?t[u]:fw.model.create(o,t[u]),this[e].add(a)}else t._isModel?t._getModelName()===o?this._baseSet(e,t):console.log("model.set arguments format error"):this._baseSet(e,fw.model.create(o,t))}else{if(this[e]===t)return this;this[e]=t,e==this._idField&&0!=t&&(this.__smr__.isPhantom=!1)}this._setDirty(n)}return this},_setData:function(e,t){var e=e||{};for(var n in e)this._set(n,e[n],t);this._setDirty(t)},set:function(e,t){var n,r=arguments.length;if(1==r){if(n=arguments[0],Library.objUtils.isObject(n))for(var i in n)this._set(i,n[i],!0)}else 2==r&&this._set(e,t,!0)},_setPilotId:function(e){this.__smr__.pilotid=e},_getPilotId:function(){return"undefined"==typeof this.__smr__.pilotid?!1:this.__smr__.pilotid},_setStorable:function(){fw.msgpilot.setPilot(this)},toJSON:function(){var e={};for(key in this.__smr__.dataMap)e[key]=this._fieldsMap[key]&&"model"==this._fieldsMap[key].type?this.__smr__.dataMap[key].toJSON():this.__smr__.dataMap[key];return e},_takeSnapshot:function(){this.__smr__.dataMapSnapshot=fw.model._extend({},this.__smr__.dataMap)},_getSnapshot:function(){return this.__smr__.dataMapSnapshot},get:function(e){return this.__smr__.dataMap[e]},getId:function(){return this.__smr__.dataMap[this._idField]},getData:function(){return this.toJSON()},destroy:function(){this.__smr__.isDeleted=!0,this._setDirty()},validation:function(e){if(!fw.config.get("clientValidation"))return!0;var t,n,r,i=[],o=function(e,t,n){var r={};return r.key=e,r.value=t,r.msg=n.msg,r},s=function(e,t,n){var r={};return r.key=e+"."+n.key,r.value=n.value[0],r.msg=n.msg,r},a=function(e){var t=e.label||e.name,a=e.validation,u=(e.validationMsg,e.type),l=this[e.name],c=e.name;if(a){n=Library.objUtils.isString(a)?a.split("|"):[a];for(var f=0,p=n.length;p>f;f++){var d=new RegExp("([min,max]*length)\\[([0-9]+)[\\,]*([0-9]*)\\]").exec(n[f]);if(d){if(d.length>=3){d.shift(),d.unshift(l),d.unshift(c),d.unshift(t);var h=fw.validation.__load("_cvalidation").apply(this,d);h&&i.push(o(c,l,h))}}else{var h=fw.validation.__load("_cvalidation").call(this,t,c,l,n[f]);h&&i.push(o(c,l,h))}}}else if("model"==u)for(var g=l.validation(),_=0,m=g.length;m>_;_++)r=s(c,l,g[_]),i.push(r)};if("undefined"!=typeof e)a.call(this,this._fieldsMap[e]);else for(var u in this._fieldsMap)t=this._fieldsMap[u],a.call(this,t);var l=!1;return 0===i.length&&(l=!0),this.onValidation&&this.onValidation.call(this,l,"client",i),i},_save:function(e,t,n,r){var n=n||this._getPilotId();if(t||n||(this._setStorable(),n=this._getPilotId()),!r){var i=this.validation();if(i.length>0)return i}e=e||function(){};var o,s;r?(s=this,o=s.__smr_assist__.__sourcePointer[0]):(o=this,s=fw.model._extend(createModel(this._getModelName()),o),s.__smr_assist__.__extendPointer=o,s.__smr_assist__.__pkgId=fw.__random());var a=!1,u=s.__smr__.dataMap,l=!1,c=function(e){for(var r in u)if(u[r]&&u[r]._isCollection){for(var i=0,o=u[r].length;o>i;i++)if(u[r].get(i)&&u[r].get(i)._isModel){if(u[r].get(i)._isClean())continue;if(u[r].get(i).getData().isReference)continue;return}}else if(u[r]&&u[r]._isModel&&!u[r]._isClean()&&!u[r].getData().isReference)return;if(!l){l=!0;var a=function(t){e.call(s,t)};s._proxy.save(s,a,t,n,s._getModelChain().join("."))}},f=function(r){var r=r;return r._isClean()?(r.__smr__.dataMap={isReference:!0,val:"::referenceID::"+r._getModelName()+"::"+r.getId()},void 0):(a=!0,r._save(function(t){return function(n){var r=n.cnt.smr_id;t.__smr_assist__.__sourcePointer[0].set(t._idField,r),t.__smr_assist__.__sourcePointer[0]._setDirty(!1),t.__smr__.dataMap={isReference:!0,val:"::referenceID::"+t._getModelName()+"::"+r},c(e)}}(r),t,n,!0),void 0)};for(var p in u)if(u[p]&&u[p]._isCollection){for(var d=0,h=u[p].length;h>d;d++)u[p].get(d)._isModel&&(u[p].get(d)._setModelChain(s._getModelChain(),p),f(u[p].get(d)));0===u[p].length}else u[p]&&u[p]._isModel&&(u[p]._setModelChain(s._getModelChain(),p),f(u[p]));return a||this._isClean()||c(e),!0},save:function(e,t,n){this._save(e,t,n,!1)},onValidation:function(){}},modelBase=function(){this._modelName="",this._dal={type:"live"},this._proxy={},this._fieldsMap={},this._fieldsMap[this._idField]={name:this._idField,type:"int"},this._fieldsMap[this._clientIdField]={name:this._clientIdField,type:"string"}};modelTools.setDefineProperties(modelBase.prototype,modelBaseProto,!1,!1,!0);var model=function(){this.__smr__={dataMap:{},dataMapSnapshot:{},isDirty:!1,isPhantom:!0,isDeleted:!1,modelchain:[]},this.__smr_assist__={__sourcePointer:null,__extendPointer:null}},getModelTemp=function(modelName){if("undefined"==typeof fw.model.models[modelName]){var exports={},modelDef=eval(modelName);modelDef.call(this,exports),modelDef=exports;var newModelTemp=new modelBase;if(newModelTemp._modelName=modelName,"undefined"!=typeof modelDef.config){for(var fields=modelDef.config.fields||[],oneField,i=0,l=fields.length;l>i;i++)oneField=fields[i],newModelTemp._fieldsMap[oneField.name]=oneField;var dal=modelDef.config.layer||newModelTemp._dal;newModelTemp._proxy=fw.__DAL.make(dal)}for(var key in modelDef)modelDef.hasOwnProperty(key)&&"config"!=key&&(newModelTemp[key]=modelDef[key]);fw.model.models[modelName]=newModelTemp}return fw.model.models[modelName]},createModel=function(modelName,dataMap){var modelTemp=getModelTemp(modelName),newModel=new model;newModel.__proto__=modelTemp;var _fieldsMap=modelTemp._fieldsMap,oneField;for(var p in _fieldsMap)if(oneField=_fieldsMap[p],modelTools.defineProperty.call(newModel,oneField.name),"model"===oneField.type&&"undefined"!=typeof oneField.model)if("undefined"!=typeof oneField.relation&&"many"==oneField.relation){var subCollection=fw.collection.create({modelName:oneField.model});newModel[oneField.name]=subCollection}else{var subModel=fw.model.create(oneField.model);newModel[oneField.name]=subModel}else newModel[oneField.name]="datetime"==oneField.type&&"now()"==oneField.defaultValue?fw.utils.getTimeStamp():"array"==oneField.type?eval(oneField.defaultValue)||[]:"object"==oneField.type?fw.utils.parseJSON(oneField.defaultValue)||[]:oneField.defaultValue||void 0;return newModel._setPhantom(),dataMap&&newModel._setData(dataMap,!1),newModel},extendModel=function(){var e,t,n,r,i,o,s,a,u=Library.objUtils,l=arguments[0]||{},c=1,f=arguments.length;if("object"==typeof l||u.isFunction(l)||(l={}),f===c)return l;for(;f>c;c++)if(null!=(e=arguments[c]))for(t in e)e.hasOwnProperty(t)&&"__smr_assist__"!=t&&(n=l[t],r=e[t],l!==r&&(r&&(u.isPlainObject(r)||(o=r._isCollection)||(s=r._isModel)||(i=u.isArray(r)))?(i?(i=!1,a=n&&u.isArray(n)?n:[]):o?(o=!1,a=n&&n._isCollection?n:fw.collection.create({modelName:r._getModelName()})):s?(s=!1,a=n&&n._isModel?n:fw.model.create(r._getModelName()),a.__smr_assist__.__sourcePointer=r.__smr_assist__.__sourcePointer||[],a.__smr_assist__.__sourcePointer.push(r)):a=n&&u.isPlainObject(n)?n:{},l[t]=extendModel(a,r)):void 0!==r&&(l[t]=r)));return l};fw.model.__reg("create",createModel),fw.model.__reg("_extend",extendModel),fw.model.__reg("_getModelTemp",getModelTemp)}(sumeru),function(e){function t(e){this.modelName=e,this.dataMap={}}function n(e){return a[e]||(a[e]=new t(e)),a[e]}function r(t,r){if(!s)return e.model.create(t,r);var i,o=n(t);return o.get(r.smr_id)?i=o.get(r.smr_id):(i=e.model.create(t,r),r.smr_id&&o.add(i)),i}function i(e,t){if(s)if(e&&t){var r=n(e);r.destroy(t)}else console.error("Please specify correct arugments.")}function o(e,t){if(s){var r=n(e);r.add(t)}}e.addSubPackage("modelPoll");var s=!0,a={};t.prototype={add:function(e){this.dataMap[e.smr_id]=e},destroy:function(e){this.dataMap[e.smr_id]?delete this.dataMap[e.smr_id]:console.log("Model",e,"had been destroyed.")},get:function(e){return this.dataMap[e]}},e.modelPoll.__reg("data",a),e.modelPoll.__reg("getModel",r),e.modelPoll.__reg("addModel",o),e.modelPoll.__reg("destroyModel",i)}(sumeru),function(e){e.addSubPackage("collection");var t={defineProperty:function(e){Object.defineProperty(this,e,{get:function(){return this.length>0?this[0][e]:void 0},set:function(t){for(var n=0,r=this.length;r>n;n++)this[n][e]=t}})}};collectionPrototype={_isCollection:!0,_setSynced:function(e){e="undefined"==typeof e?!1:e,this.__smr__.isSynced=!!e},_isSynced:function(){return this.__smr__.isSynced},_setNeedSort:function(e){e="undefined"==typeof e?!0:e,this.__smr__.isNeedSort=!!e},_takeSnapshot:function(){var e=this.find();e.forEach(function(e){e._takeSnapshot()})},_getModelName:function(){return this.__smr__.modelName},_setPilotId:function(e){this.__smr__.pilotid=e},_getPilotId:function(){return"undefined"==typeof this.__smr__.pilotid?!1:this.__smr__.pilotid},_setStorable:function(){e.msgpilot.setPilot(this)},setVersion:function(e){this.__smr__.version=e},getVersion:function(){return this.__smr__.version},_clean:function(){var e=this.find();e.forEach(function(e){e._clean()})},validation:function(){if(!e.config.get("clientValidation"))return!0;if(0==arguments.length){for(var t,n=[],r=0,i=this.length;i>r;r++){t=this[r];var o=t.validation();o!==!0&&(n=n.concat(o))}var s=!1;return 0===n.length&&(s=!0),this.onValidation&&this.onValidation.call(this,s,"client",n),s||n}},add:function(t){var n,r=this._getModelName();return t._isModel?t._getModelName()==r?n=t:console.log("collection.add arguments format error."):n=e.modelPoll.getModel(r,t),this.push(n),this._setSynced(!1),this._setNeedSort(),!0},update:function(e,t){var n=this.find.call(this,t);if(Library.objUtils.isObject(e)){for(var r=0,i=n.length;i>r;r++)n[r]._setData(e,!0);this._setSynced(!1),this._setNeedSort()}},remove:function(e){if(e._isModel)for(var t=0,n=this.length;n>t;t++)this[t]==e&&(this.splice(t,1),t--,n--,this._setNeedSort());else for(var r=this.find.apply(this,arguments),i=0,o=r.length;o>i;i++)for(var t=0,n=this.length;n>t;t++)this[t]==r[i]&&(this.splice(t,1),t--,n--,this._setNeedSort())},destroy:function(){for(var t=this.find.apply(this,arguments),n=0,r=t.length;r>n;n++)for(var i=0,o=this.length;o>i;i++)if(this[i]==t[n]){var s=this.splice(i,1);i--,o--,s[0].destroy(),this._setSynced(!1),this._setNeedSort(),e.modelPoll.destroyModel(this._getModelName(),s[0]),s[0].save(function(){},this.pubName,s[0]._getPilotId())}},setData:function(e){this.length=0;for(var t=0,n=e.length;n>t;t++)this.add(e[t]);this._setSynced(!1),this._setNeedSort()},_formatQuery:function(e){var e=e||[],t={};if(Library.objUtils.isArray(e)){t={AND:[]};for(var n=0,r=e.length;r>n;n++)t.AND.push(e[n])}else Library.objUtils.isObject(e)&&(t=this._formatUnitQuery(e));return t},_formatUnitQuery:function(t,n){if(Library.objUtils.isFunction(t))return{FUNC:t};if(Library.objUtils.isObject(t)){var r=[];for(var i in t){var o,s={},a=new RegExp("["+e.oquery.__load("_queryop").join(",")+"]+$"),u=i.replace(/^\s+|\s+$/g,""),l=a.exec(i);l&&l.length>0&&(u=u.replace(l[0]," "+l[0]),u=u.replace(/\s+/," "));var c=u.split(" ");o=2==c.length?c[1]:"=",s[o]={},s[o].key=c[0],s[o].value=t[i],r.push(s)}if(r.length>1){var n=n||"AND",f=r;r={},r[n]=f}else r=r[0];return r}},_addCondition:function(e,t,n){if("undefined"!=typeof t)if(2==t.length){var r={};r[t[0]]=t[1],e.push(this._formatUnitQuery(r,n))}else(Library.objUtils.isObject(t[0])||Library.objUtils.isFunction(t[0]))&&e.push(this._formatUnitQuery(t[0],n))},where:function(){return this._addCondition(this.__smr__.wheres,arguments,"AND"),this},orWhere:function(){return this._addCondition(this.__smr__.wheres,arguments,"OR"),this},_clearWheres:function(){this.__smr__.wheres.length=0},find:function(){var t=[];if(this.sortIt(),arguments.length>0&&this._addCondition(this.__smr__.wheres,arguments,"AND"),0==this.__smr__.wheres.length)return this;for(var n,r,i=0,o=this.length;o>i;i++)n=this[i],n._isDeleted()!==!0?(r=e.oquery.__load("_query")(n,this._formatQuery(this.__smr__.wheres)),1==r&&t.push(n)):(this.splice(i,1),i--,o--);return this._clearWheres(),t},pluck:function(e){if(!e)return[];for(var t=[],n=this.find(),r=0,i=n.length;i>r;r++)"undefined"!=typeof n[r][e]&&t.push(n[r][e]);return t},_oSort:function(e){var t=function(e,t,n){var r=0,i="undefined"!=typeof e.localeCompare,o="undefined"!=typeof t.localeCompare;switch(n){case"ASC":r=i?e.localeCompare(t):e-t;break;case"DESC":r=o?t.localeCompare(e):t-e;break;default:"function"==typeof n&&(r=n.call(this,e,t))}return r},n=function(e,r,i){var o,s,a,u,l=0;if(i.length>0)if("function"==typeof i[0])l=t.call(this,e,r,i[0]);else{a=i[0].key,u=i[0].value;var o=e.get(a),s=r.get(a);l=t.call(this,o,s,u),i.length>1&&0==l&&(i.shift(),l=n.call(this,e,r,i))}return l};return function(t,r){return n(t,r,e)}},_formatSorter:function(){var e="ASC",t=[];if(0!=arguments.length){if(1==arguments.length){var n=arguments[0];if(Library.objUtils.isFunction(n))t.push(n);else if(Library.objUtils.isObject(n))for(var r in n)(/^ASC|DESC$/.test(n[r])||Library.objUtils.isFunction(n))&&(e=n[r]),t.push({key:r,value:e});else t.push({key:n,value:e})}else/^ASC|DESC$/.test(arguments[1])&&(e=arguments[1]),t.push({key:arguments[0],value:e});return t}},addSorters:function(){this.__smr__.sorters=this.__smr__.sorters.concat(this._formatSorter.apply(this,arguments)),this._setNeedSort()},clearSorters:function(){this.__smr__.sorters.length=0,this._setNeedSort()},sortIt:function(){arguments.length>0&&this.addSorters.apply(this,arguments),0!=this.__smr__.sorters.length&&this.__smr__.isNeedSort&&(this.sort(this._oSort(this.__smr__.sorters)),this._setNeedSort(!1))},get:function(e){if(e=e||0,e>=this.length||0>e)return void 0;this.sortIt();var t=this[e];return t._isDeleted()===!0?(this.splice(i,1),this.get(i)):t},stringify:function(){return JSON.stringify(this)},toJSON:function(){var e=[];return this.find().forEach(function(t){e.push(t.getData())}),e},getData:function(){return this.toJSON()},save:function(t,n){if(this.__smr__.saveType=n?"ensure":"none",!t){var r=this.validation();if(r.length>0)return r;this.pubName||this._setStorable()}for(var i=0,o=this.length;o>i;i++)this[i].save(function(t){if("insert"===t.type){var n=this;n.set("smr_id",t.cnt.smr_id);var r="Model."+t.modelName;e.modelPoll.addModel(r,n)}},this.pubName,this._getPilotId(),!0);return n||this.render(),!0},ensureSave:function(){this.save(!1,!0)},rollback:function(){for(var e=0,t=this.length;t>e;e++){var n=this[e],r=n._getSnapshot();r.smr_id?n._setData(r):this.remove(n)}this._clean()},render:function(){"undefined"!=typeof this.pubName&&e.netMessage.sendLocalMessage({pubname:this.pubName,data:""},"data_write_latency")},truncate:function(){this.length=0},hold:function(){this.__smr__.isHolding=!0},releaseHold:function(){e.pubsub._releaseHold(this),this.__smr__.isHolding=!1},isEnsureSave:function(){return"ensure"===this.__smr__.saveType},onValidation:function(){}};var n=function(){var e=[];for(p in collectionPrototype)e[p]=collectionPrototype[p];return e},r=function(){return this.__smr__={sorters:[],isNeedSort:!1,wheres:[],isHolding:!1,modelName:"",dal:{type:"live"},isSynced:!1,saveType:"none",version:""},this};r.prototype=new n;var o=function(n,i){if("undefined"==typeof n.modelName)return!1;var o=new r,s=e.model._getModelTemp(n.modelName),a=s._fieldsMap;for(var u in a)t.defineProperty.call(o,a[u].name);o.__smr__.modelName=n.modelName,n.sorters&&(o.__smr__.sorters=n.sorters);var l=n.layer||o.__smr__.dal;return o.__smr__.proxy=e.__DAL.make(l),i&&o.setData(i),o};e.collection.__reg("create",function(e,t){var n=o(e,t);return n._setStorable(),n}),e.collection.__reg("_create",function(e,t){return o(e,t)})}(sumeru);var fw=fw||{};!function(e){e.__DAL={};var t=Library.objUtils,n=function(n){var r=n.getData(),i=n._getSnapshot(),o="",s={};for(var a in i)if(i[a]._isCollection)for(var u=0,l=i[a].length;l>u;u++)i[a].get(u)._isModel&&(i[a].get(u).dataMap={isReference:!0,val:"::referenceID::"+i[a].get(u)._getModelName()+"::"+i[a].get(u).getId()});else i[a]._isModel&&(i[a].dataMap={isReference:!0,val:"::referenceID::"+i[a]._getModelName()+"::"+i[a].getId()});if(r[n._idField])if(n._isDeleted())o="delete",s[n._idField]=r[n._idField];else{o="update";for(var u in r){if(!i[u]||!r[u]._isCollection&&i[u]!=r[u]||(r[u]._isCollection||r[u]._isModel)&&JSON.stringify(r[u])!=JSON.stringify(i[u])){if(u===n._idField||u===n._clientIdField)continue;s[u]=r[u]}s[n._idField]=i[n._idField]||r[n._idField]}}else o="insert",s=e.model._extend({},r),s[n._idField]=e.__load("__ObjectId")(),n.__smr_assist__.__extendPointer&&n.__smr_assist__.__extendPointer.set(n._idField,s[n._idField]);
for(var a in s)t.isObject(s[a])&&s[a]._isCollection&&0===s[a].length&&delete s[a];return n._setDirty(!1),n.__smr_assist__.__extendPointer&&n.__smr_assist__.__extendPointer._setDirty(!1),{type:o,modelName:n._getModelName().replace(/Model\./,""),cnt:s}};e.__DAL.make=function(e){var t=e.type.toLowerCase();if(r[t]){var i=new r[t];i.config=e;var o=i.save;return i.save=function(e,t,r,i,s){var a=n(e);o(a,t,r,i,s)},i}};var r={};r.live=function(){this.proxyid=e.__random()},r.live.prototype={save:function(t,n,r,i,o){"undefined"!=typeof r||"undefined"!=typeof i?(r&&(i=""),e.netMessage.sendMessage({pubname:r,pilotid:i,modelchain:o,data:t},"data_write_from_client",function(e){console.log("Err : data_write_from_client "+e)},function(){}),n(t)):n(t)}},r.network=function(){this.proxyid=e.__random()},r.network.prototype={save:function(e,t){var n=this.config.url;console.log("network layer saving : ",n+" ",e);var r=e.id;t(r)},get:function(){},load:function(e,t){var n=[];t(n)}},r.localstorage=function(){this.proxyid=e.__random()},r.localstorage.prototype={save:function(e){console.log("localstorage layer saving : "+e)},get:function(){}},r.memory=function(){this.proxyid=e.__random(),this.data={},r.memory.manager[this.proxyid]=this},r.memory.manager={},r.memory.manager.resolveRef=function(e,t){var n=/::referenceID::(.*)::(.*)/,i=e.match(n);t(r.memory.manager[i[2]].get())},r.memory.prototype={save:function(e,t){return this.data=e,console.log("memory layer save done",e),t(this.proxyid),!0},get:function(){return this.data},load:function(e,t){var n={};t(n)}}}(sumeru),function(e){function t(e,t){for(var n,r,i=0,o=t.length;o>i;i++)if(n=t[i].type,r=t[i].cnt,"insert"==n)for(var s in r)e[s]=r[s];else if("update"==n)for(var s in r)e[s]=r[s];else if("delete"==n)for(var s,a=r.length;a>s;s++)e[s]=void 0}function n(i,o){for(var s,a,u,l,c,f=i._modelName,p=e.model._getModelTemp(f)._fieldsMap,d=0,h=o.length;h>d;d++)if(s=o[d].type,a=o[d].cnt,"insert"==s)for(var g in a)if(u=p[g].type,"model"==u)if(l=p[g].model,c=p[g].relation,"many"==c){var _=e.collection.create({modelName:l},a[g]);i._baseSet(g,_)}else subModel=e.model.create(l,a[g]),i._baseSet(g,subModel);else i._baseSet(g,a[g]);else if("update"==s)for(var g in a)u=p[g].type,"model"==u?(l=p[g].model,c=p[g].relation,"many"==c?r(i[g],a[g]):n(i[g],a[g])):"array"==u?i._baseSet(g,a[g]):"object"==u?t(i[g],a[g]):i._baseSet(g,a[g]);else if("delete"==s)for(var m=0,v=a.length;v>m;m++)i._delete(a[m])}function r(e,t,r){for(var i=!1,o=0,s=t.length;s>o;o++){var a=t[o];if("insert"==a.type){var u=a.cnt,l=e.find({smr_id:u.smr_id});l.length?i=!1:(e.add(u),i=!0)}else if("delete"==a.type){var u=a.cnt;e.remove({"smr_id IN":u}),i=!0}else if("update"==a.type){var c=e.find({smr_id:a.id});if(!(c.length>0))continue;c=c[0];var u=n(c,a.cnt);i=!0}e.setVersion(r)}return i}function i(e,t,n,i,s,a){var u=i.collection,l=!1,c=[];if(s?(u=n,l=!0):"data_write_from_server_delta"==e?(c=n,l=r(u,c,a)):u._isSynced()&&u.stringify()===JSON.stringify(n)||(u.setData(n),u.setVersion(a),l=!0),s||u._takeSnapshot(),l===!0){var f=[];o&&o.__reg("_tapped_blocks",f,!0);var p=new RegExp("@@_sumeru_@@_page_([\\d]+)"),d=t.match(p);d?i.callback(u,{page:d[1]}):i.callback(u,{delta:c}),o&&o.reactiveRender(f)}s||u._setSynced(!0)}var o=e.controller;e.model;var s=e.pubsub._postponeQueue,a=function(t){e.onGlobalMessage?e.onGlobalMessage(t):console.log("GLOBAL MESSAGE : "+t)},u=function(t,n){var r="data_auth_from_server"==n?"auth faild":t;e.onGlobalError?e.onGlobalError(r):console.log("GLOBAL ERROR : "+r)},l=function(t){if(!t.needAuth){var n=t.pubname,r=e.pubsub._subscribeMgr[n].stub,i=!1;return r.forEach(function(e){e.env.onerror?(e.env.onerror("auth failed"),i=!0):i=!1||i}),i}},c=function(t){var n=t.pubname,r=e.pubsub._subscribeMgr[n].stub,i=!1;return r.forEach(function(e){e.env.onerror?(e.env.onerror("dberror:"+t.data.stringify()),i=!0):i=!1||i}),i},f=function(t){var n=t.pubname,r=t.pilotid;if(n){var i=e.pubsub._subscribeMgr[n].stub,o=!1;return i.forEach(function(e,n){if(e.collection.onValidation){var r=t.data;if(""!=t.modelchain)for(var n=0,i=r.length;i>n;n++)r[n].key=t.modelchain+"."+r[n].key;e.collection.onValidation.call(e.collection,r.length>0?!1:!0,"server",r),o=!0}else o=!1||o}),o}var s=e.msgpilot.getPilot(r),o=!1;if(s.stub.onValidation){var a=t.data;s.stub.onValidation.call(s.stub,a.length>0?!1:!0,"server",a),o=!0}else o=!1||o;return o},p=function(t){var n=(new Date).valueOf();serverTimeStamp=t.timestamp,"undefined"!=typeof t.swappk&&(e.myrsa.setPk2(t.swappk),console.log("从server获得新pk2",t.swappk));var r=function(){var e=(new Date).valueOf(),t=e-n,r=t+serverTimeStamp;return r};e.utils.__reg("getTimeStamp",r),Library.objUtils.extend(sumeru.pubsub._publishModelMap,t.pubmap),e.netMessage.sendLocalMessage({},"after_echo_from_server")},d=function(t,n){var r=t.pubname,o=t.pilotid,a=t.data;if(serverVersion=t.version,r){if(!(r in e.pubsub._subscribeMgr))return;"data_write_from_server"==n&&1==e.pubsub._subscribeMgr[r].topPriority&&"undefined"!=typeof e.pubsub._priorityAsyncHandler&&e.pubsub._priorityAsyncHandler.decrease();var u=e.pubsub._subscribeMgr[r].stub,l=sumeru.pubsub._publishModelMap[r.replace(/@@_sumeru_@@_page_([\d]+)/,"")].plainstruct;u.forEach(function(e){var t=e.collection;l?i(n,r,a,e,l,serverVersion):t.__smr__.isHolding?s.push({collection:t,runner:function(){i(n,r,a,e,!1,serverVersion)}}):i(n,r,a,e,!1,serverVersion)})}else{var c=sumeru.msgpilot.getPilot(o);"model"===c.type||i(n,o,a,item,!1,serverVersion)}},h=function(t){var n=t.pubname,r=e.pubsub._subscribeMgr[n].stub,i=!1;return r.forEach(function(e){e.env.onerror?(e.env.onerror("auth failed"),i=!0):i=!1||i}),i},g=function(t){var n=t.pubname,r=e.pubsub._subscribeMgr[n].stub;r.forEach(function(e){var t=e.collection,n=[];o.__reg("_tapped_blocks",n,!0),e.callback(t),o.reactiveRender(n)})},_=function(t){if(t&&"object"==typeof t)for(var n in t)e.config.set(n,t[n]);e.config.commit()};e.netMessage.setReceiver({onMessage:{target:"config_write_from_server",handle:_}}),e.netMessage.setReceiver({onMessage:{target:"echo_from_server",handle:p}}),e.netMessage.setReceiver({onMessage:{target:["data_write_from_server","data_write_from_server_delta"],handle:d},onLocalMessage:{target:["data_write_latency"],handle:g},onError:h,onGlobalError:u,onGlobalMessage:a}),e.netMessage.setReceiver({onError:{target:["data_auth_from_server"],handle:l}}),e.netMessage.setReceiver({onError:{target:["data_write_from_server_dberror"],handle:c}}),e.netMessage.setReceiver({onError:{target:["data_write_from_server_validation"],handle:f}})}(sumeru);var globalConfig=function(e){var t=8082,n="127.0.0.1",r=27017,i=8080,o="test",s=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];if("undefined"!=typeof process&&"undefined"!=typeof process.BAE&&(o="",t=process.env.APP_PORT,i=0,s=["xhr-streaming"]),e.config.defineModule("cluster"),e.config.cluster({enable:!0,cluster_mgr:"127.0.0.1",cluster_mgr_port:6379}),e.config({socketPort:t,dbname:o,mongoServer:n,mongoPort:r,bae_user:"",bae_password:"",httpServerPort:i,protocols_whitelist:s,view_from_cache:!0}),e.config({clientValidation:!0,serverValidation:!0}),"undefined"!=typeof location){var a=location.hostname+":"+t+"/socket/";e.config({clientSocketServer:a,selfGroupManagerAddr:"0.0.0.0",selfGroupManagerPort:"8089"})}if("undefined"!=typeof exports&&"undefined"!=typeof module){var u=process.dstDir+"/server/tmp/config";e.config({configPath:u})}var l=e.config.defineModule("view");l({path:"/"})};"undefined"!=typeof module&&module.exports?module.exports=globalConfig:globalConfig(sumeru),function(e){var t=!1,n=function(r,i){var o=Library.cookie;o.getCookie("clientId")||o.addCookie("clientId",sumeru.utils.randomStr(12),175200),o.getCookie("OPEN_STICKY_SESSION")||o.addCookie("OPEN_STICKY_SESSION",1),r=r||0;var s=e.__random();console.log("OPEN : "+e.config.get("clientSocketServer")),sumeru.reachability.setStatus_(sumeru.reachability.STATUS_CONNECTING);var a=new SockJS("http://"+e.config.get("clientSocketServer"),void 0,{protocols_whitelist:e.config.get("protocols_whitelist")});a.onmessage=function(t){var n;n=e.config.get("rsa_enable")?e.myrsa.decrypt(t.data):t.data,e.netMessage.onData(n)},a.onopen=function(){var n="sumeru_app_uuid";sumeru.reachability.setStatus_(sumeru.reachability.STATUS_CONNECTED);var o={};e.config.get("rsa_enable")?(0===r?(e.myrsa.setPk2(e.config.get("rsa_pk")),e.myrsa.generate()):(o.swappk=e.myrsa.getPk(),e.myrsa.setPk2("")),o.socketId=s,o.uuid=n,o.pk=e.myrsa.getPk()):o={socketId:s,uuid:n},console.log("ON OPEN : "+a.readyState+" : "+JSON.stringify(o)),e.netMessage.setReceiver({onLocalMessage:{target:["after_echo_from_server"],handle:function(){e.auth.init(function(){t=!0,i&&i(),sumeru.writeBuffer_.resume(),r>0&&(r=0,e.pubsub.__load("_redoAllSubscribe")())})}}}),e.netMessage.sendMessage(o,"echo",function(){console.log("send echo error...")},function(){console.log("send echo success...")})},a.onclose=function(){if(sumeru.reachability.setStatus_(sumeru.reachability.STATUS_OFFLINE),r>500)throw"Fail to connect to network";setTimeout(function(){n(++r)},1e3)};var u=function(t,n,r){if(0===a.readyState)return setTimeout(function(){u(t,n,r)},50),void 0;var i;i=e.config.get("rsa_enable")&&null===t.match(/"target":"echo"/)?e.myrsa.encrypt(t):t;try{a.send(i)}catch(o){console.log("ERR : "+a.readyState+" "+t),n&&n(o)}r&&r()};e.netMessage.addOutFilter(function(e){return e.sessionId=o.getCookie("sessionId"),e.clientId=o.getCookie("clientId"),e.passportType=o.getCookie("passportType"),e},0),sumeru.writeBuffer_.setOutput(u),sumeru.netMessage.setOutput(sumeru.writeBuffer_.write)};return e.init=function(e){t?e&&e():n(0,e)},e.reconnect=function(){sumeru.reachability.setStatus_(sumeru.reachability.STATUS_CONNECTING),n(1)},e}(sumeru);var SUMERU_ROUTER=void 0===SUMERU_ROUTER?!0:SUMERU_ROUTER;!function(e){function t(){var e=self.location.href.indexOf("#"),t="";return e>=0&&(t=self.location.href.substr(e+1)),t}function n(e){var t,n={controller:"",params:"",session:""},r=0;try{return e?(t=e.indexOf("!"),-1==t?(n.controller=e,n):(-1!=e.indexOf("_smr_ignore=true")&&(d=!0),n.controller=e.substring(r,t),r=t+1,t=e.indexOf("_smr_ses_dat{"),t=-1==t?void 0:t,n.params=e.substring(r,t),"&"==n.params&&(n.params=""),void 0===t?n:(r=t,t=e.indexOf("}",r+"_smr_ses_dat{".length),n.session=e.substring(r+"_smr_ses_dat{".length,t),n.session=decodeURIComponent(n.session),n))):n}finally{a=n.controller!=c,c=n.controller,u=f!=n.params,f=n.params||"",l=p!=n.session,p=n.session,SUMERU_APP_FW_DEBUG&&(console.log("isControllerChange :"+a),console.log("isSessionChange :"+l),console.log("isParamsChange :"+u),console.log("parts of hash:",n))}}function r(r){r&&r.preventDefault();var i=n(t());l&&!s&&e.session.setResume(i.session),0==d&&(a||u)&&e.init(function(t,n){return function(){e.controller.dispatch(t,n,h),h=!1}}(i.controller,i.params)),d=s=a=l=u=!1}var i=e.addSubPackage("router"),o=e.utils,s=!1,a=!0,u=!0,l=!0,c=null,f=null,p=null,d=!1,h=!1;i.__reg("joinSessionToHash",function(e){var t=o.encodeURIComponentFull(e.substring(1,e.length-1)),n=c+"!"+(""==f?"&":f);-1==n.indexOf("!")&&(n+="!"),"&"!=n[n.length-1]&&(n+="&"),n+="_smr_ses_dat{"+t+"}",p=t,s=!0,self.location.hash=n},!0),i.__reg("redirect",function(e,t){-1==e.indexOf("!")&&(e+="!"),"&"!=e[e.length-1]&&(e+="&"),p&&(e+="_smr_ses_dat{"+o.encodeURIComponentFull(p)+"}"),self.location.hash=e,h=!!t}),e.event.domReady(function(){SUMERU_APP_FW_DEBUG?sumeru.__require("./unit/qunit/qunit-1.9.0.js",function(e){var t=document.createElement("link");t.href="./unit/qunit/qunit-1.9.0.css",t.rel="stylesheet",document.querySelector("head").appendChild(t);var n=document.createElement("div");n.id="qunit",n.style.position="fixed",n.style.zIndex=1e4,n.style.textAlign="left",n.style.overflow="scroll",n.style.height=screen.availHeight+"px",n.style.width=screen.availWidth+"px",n.style.left="10000px",n.style.top="10000px",document.body.appendChild(n),e.showResource=function(){n.style.left=0,n.style.top=0},e.hideResource=function(){n.style.left="10000px",n.style.top="10000px"},e.init(),e.hideResource(),console.log("DEBUG MODE : QUNIT READIED.")},"Qunit"):window.test=function(){},SUMERU_ROUTER&&(window.onhashchange=r,r())}),SUMERU_APP_FW_DEBUG&&i.__reg("splitHash",n,!0)}(sumeru),function(e){var t=[],n=function(){for(var e,n=0,r=arguments.length;r>n;n++)e=arguments[n],Library.objUtils.isObject(e)&&"undefined"!=typeof e.pattern&&e.action&&t.push({path:e.pattern,action:e.action})},r=function(){return t},i=function(e){return e&&n({pattern:"",action:e}),!0},o=[];e.router.addSubPackage("externalProcessor");var s=function(){for(var e,t=0,n=arguments.length;n>t;t++)e=arguments[t],"function"==typeof e&&o.push(e)},a=function(){return o};e.router.__reg("add",n),e.router.__reg("getAll",r),e.router.__reg("setDefault",i),e.router.externalProcessor.__reg("add",s),e.router.externalProcessor.__reg("getAll",a)}(sumeru),function(e){e.addSubPackage("historyCache");var t=[],n=function(e,n){if(n)return i(e),!1;for(var r=!1,o=t.length-1;o>=0;o--)if(t[o]&&t[o][0]===e[0]){r=!0;break}if(r){if(o===t.length-1)return!1;console.log("hit historycache and get",t[o][1],t);for(var s=t.length-1;s>o;s--)t.pop();var a=JSON.stringify(t[o]);return JSON.parse(a)}return i(e),!1},r=function(){return t},i=function(e){e&&e[0]&&e[1]&&t.push(e)};e.historyCache.__reg("hitUrl",n),e.historyCache.__reg("getCache",r)}(sumeru);var runnable=function(e){var t=0,n=16,r=256,i=t;if(!e.reachability){var o=e.addSubPackage("reachability"),s={},a=function(e){e===t?s.offline&&s.offline():e===n?s.connecting&&s.connecting():e===r&&s.online&&s.online()},u=function(e,t){s[e]=t},l=function(e){return a(e),i=e},c=function(){return i};o.STATUS_OFFLINE=t,o.STATUS_CONNECTING=n,o.STATUS_CONNECTED=r,"undefined"!=typeof module&&module.exports||(window.addEventListener("offline",function(){e.reachability.setStatus_(t)},!1),window.addEventListener("online",function(){e.reconnect()},!1)),o.__reg("setStatus_",l,"private"),o.__reg("getStatus",c,"private"),o.__reg("setEvent",u,"private")}};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru);var runnable=function(e){if(!e.writeBuffer_){var t,n=e.addSubPackage("writeBuffer_"),r=e.reachability,i=[],o=function(e){t=e},s=function(e,t,n){i.push({msg:e,onError:t,onSuccess:n}),a()},a=function(){if(0==i.length)return!0;for(var e;r.getStatus()==r.STATUS_CONNECTED&&(e=i.shift());)t(e.msg,e.onError,e.onSuccess)};n.__reg("write",s,"private"),n.__reg("setOutput",o,"private"),n.__reg("resume",a,"private")}};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru);var runnable=function(e){var t={},n=0,r=function(){return"pilot"+n++},i=function(e,n){var n=n||"model";if(!e._getPilotId()){var i=r();t[i]={type:n,stub:e},e._setPilotId(i)}},o=function(e){return t[e]};if(!e.msgpilot){var s=e.addSubPackage("msgpilot");s.__reg("setPilot",i,"private"),s.__reg("getPilot",o,"private")}};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru);var Handlebars={};Handlebars.VERSION="1.0.beta.6",Handlebars.helpers={},Handlebars.partials={},Handlebars.registerHelper=function(e,t,n){n&&(t.not=n),this.helpers[e]=t},Handlebars.registerPartial=function(e,t){this.partials[e]=t},Handlebars.registerHelper("helperMissing",function(e){if(2===arguments.length)return void 0;throw new Error("Could not find property '"+e+"'")});var toString=Object.prototype.toString,functionType="[object Function]";Handlebars.registerHelper("blockHelperMissing",function(e,t){var n=t.inverse||function(){},r=t.fn,i="",o=toString.call(e);if(o===functionType&&(e=e.call(this)),e===!0)return r(this);if(e===!1||null==e)return n(this);if("[object Array]"===o){if(e.length>0)for(var s=0,a=e.length;a>s;s++)i+=r(e[s]);else i=n(this);return i}return r(e)}),Handlebars.registerHelper("each",function(e,t){var n=t.fn,r=t.inverse,i="";if(e&&e.length>0)for(var o=0,s=e.length;s>o;o++)i+=n(e[o]);else i=r(this);return i}),Handlebars.registerHelper("if",function(e,t){var n=toString.call(e);return n===functionType&&(e=e.call(this)),!e||Handlebars.Utils.isEmpty(e)?t.inverse(this):t.fn(this)}),Handlebars.registerHelper("unless",function(e,t){var n=t.fn,r=t.inverse;return t.fn=r,t.inverse=n,Handlebars.helpers["if"].call(this,e,t)}),Handlebars.registerHelper("with",function(e,t){return t.fn(e)}),Handlebars.registerHelper("log",function(e){Handlebars.log(e)});var handlebars=function(){var e={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,statements:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,OPEN_PARTIAL:24,params:25,hash:26,param:27,STRING:28,INTEGER:29,BOOLEAN:30,hashSegments:31,hashSegment:32,ID:33,EQUALS:34,pathSegments:35,SEP:36,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"OPEN_PARTIAL",28:"STRING",29:"INTEGER",30:"BOOLEAN",33:"ID",34:"EQUALS",36:"SEP"},productions_:[0,[3,2],[4,3],[4,1],[4,0],[6,1],[6,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[7,2],[17,3],[17,2],[17,2],[17,1],[25,2],[25,1],[27,1],[27,1],[27,1],[27,1],[26,1],[31,2],[31,1],[32,3],[32,3],[32,3],[32,3],[21,1],[35,3],[35,1]],performAction:function(e,t,n,r,i,o){var s=o.length-1;switch(i){case 1:return o[s-1];case 2:this.$=new r.ProgramNode(o[s-2],o[s]);break;case 3:this.$=new r.ProgramNode(o[s]);break;case 4:this.$=new r.ProgramNode([]);break;case 5:this.$=[o[s]];break;case 6:o[s-1].push(o[s]),this.$=o[s-1];break;case 7:this.$=new r.InverseNode(o[s-2],o[s-1],o[s]);break;case 8:this.$=new r.BlockNode(o[s-2],o[s-1],o[s]);break;case 9:this.$=o[s];break;case 10:this.$=o[s];break;case 11:this.$=new r.ContentNode(o[s]);break;case 12:this.$=new r.NativeNode(o[s]);break;case 13:this.$=new r.MustacheNode(o[s-1][0],o[s-1][1]);break;case 14:this.$=new r.MustacheNode(o[s-1][0],o[s-1][1]);break;case 15:this.$=o[s-1];break;case 16:this.$=new r.MustacheNode(o[s-1][0],o[s-1][1]);break;case 17:this.$=new r.MustacheNode(o[s-1][0],o[s-1][1],!0);break;case 18:this.$=new r.PartialNode(o[s-1]);break;case 19:this.$=new r.PartialNode(o[s-2],o[s-1]);break;case 20:break;case 21:this.$=[[o[s-2]].concat(o[s-1]),o[s]];break;case 22:this.$=[[o[s-1]].concat(o[s]),null];break;case 23:this.$=[[o[s-1]],o[s]];break;case 24:this.$=[[o[s]],null];break;case 25:o[s-1].push(o[s]),this.$=o[s-1];break;case 26:this.$=[o[s]];break;case 27:this.$=o[s];break;case 28:this.$=new r.StringNode(o[s]);break;case 29:this.$=new r.IntegerNode(o[s]);break;case 30:this.$=new r.BooleanNode(o[s]);break;case 31:this.$=new r.HashNode(o[s]);break;case 32:o[s-1].push(o[s]),this.$=o[s-1];break;case 33:this.$=[o[s]];break;case 34:this.$=[o[s-2],o[s]];break;case 35:this.$=[o[s-2],new r.StringNode(o[s])];break;case 36:this.$=[o[s-2],new r.IntegerNode(o[s])];break;case 37:this.$=[o[s-2],new r.BooleanNode(o[s])];break;case 38:this.$=new r.IdNode(o[s]);break;case 39:o[s-2].push(o[s]),this.$=o[s-2];break;case 40:this.$=[o[s]]}},table:[{3:1,4:2,5:[2,4],6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{1:[3]},{5:[1,16]},{5:[2,3],7:17,8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,19],20:[2,3],22:[1,13],23:[1,14],24:[1,15]},{5:[2,5],14:[2,5],15:[2,5],16:[2,5],19:[2,5],20:[2,5],22:[2,5],23:[2,5],24:[2,5]},{4:20,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{4:21,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],24:[2,9]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],24:[2,10]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],24:[2,11]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],24:[2,12]},{17:22,21:23,33:[1,25],35:24},{17:26,21:23,33:[1,25],35:24},{17:27,21:23,33:[1,25],35:24},{17:28,21:23,33:[1,25],35:24},{21:29,33:[1,25],35:24},{1:[2,1]},{6:30,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{5:[2,6],14:[2,6],15:[2,6],16:[2,6],19:[2,6],20:[2,6],22:[2,6],23:[2,6],24:[2,6]},{17:22,18:[1,31],21:23,33:[1,25],35:24},{10:32,20:[1,33]},{10:34,20:[1,33]},{18:[1,35]},{18:[2,24],21:40,25:36,26:37,27:38,28:[1,41],29:[1,42],30:[1,43],31:39,32:44,33:[1,45],35:24},{18:[2,38],28:[2,38],29:[2,38],30:[2,38],33:[2,38],36:[1,46]},{18:[2,40],28:[2,40],29:[2,40],30:[2,40],33:[2,40],36:[2,40]},{18:[1,47]},{18:[1,48]},{18:[1,49]},{18:[1,50],21:51,33:[1,25],35:24},{5:[2,2],8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,2],22:[1,13],23:[1,14],24:[1,15]},{14:[2,20],15:[2,20],16:[2,20],19:[2,20],22:[2,20],23:[2,20],24:[2,20]},{5:[2,7],14:[2,7],15:[2,7],16:[2,7],19:[2,7],20:[2,7],22:[2,7],23:[2,7],24:[2,7]},{21:52,33:[1,25],35:24},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],24:[2,8]},{14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],24:[2,14]},{18:[2,22],21:40,26:53,27:54,28:[1,41],29:[1,42],30:[1,43],31:39,32:44,33:[1,45],35:24},{18:[2,23]},{18:[2,26],28:[2,26],29:[2,26],30:[2,26],33:[2,26]},{18:[2,31],32:55,33:[1,56]},{18:[2,27],28:[2,27],29:[2,27],30:[2,27],33:[2,27]},{18:[2,28],28:[2,28],29:[2,28],30:[2,28],33:[2,28]},{18:[2,29],28:[2,29],29:[2,29],30:[2,29],33:[2,29]},{18:[2,30],28:[2,30],29:[2,30],30:[2,30],33:[2,30]},{18:[2,33],33:[2,33]},{18:[2,40],28:[2,40],29:[2,40],30:[2,40],33:[2,40],34:[1,57],36:[2,40]},{33:[1,58]},{14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],24:[2,13]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],24:[2,16]},{5:[2,17],14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],24:[2,17]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],24:[2,18]},{18:[1,59]},{18:[1,60]},{18:[2,21]},{18:[2,25],28:[2,25],29:[2,25],30:[2,25],33:[2,25]},{18:[2,32],33:[2,32]},{34:[1,57]},{21:61,28:[1,62],29:[1,63],30:[1,64],33:[1,25],35:24},{18:[2,39],28:[2,39],29:[2,39],30:[2,39],33:[2,39],36:[2,39]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],24:[2,19]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],24:[2,15]},{18:[2,34],33:[2,34]},{18:[2,35],33:[2,35]},{18:[2,36],33:[2,36]},{18:[2,37],33:[2,37]}],defaultActions:{16:[2,1],37:[2,23],53:[2,21]},parseError:function(e){throw new Error(e)},parse:function(e){function t(){var e;return e=n.lexer.lex()||1,"number"!=typeof e&&(e=n.symbols_[e]||e),e}var n=this,r=[0],i=[null],o=[],s=this.table,a="",u=0,l=0,c=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var f=this.lexer.yylloc;o.push(f),"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var p,d,h,g,_,m,v,b,y,S={};;){if(h=r[r.length-1],this.defaultActions[h]?g=this.defaultActions[h]:(null==p&&(p=t()),g=s[h]&&s[h][p]),!("undefined"!=typeof g&&g.length&&g[0]||c)){y=[];for(m in s[h])this.terminals_[m]&&m>2&&y.push("'"+this.terminals_[m]+"'");var w="";w=this.lexer.showPosition?"Parse error on line "+(u+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+y.join(", ")+", got '"+this.terminals_[p]+"'":"Parse error on line "+(u+1)+": Unexpected "+(1==p?"end of input":"'"+(this.terminals_[p]||p)+"'"),this.parseError(w,{text:this.lexer.match,token:this.terminals_[p]||p,line:this.lexer.yylineno,loc:f,expected:y})}if(g[0]instanceof Array&&g.length>1)throw new Error("Parse Error: multiple actions possible at state: "+h+", token: "+p);switch(g[0]){case 1:r.push(p),i.push(this.lexer.yytext),o.push(this.lexer.yylloc),r.push(g[1]),p=null,d?(p=d,d=null):(l=this.lexer.yyleng,a=this.lexer.yytext,u=this.lexer.yylineno,f=this.lexer.yylloc,c>0&&c--);break;case 2:if(v=this.productions_[g[1]][1],S.$=i[i.length-v],S._$={first_line:o[o.length-(v||1)].first_line,last_line:o[o.length-1].last_line,first_column:o[o.length-(v||1)].first_column,last_column:o[o.length-1].last_column},_=this.performAction.call(S,a,l,u,this.yy,g[1],i,o),"undefined"!=typeof _)return _;v&&(r=r.slice(0,2*-1*v),i=i.slice(0,-1*v),o=o.slice(0,-1*v)),r.push(this.productions_[g[1]][0]),i.push(S.$),o.push(S._$),b=s[r[r.length-2]][r[r.length-1]],r.push(b);break;case 3:return!0}}return!0}},t=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parseError)throw new Error(e);this.yy.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.match+=e,this.matched+=e;var t=e.match(/\n/);return t&&this.yylineno++,this._input=this._input.slice(1),e},unput:function(e){return this._input=e+this._input,this},more:function(){return this._more=!0,this},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,n;this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),i=0;i<r.length;i++)if(t=this._input.match(this.rules[r[i]]))return n=t[0].match(/\n.*/g),n&&(this.yylineno+=n.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:n?n[n.length-1].length-1:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,r[i],this.conditionStack[this.conditionStack.length-1]),e?e:void 0;return""===this._input?this.EOF:(this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno}),void 0)},lex:function(){var e=this.next();return"undefined"!=typeof e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)}};return e.performAction=function(e,t,n,r){switch(n){case 0:if("\\"!==t.yytext.slice(-1)&&this.begin("mu"),"\\"===t.yytext.slice(-1)&&(t.yytext=t.yytext.substr(0,t.yyleng-1),this.begin("emu")),t.yytext)return 14;break;case 1:return 14;case 2:return this.popState(),14;case 3:return 24;case 4:return 16;case 5:return 20;case 6:return 19;case 7:return 19;case 8:return 23;case 9:return 23;case 10:return t.yytext=t.yytext.substr(3,t.yyleng-5),this.popState(),15;case 11:return 22;case 12:return 34;case 13:return 33;case 14:return 33;case 15:return 36;case 16:break;case 17:return this.popState(),18;case 18:return this.popState(),18;case 19:return t.yytext=t.yytext.substr(1,t.yyleng-2).replace(/\\"/g,'"'),28;case 20:return 30;case 21:return 30;case 22:return 29;case 23:return 33;case 24:return t.yytext=t.yytext.substr(1,t.yyleng-2),33;case 25:return"INVALID";case 26:return 5}},e.rules=[/^[^\x00]*?(?=(\{\{))/,/^[^\x00]+/,/^[^\x00]{2,}?(?=(\{\{))/,/^\{\{>/,/^\{\{#/,/^\{\{\//,/^\{\{\^/,/^\{\{\s*else\b/,/^\{\{\{/,/^\{\{&/,/^\{\{\$[\s\S]*?\}\}/,/^\{\{/,/^=/,/^\.(?=[} ])/,/^\.\./,/^[\/.]/,/^\s+/,/^\}\}\}/,/^\}\}/,/^"(\\["]|[^"])*"/,/^true(?=[}\s])/,/^false(?=[}\s])/,/^[0-9]+(?=[}\s])/,/^[a-zA-Z0-9_$-]+(?=[=}\s\/.])/,/^\[[^\]]*\]/,/^./,/^$/],e.conditions={mu:{rules:[3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26],inclusive:!1},emu:{rules:[2],inclusive:!1},INITIAL:{rules:[0,1,26],inclusive:!0}},e}();return e.lexer=t,e}();"undefined"!=typeof require&&"undefined"!=typeof exports&&(exports.parser=handlebars,exports.parse=function(){return handlebars.parse.apply(handlebars,arguments)},exports.main=function(e){if(!e[1])throw new Error("Usage: "+e[0]+" FILE");if("undefined"!=typeof process)var t=require("fs").readFileSync(require("path").join(process.cwd(),e[1]),"utf8");else var n=require("file").path(require("file").cwd()),t=n.join(e[1]).read({charset:"utf-8"});return exports.parser.parse(t)},"undefined"!=typeof module&&require.main===module&&exports.main("undefined"!=typeof process?process.argv.slice(1):require("system").args)),Handlebars.Parser=handlebars,Handlebars.parse=function(e){return Handlebars.Parser.yy=Handlebars.AST,Handlebars.Parser.parse(e)},Handlebars.print=function(e){return(new Handlebars.PrintVisitor).accept(e)},Handlebars.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(){}},Handlebars.log=function(e,t){Handlebars.logger.log(e,t)},function(){Handlebars.AST={},Handlebars.AST.ProgramNode=function(e,t){this.type="program",this.statements=e,t&&(this.inverse=new Handlebars.AST.ProgramNode(t))},Handlebars.AST.MustacheNode=function(e,t,n){this.type="mustache",this.id=e[0],this.params=e.slice(1),this.hash=t,this.escaped=!n},Handlebars.AST.PartialNode=function(e,t){this.type="partial",this.id=e,this.context=t};var e=function(e,t){if(e.original!==t.original)throw new Handlebars.Exception(e.original+" doesn't match "+t.original)};Handlebars.AST.BlockNode=function(t,n,r){e(t.id,r),this.type="block",this.mustache=t,this.program=n},Handlebars.AST.InverseNode=function(t,n,r){e(t.id,r),this.type="inverse",this.mustache=t,this.program=n},Handlebars.AST.ContentNode=function(e){this.type="content",this.string=e},Handlebars.AST.HashNode=function(e){this.type="hash",this.pairs=e},Handlebars.AST.IdNode=function(e){this.type="ID",this.original=e.join(".");for(var t=[],n=0,r=0,i=e.length;i>r;r++){var o=e[r];".."===o?n++:"."===o||"this"===o?this.isScoped=!0:t.push(o)}this.parts=t,this.string=t.join("."),this.depth=n,this.isSimple=1===t.length&&0===n},Handlebars.AST.StringNode=function(e){this.type="STRING",this.string=e},Handlebars.AST.IntegerNode=function(e){this.type="INTEGER",this.integer=e},Handlebars.AST.BooleanNode=function(e){this.type="BOOLEAN",this.bool=e},Handlebars.AST.CommentNode=function(e){this.type="comment",this.comment=e},Handlebars.AST.NativeNode=function(e){this.type="nativerun",this.code=e}}(),Handlebars.Exception=function(){var e=Error.prototype.constructor.apply(this,arguments);for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);this.message=e.message},Handlebars.Exception.prototype=new Error,Handlebars.SafeString=function(e){this.string=e},Handlebars.SafeString.prototype.toString=function(){return this.string.toString()},function(){var e={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},t=/&(?!\w+;)|[<>"'`]/g,n=/[&<>"'`]/,r=function(t){return e[t]||"&amp;"};Handlebars.Utils={escapeExpression:function(e){return e instanceof Handlebars.SafeString?e.toString():null==e||e===!1?"":n.test(e)?e.replace(t,r):e},isEmpty:function(e){if("undefined"==typeof e)return!0;if(null===e)return!0;if(e===!1)return!0;if("[object Array]"===Object.prototype.toString.call(e)&&0===e.length)return!0;if("object"==typeof e){for(var t in e)return!1;return!0}return!1}}}(),Handlebars.Compiler=function(){},Handlebars.JavaScriptCompiler=function(){},function(e,t){e.OPCODE_MAP={appendContent:1,getContext:2,lookupWithHelpers:3,lookup:4,append:5,invokeMustache:6,appendEscaped:7,pushString:8,truthyOrFallback:9,functionOrFallback:10,invokeProgram:11,invokePartial:12,push:13,assignToHash:15,pushStringParam:16,nativerun:17},e.MULTI_PARAM_OPCODES={appendContent:1,getContext:1,lookupWithHelpers:2,lookup:1,invokeMustache:3,pushString:1,truthyOrFallback:1,functionOrFallback:1,invokeProgram:3,invokePartial:1,push:1,assignToHash:1,pushStringParam:1,nativerun:1},e.DISASSEMBLE_MAP={};
for(var n in e.OPCODE_MAP){var r=e.OPCODE_MAP[n];e.DISASSEMBLE_MAP[r]=n}e.multiParamSize=function(t){return e.MULTI_PARAM_OPCODES[e.DISASSEMBLE_MAP[t]]},e.prototype={compiler:e,disassemble:function(){for(var t,n,r,i,o,s=this.opcodes,a=[],u=0,l=s.length;l>u;u++)if(t=s[u],"DECLARE"===t)i=s[++u],o=s[++u],a.push("DECLARE "+i+" = "+o);else{r=e.DISASSEMBLE_MAP[t];for(var c=e.multiParamSize(t),f=[],p=0;c>p;p++)n=s[++u],"string"==typeof n&&(n='"'+n.replace("\n","\\n")+'"'),f.push(n);r=r+" "+f.join(" "),a.push(r)}return a.join("\n")},guid:0,compile:function(e,t){this.children=[],this.depths={list:[]},this.options=t;var n=this.options.knownHelpers;if(this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0},n)for(var r in n)this.options.knownHelpers[r]=n[r];return this.program(e)},accept:function(e){return this[e.type](e)},program:function(e){var t,n=e.statements;this.opcodes=[];for(var r=0,i=n.length;i>r;r++)t=n[r],this[t.type](t);return this.isSimple=1===i,this.depths.list=this.depths.list.sort(function(e,t){return e-t}),this},compileProgram:function(e){var t=(new this.compiler).compile(e,this.options),n=this.guid++;this.usePartial=this.usePartial||t.usePartial,this.children[n]=t;for(var r=0,i=t.depths.list.length;i>r;r++)depth=t.depths.list[r],2>depth||this.addDepth(depth-1);return n},block:function(e){var t,n=e.mustache,r=this.setupStackForMustache(n),i=this.compileProgram(e.program);e.program.inverse&&(t=this.compileProgram(e.program.inverse),this.declare("inverse",t)),this.opcode("invokeProgram",i,r.length,!!n.hash),this.declare("inverse",null),this.opcode("append")},inverse:function(e){var t=this.setupStackForMustache(e.mustache),n=this.compileProgram(e.program);this.declare("inverse",n),this.opcode("invokeProgram",null,t.length,!!e.mustache.hash),this.declare("inverse",null),this.opcode("append")},hash:function(e){var t,n,r=e.pairs;this.opcode("push","{}");for(var i=0,o=r.length;o>i;i++)t=r[i],n=t[1],this.accept(n),this.opcode("assignToHash",t[0])},partial:function(e){var t=e.id;this.usePartial=!0,e.context?this.ID(e.context):this.opcode("push","depth0"),this.opcode("invokePartial",t.original),this.opcode("append")},content:function(e){this.opcode("appendContent",e.string)},mustache:function(e){var t=this.setupStackForMustache(e);this.opcode("invokeMustache",t.length,e.id.original,!!e.hash),e.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ID:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth),this.opcode("lookupWithHelpers",e.parts[0]||null,e.isScoped||!1);for(var t=1,n=e.parts.length;n>t;t++)this.opcode("lookup",e.parts[t])},STRING:function(e){this.opcode("pushString",e.string)},INTEGER:function(e){this.opcode("push",e.integer)},BOOLEAN:function(e){this.opcode("push",e.bool)},comment:function(){},nativerun:function(e){this.opcode("nativerun",e.code)},pushParams:function(e){for(var t,n=e.length;n--;)t=e[n],this.options.stringParams?(t.depth&&this.addDepth(t.depth),this.opcode("getContext",t.depth||0),this.opcode("pushStringParam",t.string)):this[t.type](t)},opcode:function(t,n,r,i){this.opcodes.push(e.OPCODE_MAP[t]),void 0!==n&&this.opcodes.push(n),void 0!==r&&this.opcodes.push(r),void 0!==i&&this.opcodes.push(i)},declare:function(e,t){this.opcodes.push("DECLARE"),this.opcodes.push(e),this.opcodes.push(t)},addDepth:function(e){0!==e&&(this.depths[e]||(this.depths[e]=!0,this.depths.list.push(e)))},setupStackForMustache:function(e){var t=e.params;return this.pushParams(t),e.hash&&this.hash(e.hash),this.ID(e.id),t}},t.prototype={nameLookup:function(e,n){return/^[0-9]+$/.test(n)?e+"["+n+"]":t.isValidJavaScriptVariableName(n)?e+"."+n:e+"['"+n+"']"},appendToBuffer:function(e){return this.environment.isSimple?"return "+e+";":"buffer += "+e+";"},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(e,t,n,r){this.environment=e,this.options=t||{},this.name=this.environment.name,this.isChild=!!n,this.context=n||{programs:[],aliases:{self:"this"},registers:{list:[]}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.compileChildren(e,t);var i,o=e.opcodes;for(this.i=0,a=o.length;this.i<a;this.i++)i=this.nextOpcode(0),"DECLARE"===i[0]?(this.i=this.i+2,this[i[1]]=i[2]):(this.i=this.i+i[1].length,this[i[0]].apply(this,i[1]));return this.createFunctionContext(r)},nextOpcode:function(t){var n,r,i,o,s=this.environment.opcodes,a=s[this.i+t];if("DECLARE"===a)return n=s[this.i+1],r=s[this.i+2],["DECLARE",n,r];n=e.DISASSEMBLE_MAP[a],i=e.multiParamSize(a),o=[];for(var u=0;i>u;u++)o.push(s[this.i+u+1+t]);return[n,o]},eat:function(e){this.i=this.i+e.length},preamble:function(){var e=[];if(this.useRegister("foundHelper"),this.isChild)e.push("");else{var t=this.namespace,n="helpers = helpers || "+t+".helpers;";this.environment.usePartial&&(n=n+" partials = partials || "+t+".partials;"),e.push(n)}this.environment.isSimple?e.push(""):e.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=e},createFunctionContext:function(e){var t=this.stackVars;if(this.isChild||(t=t.concat(this.context.registers.list)),t.length>0&&(this.source[1]=this.source[1]+", "+t.join(", ")),!this.isChild)for(var n in this.context.aliases)this.source[1]=this.source[1]+", "+n+"="+this.context.aliases[n];this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.source.push("return buffer;");for(var r=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"],i=0,o=this.environment.depths.list.length;o>i;i++)r.push("depth"+this.environment.depths.list[i]);if(e)return r.push(this.source.join("\n  ")),Function.apply(this,r);var s="function "+(this.name||"")+"("+r.join(",")+") {\n  "+this.source.join("\n  ")+"}";return Handlebars.log(Handlebars.logger.DEBUG,s+"\n\n"),s},appendContent:function(e){this.source.push(this.appendToBuffer(this.quotedString(e)))},append:function(){var e=this.popStack();this.source.push("if("+e+" || "+e+" === 0) { "+this.appendToBuffer(e)+" }"),this.environment.isSimple&&this.source.push("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){var e=this.nextOpcode(1),t="";this.context.aliases.escapeExpression="this.escapeExpression","appendContent"===e[0]&&(t=" + "+this.quotedString(e[1][0]),this.eat(e)),this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"+t))},getContext:function(e){this.lastContext!==e&&(this.lastContext=e)},lookupWithHelpers:function(e,t){if(e){var n=this.nextStack();this.usingKnownHelper=!1;var r;!t&&this.options.knownHelpers[e]?(r=n+" = "+this.nameLookup("helpers",e,"helper"),this.usingKnownHelper=!0):t||this.options.knownHelpersOnly?r=n+" = "+this.nameLookup("depth"+this.lastContext,e,"context"):(this.register("foundHelper",this.nameLookup("helpers",e,"helper")),r=n+" = foundHelper || "+this.nameLookup("depth"+this.lastContext,e,"context")),r+=";",this.source.push(r)}else this.pushStack("depth"+this.lastContext)},lookup:function(e){var t=this.topStack();this.source.push(t+" = ("+t+" === null || "+t+" === undefined || "+t+" === false ? "+t+" : "+this.nameLookup(t,e,"context")+");")},nativerun:function(e){e.match(/this/)&&(e=e.replace(/this/g,"depth0")),this.source.push("if(!Handlebars.Utils.isEmpty(depth0)){with(depth0){"+this.appendToBuffer(e)+"}}")},pushStringParam:function(e){this.pushStack("depth"+this.lastContext),this.pushString(e)},pushString:function(e){this.pushStack(this.quotedString(e))},push:function(e){this.pushStack(e)},invokeMustache:function(e,t,n){this.populateParams(e,this.quotedString(t),"{}",null,n,function(e,t,n){this.usingKnownHelper||(this.context.aliases.helperMissing="helpers.helperMissing",this.context.aliases.undef="void 0",this.source.push("else if("+n+"=== undef) { "+e+" = helperMissing.call("+t+"); }"),e!==n&&this.source.push("else { "+e+" = "+n+"; }"))})},invokeProgram:function(e,t,n){var r=this.programExpression(this.inverse),i=this.programExpression(e);this.populateParams(t,null,i,r,n,function(e,t){this.usingKnownHelper||(this.context.aliases.blockHelperMissing="helpers.blockHelperMissing",this.source.push("else { "+e+" = blockHelperMissing.call("+t+"); }"))})},populateParams:function(e,t,n,r,i,o){var s,a,u=i||this.options.stringParams||r||this.options.data,l=this.popStack(),c=[];if(u?(this.register("tmp1",n),a="tmp1"):a="{ hash: {} }",u){var f=i?this.popStack():"{}";this.source.push("tmp1.hash = "+f+";")}this.options.stringParams&&this.source.push("tmp1.contexts = [];");for(var p=0;e>p;p++)s=this.popStack(),c.push(s),this.options.stringParams&&this.source.push("tmp1.contexts.push("+this.popStack()+");");r&&(this.source.push("tmp1.fn = tmp1;"),this.source.push("tmp1.inverse = "+r+";")),this.options.data&&this.source.push("tmp1.data = data;"),c.push(a),this.populateCall(c,l,t||l,o,"{}"!==n)},populateCall:function(e,t,n,r,i){var o=["depth0"].concat(e).join(", "),s=["depth0"].concat(n).concat(e).join(", "),a=this.nextStack();if(this.usingKnownHelper)this.source.push(a+" = "+t+".call("+o+");");else{this.context.aliases.functionType='"function"';var u=i?"foundHelper && ":"";this.source.push("if("+u+"typeof "+t+" === functionType) { "+a+" = "+t+".call("+o+"); }")}r.call(this,a,s,t),this.usingKnownHelper=!1},invokePartial:function(e){params=[this.nameLookup("partials",e,"partial"),"'"+e+"'",this.popStack(),"helpers","partials"],this.options.data&&params.push("data"),this.pushStack("self.invokePartial("+params.join(", ")+");")},assignToHash:function(e){var t=this.popStack(),n=this.topStack();this.source.push(n+"['"+e+"'] = "+t+";")},compiler:t,compileChildren:function(e,t){for(var n,r,i=e.children,o=0,s=i.length;s>o;o++){n=i[o],r=new this.compiler,this.context.programs.push("");var a=this.context.programs.length;n.index=a,n.name="program"+a,this.context.programs[a]=r.compile(n,t,this.context)}},programExpression:function(e){if(null==e)return"self.noop";for(var t=this.environment.children[e],n=t.depths.list,r=[t.index,t.name,"data"],i=0,o=n.length;o>i;i++)depth=n[i],1===depth?r.push("depth0"):r.push("depth"+(depth-1));return 0===n.length?"self.program("+r.join(", ")+")":(r.shift(),"self.programWithDepth("+r.join(", ")+")")},register:function(e,t){this.useRegister(e),this.source.push(e+" = "+t+";")},useRegister:function(e){this.context.registers[e]||(this.context.registers[e]=!0,this.context.registers.list.push(e))},pushStack:function(e){return this.source.push(this.nextStack()+" = "+e+";"),"stack"+this.stackSlot},nextStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),"stack"+this.stackSlot},popStack:function(){return"stack"+this.stackSlot--},topStack:function(){return"stack"+this.stackSlot},quotedString:function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"'}};for(var i="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),o=t.RESERVED_WORDS={},s=0,a=i.length;a>s;s++)o[i[s]]=!0;t.isValidJavaScriptVariableName=function(e){return!t.RESERVED_WORDS[e]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(e)?!0:!1}}(Handlebars.Compiler,Handlebars.JavaScriptCompiler),Handlebars.precompile=function(e,t){t=t||{};var n=Handlebars.parse(e),r=(new Handlebars.Compiler).compile(n,t);return(new Handlebars.JavaScriptCompiler).compile(r,t)},Handlebars.compile=function(e,t){function n(){var n=Handlebars.parse(e),r=(new Handlebars.Compiler).compile(n,t),i=(new Handlebars.JavaScriptCompiler).compile(r,t,void 0,!0);return Handlebars.template(i)}t=t||{};var r;return function(e,t){return r||(r=n()),r.call(this,e,t)}},Handlebars.VM={template:function(e){var t={escapeExpression:Handlebars.Utils.escapeExpression,invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(e,t,n){var r=this.programs[e];return n?Handlebars.VM.program(t,n):r?r:r=this.programs[e]=Handlebars.VM.program(t)},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop};return function(n,r){return r=r||{},e.call(t,Handlebars,n,r.helpers,r.partials,r.data)}},programWithDepth:function(e,t){var n=Array.prototype.slice.call(arguments,2);return function(r,i){return i=i||{},e.apply(this,[r,i.data||t].concat(n))}},program:function(e,t){return function(n,r){return r=r||{},e(n,r.data||t)}},noop:function(){return""},invokePartial:function(e,t,n,r,i,o){if(options={helpers:r,partials:i,data:o},void 0===e)throw new Handlebars.Exception("The partial "+t+" could not be found");if(e instanceof Function)return e(n,options);if(Handlebars.compile)return i[t]=Handlebars.compile(e),i[t](n,options);throw new Handlebars.Exception("The partial "+t+" could not be compiled when running in runtime-only mode")}},Handlebars.template=Handlebars.VM.template,Handlebars.registerHelper("foreach",function(e,t){var n,r="";if(e){if(e instanceof Array)for(var i=0,o=e.length;o>i;i++)r+=t.fn({key:i,index:i,value:e[i]});else if("object"==typeof e)for(n in e)e.hasOwnProperty(n)&&(r+=t.fn({key:n,value:e[n]}))}else r=t.inverse(this);return r}),Library.net=sumeru.Library.create(function(e){return e.get=function(e){var t=new window.XMLHttpRequest;t.onreadystatechange=function(){if(4==t.readyState){var n;t.status>=200&&t.status<300||0==t.status&&"file:"==protocol?(n=t.responseText,e.callback(n)):e.callback(t.responseText)}},t.open("GET",e.url,!0),t.send(e.query||"")},e}),SockJS=function(){var e=document,t=window,n={},r=function(){};r.prototype.addEventListener=function(e,t){this._listeners||(this._listeners={}),e in this._listeners||(this._listeners[e]=[]);var r=this._listeners[e];-1===n.arrIndexOf(r,t)&&r.push(t)},r.prototype.removeEventListener=function(e,t){if(this._listeners&&e in this._listeners){var r=this._listeners[e],i=n.arrIndexOf(r,t);return-1!==i?(r.length>1?this._listeners[e]=r.slice(0,i).concat(r.slice(i+1)):delete this._listeners[e],void 0):void 0}},r.prototype.dispatchEvent=function(e){var t=e.type,n=Array.prototype.slice.call(arguments,0);if(this["on"+t]&&this["on"+t].apply(this,n),this._listeners&&t in this._listeners)for(var r=0;r<this._listeners[t].length;r++)this._listeners[t][r].apply(this,n)};var i=function(e,t){if(this.type=e,"undefined"!=typeof t)for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n])};i.prototype.toString=function(){var e=[];for(var t in this)if(this.hasOwnProperty(t)){var n=this[t];"function"==typeof n&&(n="[function]"),e.push(t+"="+n)}return"SimpleEvent("+e.join(", ")+")"};var o=function(e){this.events=e||[]};o.prototype.emit=function(e){var t=this,r=Array.prototype.slice.call(arguments,1);!t.nuked&&t["on"+e]&&t["on"+e].apply(t,r),-1===n.arrIndexOf(t.events,e)&&n.log("Event "+JSON.stringify(e)+" not listed "+JSON.stringify(t.events)+" in "+t)},o.prototype.nuke=function(){var e=this;e.nuked=!0;for(var t=0;t<e.events.length;t++)delete e[e.events[t]]};var s="abcdefghijklmnopqrstuvwxyz0123456789_";n.random_string=function(e,t){t=t||s.length;var n,r=[];for(n=0;e>n;n++)r.push(s.substr(Math.floor(Math.random()*t),1));return r.join("")},n.random_number=function(e){return Math.floor(Math.random()*e)},n.random_number_string=function(e){var t=(""+(e-1)).length,r=Array(t+1).join("0");return(r+n.random_number(e)).slice(-t)},n.getOrigin=function(e){e+="/";var t=e.split("/").slice(0,3);return t.join("/")},n.isSameOriginUrl=function(e,n){return n||(n=t.location.href),e.split("/").slice(0,3).join("/")===n.split("/").slice(0,3).join("/")},n.getParentDomain=function(e){if(/^[0-9.]*$/.test(e))return e;if(/^\[/.test(e))return e;if(!/[.]/.test(e))return e;var t=e.split(".").slice(1);return t.join(".")},n.objectExtend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e};var a="_jp";n.polluteGlobalNamespace=function(){a in t||(t[a]={})},n.closeFrame=function(e,t){return"c"+JSON.stringify([e,t])},n.userSetCode=function(e){return 1e3===e||e>=3e3&&4999>=e},n.countRTO=function(e){var t;return t=e>100?3*e:e+200},n.log=function(){t.console&&console.log&&console.log.apply&&console.log.apply(console,arguments)},n.bind=function(e,t){return e.bind?e.bind(t):function(){return e.apply(t,arguments)}},n.flatUrl=function(e){return-1===e.indexOf("?")&&-1===e.indexOf("#")},n.amendUrl=function(t){var r=e.location;if(!t)throw new Error("Wrong url for SockJS");if(!n.flatUrl(t))throw new Error("Only basic urls are supported in SockJS");return 0===t.indexOf("//")&&(t=r.protocol+t),0===t.indexOf("/")&&(t=r.protocol+"//"+r.host+t),t=t.replace(/[/]+$/,"")},n.arrIndexOf=function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1},n.arrSkip=function(e,t){var r=n.arrIndexOf(e,t);if(-1===r)return e.slice();var i=e.slice(0,r);return i.concat(e.slice(r+1))},n.isArray=Array.isArray||function(e){return{}.toString.call(e).indexOf("Array")>=0},n.delay=function(e,t){return"function"==typeof e&&(t=e,e=0),setTimeout(t,e)};var u,l=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c={"\0":"\\u0000","":"\\u0001","":"\\u0002","":"\\u0003","":"\\u0004","":"\\u0005","":"\\u0006","":"\\u0007","\b":"\\b","	":"\\t","\n":"\\n","":"\\u000b","\f":"\\f","\r":"\\r","":"\\u000e","":"\\u000f","":"\\u0010","":"\\u0011","":"\\u0012","":"\\u0013","":"\\u0014","":"\\u0015","":"\\u0016","":"\\u0017","":"\\u0018","":"\\u0019","":"\\u001a","":"\\u001b","":"\\u001c","":"\\u001d","":"\\u001e","":"\\u001f",'"':'\\"',"\\":"\\\\","":"\\u007f","":"\\u0080","":"\\u0081","":"\\u0082","":"\\u0083","":"\\u0084","":"\\u0085","":"\\u0086","":"\\u0087","":"\\u0088","":"\\u0089","":"\\u008a","":"\\u008b","":"\\u008c","":"\\u008d","":"\\u008e","":"\\u008f","":"\\u0090","":"\\u0091","":"\\u0092","":"\\u0093","":"\\u0094","":"\\u0095","":"\\u0096","":"\\u0097","":"\\u0098","":"\\u0099","":"\\u009a","":"\\u009b","":"\\u009c","":"\\u009d","":"\\u009e","":"\\u009f","­":"\\u00ad","؀":"\\u0600","؁":"\\u0601","؂":"\\u0602","؃":"\\u0603","؄":"\\u0604","܏":"\\u070f","឴":"\\u17b4","឵":"\\u17b5","‌":"\\u200c","‍":"\\u200d","‎":"\\u200e","‏":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","‪":"\\u202a","‫":"\\u202b","‬":"\\u202c","‭":"\\u202d","‮":"\\u202e"," ":"\\u202f","⁠":"\\u2060","⁡":"\\u2061","⁢":"\\u2062","⁣":"\\u2063","⁤":"\\u2064","⁥":"\\u2065","⁦":"\\u2066","⁧":"\\u2067","⁨":"\\u2068","⁩":"\\u2069","⁪":"\\u206a","⁫":"\\u206b","⁬":"\\u206c","⁭":"\\u206d","⁮":"\\u206e","⁯":"\\u206f","﻿":"\\ufeff","￰":"\\ufff0","￱":"\\ufff1","￲":"\\ufff2","￳":"\\ufff3","￴":"\\ufff4","￵":"\\ufff5","￶":"\\ufff6","￷":"\\ufff7","￸":"\\ufff8","￹":"\\ufff9","￺":"\\ufffa","￻":"\\ufffb","￼":"\\ufffc","�":"\\ufffd","￾":"\\ufffe","￿":"\\uffff"},f=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,p=JSON&&JSON.stringify||function(e){return l.lastIndex=0,l.test(e)&&(e=e.replace(l,function(e){return c[e]})),'"'+e+'"'},d=function(e){var t,n={},r=[];for(t=0;65536>t;t++)r.push(String.fromCharCode(t));return e.lastIndex=0,r.join("").replace(e,function(e){return n[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,n};n.quote=function(e){var t=p(e);return f.lastIndex=0,f.test(t)?(u||(u=d(f)),t.replace(f,function(e){return u[e]})):t};var h=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];n.probeProtocols=function(){for(var e={},t=0;t<h.length;t++){var n=h[t];e[n]=T[n]&&T[n].enabled()}return e},n.detectProtocols=function(e,t,n){var r={},i=[];t||(t=h);for(var o=0;o<t.length;o++){var s=t[o];r[s]=e[s]}var a=function(e){var t=e.shift();r[t]?i.push(t):e.length>0&&a(e)};return n.websocket!==!1&&a(["websocket"]),r["xhr-streaming"]&&!n.null_origin?i.push("xhr-streaming"):!r["xdr-streaming"]||n.cookie_needed||n.null_origin?a(["iframe-eventsource","iframe-htmlfile"]):i.push("xdr-streaming"),r["xhr-polling"]&&!n.null_origin?i.push("xhr-polling"):!r["xdr-polling"]||n.cookie_needed||n.null_origin?a(["iframe-xhr-polling","jsonp-polling"]):i.push("xdr-polling"),i};var g="_sockjs_global";n.createHook=function(){var e="a"+n.random_string(8);if(!(g in t)){var r={};t[g]=function(e){return e in r||(r[e]={id:e,del:function(){delete r[e]}}),r[e]}}return t[g](e)},n.attachMessage=function(e){n.attachEvent("message",e)},n.attachEvent=function(n,r){"undefined"!=typeof t.addEventListener?t.addEventListener(n,r,!1):(e.attachEvent("on"+n,r),t.attachEvent("on"+n,r))},n.detachMessage=function(e){n.detachEvent("message",e)},n.detachEvent=function(n,r){"undefined"!=typeof t.addEventListener?t.removeEventListener(n,r,!1):(e.detachEvent("on"+n,r),t.detachEvent("on"+n,r))};var _={},m=!1,v=function(){for(var e in _)_[e](),delete _[e]},b=function(){m||(m=!0,v())};n.attachEvent("beforeunload",b),n.attachEvent("unload",b),n.unload_add=function(e){var t=n.random_string(8);return _[t]=e,m&&n.delay(v),t},n.unload_del=function(e){e in _&&delete _[e]},n.createIframe=function(t,r){var i,o,s=e.createElement("iframe"),a=function(){clearTimeout(i);try{s.onload=null}catch(e){}s.onerror=null},u=function(){s&&(a(),setTimeout(function(){s&&s.parentNode.removeChild(s),s=null},0),n.unload_del(o))},l=function(e){s&&(u(),r(e))},c=function(e,t){try{s&&s.contentWindow&&s.contentWindow.postMessage(e,t)}catch(n){}};return s.src=t,s.style.display="none",s.style.position="absolute",s.onerror=function(){l("onerror")},s.onload=function(){clearTimeout(i),i=setTimeout(function(){l("onload timeout")},2e3)},e.body.appendChild(s),i=setTimeout(function(){l("timeout")},15e3),o=n.unload_add(u),{post:c,cleanup:u,loaded:a}},n.createHtmlfile=function(e,r){var i,o,s,u=new ActiveXObject("htmlfile"),l=function(){clearTimeout(i)},c=function(){u&&(l(),n.unload_del(o),s.parentNode.removeChild(s),s=u=null,CollectGarbage())},f=function(e){u&&(c(),r(e))},p=function(e,t){try{s&&s.contentWindow&&s.contentWindow.postMessage(e,t)}catch(n){}};u.open(),u.write('<html><script>document.domain="'+document.domain+'";'+"</s"+"cript></html>"),u.close(),u.parentWindow[a]=t[a];var d=u.createElement("div");return u.body.appendChild(d),s=u.createElement("iframe"),d.appendChild(s),s.src=e,i=setTimeout(function(){f("timeout")},15e3),o=n.unload_add(c),{post:p,cleanup:c,loaded:l}};var y=function(){};y.prototype=new o(["chunk","finish"]),y.prototype._start=function(e,r,i,o){var s=this;try{s.xhr=new XMLHttpRequest}catch(a){}if(!s.xhr)try{s.xhr=new t.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}(t.ActiveXObject||t.XDomainRequest)&&(r+=(-1===r.indexOf("?")?"?":"&")+"t="+ +new Date),s.unload_ref=n.unload_add(function(){s._cleanup(!0)});try{s.xhr.open(e,r,!0)}catch(u){return s.emit("finish",0,""),s._cleanup(),void 0}if(o&&o.no_credentials||(s.xhr.withCredentials="true"),o&&o.headers)for(var l in o.headers)s.xhr.setRequestHeader(l,o.headers[l]);s.xhr.onreadystatechange=function(){if(s.xhr){var e=s.xhr;switch(e.readyState){case 3:try{var t=e.status,n=e.responseText}catch(e){}n&&n.length>0&&s.emit("chunk",t,n);break;case 4:s.emit("finish",e.status,e.responseText),s._cleanup(!1)}}},s.xhr.send(i)},y.prototype._cleanup=function(e){var t=this;if(t.xhr){if(n.unload_del(t.unload_ref),t.xhr.onreadystatechange=function(){},e)try{t.xhr.abort()}catch(r){}t.unload_ref=t.xhr=null}},y.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)};var S=n.XHRCorsObject=function(){var e=this,t=arguments;n.delay(function(){e._start.apply(e,t)})};S.prototype=new y;var w=n.XHRLocalObject=function(e,t,r){var i=this;n.delay(function(){i._start(e,t,r,{no_credentials:!0})})};w.prototype=new y;var E=n.XDRObject=function(e,t,r){var i=this;n.delay(function(){i._start(e,t,r)})};E.prototype=new o(["chunk","finish"]),E.prototype._start=function(e,t,r){var i=this,o=new XDomainRequest;t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +new Date;var s=o.ontimeout=o.onerror=function(){i.emit("finish",0,""),i._cleanup(!1)};o.onprogress=function(){i.emit("chunk",200,o.responseText)},o.onload=function(){i.emit("finish",200,o.responseText),i._cleanup(!1)},i.xdr=o,i.unload_ref=n.unload_add(function(){i._cleanup(!0)});try{i.xdr.open(e,t),i.xdr.send(r)}catch(a){s()}},E.prototype._cleanup=function(e){var t=this;if(t.xdr){if(n.unload_del(t.unload_ref),t.xdr.ontimeout=t.xdr.onerror=t.xdr.onprogress=t.xdr.onload=null,e)try{t.xdr.abort()}catch(r){}t.unload_ref=t.xdr=null}},E.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},n.isXHRCorsCapable=function(){return t.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:t.XDomainRequest&&e.domain?2:L.enabled()?3:4};var T=function(e,t,r){var i,o=this;o._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},r&&n.objectExtend(o._options,r),o._base_url=n.amendUrl(e),o._server=o._options.server||n.random_number_string(1e3),o._options.protocols_whitelist&&o._options.protocols_whitelist.length?i=o._options.protocols_whitelist:(i="string"==typeof t&&t.length>0?[t]:n.isArray(t)?t:null,i&&o._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.')),o._protocols=[],o.protocol=null,o.readyState=T.CONNECTING,o._ir=G(o._base_url),o._ir.onfinish=function(e,t){o._ir=null,e?(o._options.info&&(e=n.objectExtend(e,o._options.info)),o._options.rtt&&(t=o._options.rtt),o._applyInfo(e,t,i),o._didClose()):o._didClose(1002,"Can't connect to server",!0)}};T.prototype=new r,T.version="0.3.1",T.CONNECTING=0,T.OPEN=1,T.CLOSING=2,T.CLOSED=3,T.prototype._debug=function(){this._options.debug&&n.log.apply(n,arguments)},T.prototype._dispatchOpen=function(){var e=this;e.readyState===T.CONNECTING?(e._transport_tref&&(clearTimeout(e._transport_tref),e._transport_tref=null),e.readyState=T.OPEN,e.dispatchEvent(new i("open"))):e._didClose(1006,"Server lost session")},T.prototype._dispatchMessage=function(e){var t=this;t.readyState===T.OPEN&&t.dispatchEvent(new i("message",{data:e}))},T.prototype._dispatchHeartbeat=function(){var e=this;e.readyState===T.OPEN&&e.dispatchEvent(new i("heartbeat",{}))},T.prototype._didClose=function(e,t,r){var o=this;if(o.readyState!==T.CONNECTING&&o.readyState!==T.OPEN&&o.readyState!==T.CLOSING)throw new Error("INVALID_STATE_ERR");o._ir&&(o._ir.nuke(),o._ir=null),o._transport&&(o._transport.doCleanup(),o._transport=null);var s=new i("close",{code:e,reason:t,wasClean:n.userSetCode(e)});if(!n.userSetCode(e)&&o.readyState===T.CONNECTING&&!r){if(o._try_next_protocol(s))return;s=new i("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:s})}o.readyState=T.CLOSED,n.delay(function(){o.dispatchEvent(s)})},T.prototype._didMessage=function(e){var t=this,n=e.slice(0,1);switch(n){case"o":t._dispatchOpen();break;case"a":for(var r=JSON.parse(e.slice(1)||"[]"),i=0;i<r.length;i++)t._dispatchMessage(r[i]);break;case"m":var r=JSON.parse(e.slice(1)||"null");t._dispatchMessage(r);break;case"c":var r=JSON.parse(e.slice(1)||"[]");t._didClose(r[0],r[1]);break;case"h":t._dispatchHeartbeat()}},T.prototype._try_next_protocol=function(t){var r=this;for(r.protocol&&(r._debug("Closed transport:",r.protocol,""+t),r.protocol=null),r._transport_tref&&(clearTimeout(r._transport_tref),r._transport_tref=null);;){var i=r.protocol=r._protocols.shift();if(!i)return!1;if(T[i]&&T[i].need_body===!0&&(!e.body||"undefined"!=typeof e.readyState&&"complete"!==e.readyState))return r._protocols.unshift(i),r.protocol="waiting-for-load",n.attachEvent("load",function(){r._try_next_protocol()}),!0;if(T[i]&&T[i].enabled(r._options)){var o=T[i].roundTrips||1,s=(r._options.rto||0)*o||5e3;r._transport_tref=n.delay(s,function(){r.readyState===T.CONNECTING&&r._didClose(2007,"Transport timeouted")});var a=n.random_string(8),u=r._base_url+"/"+r._server+"/"+a;return r._debug("Opening transport:",i," url:"+u," RTO:"+r._options.rto),r._transport=new T[i](r,u,r._base_url),!0}r._debug("Skipping transport:",i)}},T.prototype.close=function(e,t){var r=this;if(e&&!n.userSetCode(e))throw new Error("INVALID_ACCESS_ERR");return r.readyState!==T.CONNECTING&&r.readyState!==T.OPEN?!1:(r.readyState=T.CLOSING,r._didClose(e||1e3,t||"Normal closure"),!0)},T.prototype.send=function(e){var t=this;if(t.readyState===T.CONNECTING)throw new Error("INVALID_STATE_ERR");return t.readyState===T.OPEN&&t._transport.doSend(n.quote(""+e)),!0},T.prototype._applyInfo=function(t,r,i){var o=this;o._options.info=t,o._options.rtt=r,o._options.rto=n.countRTO(r),o._options.info.null_origin=!e.domain;var s=n.probeProtocols();o._protocols=n.detectProtocols(s,i,t)};var k=T.websocket=function(e,r){var i=this,o=r+"/websocket";o="https"===o.slice(0,5)?"wss"+o.slice(5):"ws"+o.slice(4),i.ri=e,i.url=o;var s=t.WebSocket||t.MozWebSocket;i.ws=new s(i.url),i.ws.onmessage=function(e){i.ri._didMessage(e.data)},i.unload_ref=n.unload_add(function(){i.ws.close()}),i.ws.onclose=function(){i.ri._didMessage(n.closeFrame(1006,"WebSocket connection broken"))}};k.prototype.doSend=function(e){this.ws.send("["+e+"]")},k.prototype.doCleanup=function(){var e=this,t=e.ws;t&&(t.onmessage=t.onclose=null,t.close(),n.unload_del(e.unload_ref),e.unload_ref=e.ri=e.ws=null)},k.enabled=function(){return!!t.WebSocket||!!t.MozWebSocket},k.roundTrips=2;var M=function(){};M.prototype.send_constructor=function(e){var t=this;t.send_buffer=[],t.sender=e},M.prototype.doSend=function(e){var t=this;t.send_buffer.push(e),t.send_stop||t.send_schedule()},M.prototype.send_schedule_wait=function(){var e,t=this;t.send_stop=function(){t.send_stop=null,clearTimeout(e)},e=n.delay(25,function(){t.send_stop=null,t.send_schedule()})},M.prototype.send_schedule=function(){var e=this;if(e.send_buffer.length>0){var t="["+e.send_buffer.join(",")+"]";e.send_stop=e.sender(e.trans_url,t,function(){e.send_stop=null,e.send_schedule_wait()}),e.send_buffer=[]}},M.prototype.send_destructor=function(){var e=this;e._send_stop&&e._send_stop(),e._send_stop=null};var I=function(t,r,i){var o=this;if(!("_send_form"in o)){var s=o._send_form=e.createElement("form"),a=o._send_area=e.createElement("textarea");a.name="d",s.style.display="none",s.style.position="absolute",s.method="POST",s.enctype="application/x-www-form-urlencoded",s.acceptCharset="UTF-8",s.appendChild(a),e.body.appendChild(s)}var s=o._send_form,a=o._send_area,u="a"+n.random_string(8);s.target=u,s.action=t+"/jsonp_send?i="+u;var l;try{l=e.createElement('<iframe name="'+u+'">')}catch(c){l=e.createElement("iframe"),l.name=u}l.id=u,s.appendChild(l),l.style.display="none";try{a.value=r}catch(f){n.log("Your browser is seriously broken. Go home! "+f.message)}s.submit();var p=function(){l.onerror&&(l.onreadystatechange=l.onerror=l.onload=null,n.delay(500,function(){l.parentNode.removeChild(l),l=null}),a.value="",i())};return l.onerror=l.onload=p,l.onreadystatechange=function(){"complete"==l.readyState&&p()},p},C=function(e){return function(t,n,r){var i=new e("POST",t+"/xhr_send",n);
return i.onfinish=function(e){r(e)},function(e){r(0,e)}}},O=function(t,r){var i,o,s=e.createElement("script"),a=function(e){o&&(o.parentNode.removeChild(o),o=null),s&&(clearTimeout(i),s.parentNode.removeChild(s),s.onreadystatechange=s.onerror=s.onload=s.onclick=null,s=null,r(e),r=null)},u=!1,l=null;if(s.id="a"+n.random_string(8),s.src=t,s.type="text/javascript",s.charset="UTF-8",s.onerror=function(){l||(l=setTimeout(function(){u||a(n.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},s.onload=function(){a(n.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},s.onreadystatechange=function(){if(/loaded|closed/.test(s.readyState)){if(s&&s.htmlFor&&s.onclick){u=!0;try{s.onclick()}catch(e){}}s&&a(n.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},"undefined"==typeof s.async&&e.attachEvent)if(/opera/i.test(navigator.userAgent))o=e.createElement("script"),o.text="try{var a = document.getElementById('"+s.id+"'); if(a)a.onerror();}catch(x){};",s.async=o.async=!1;else{try{s.htmlFor=s.id,s.event="onclick"}catch(c){}s.async=!0}"undefined"!=typeof s.async&&(s.async=!0),i=setTimeout(function(){a(n.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var f=e.getElementsByTagName("head")[0];return f.insertBefore(s,f.firstChild),o&&f.insertBefore(o,f.firstChild),a},x=T["jsonp-polling"]=function(e,t){n.polluteGlobalNamespace();var r=this;r.ri=e,r.trans_url=t,r.send_constructor(I),r._schedule_recv()};x.prototype=new M,x.prototype._schedule_recv=function(){var e=this,t=function(t){e._recv_stop=null,t&&(e._is_closing||e.ri._didMessage(t)),e._is_closing||e._schedule_recv()};e._recv_stop=P(e.trans_url+"/jsonp",O,t)},x.enabled=function(){return!0},x.need_body=!0,x.prototype.doCleanup=function(){var e=this;e._is_closing=!0,e._recv_stop&&e._recv_stop(),e.ri=e._recv_stop=null,e.send_destructor()};var P=function(e,r,i){var o="a"+n.random_string(6),s=e+"?c="+escape(a+"."+o),u=function(e){delete t[a][o],i(e)},l=r(s,u);t[a][o]=l;var c=function(){t[a][o]&&t[a][o](n.closeFrame(1e3,"JSONP user aborted read"))};return c},N=function(){};N.prototype=new M,N.prototype.run=function(e,t,n,r,i){var o=this;o.ri=e,o.trans_url=t,o.send_constructor(C(i)),o.poll=new Q(e,r,t+n,i)},N.prototype.doCleanup=function(){var e=this;e.poll&&(e.poll.abort(),e.poll=null)};var R=T["xhr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",rt,n.XHRCorsObject)};R.prototype=new N,R.enabled=function(){return t.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},R.roundTrips=2,R.need_body=!0;var A=T["xdr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",rt,n.XDRObject)};A.prototype=new N,A.enabled=function(){return!!t.XDomainRequest},A.roundTrips=2;var D=T["xhr-polling"]=function(e,t){this.run(e,t,"/xhr",rt,n.XHRCorsObject)};D.prototype=new N,D.enabled=R.enabled,D.roundTrips=2;var B=T["xdr-polling"]=function(e,t){this.run(e,t,"/xhr",rt,n.XDRObject)};B.prototype=new N,B.enabled=A.enabled,B.roundTrips=2;var L=function(){};L.prototype.i_constructor=function(e,t,r){var i=this;i.ri=e,i.origin=n.getOrigin(r),i.base_url=r,i.trans_url=t;var o=r+"/iframe.html";i.ri._options.devel&&(o+="?t="+ +new Date),i.window_id=n.random_string(8),o+="#"+i.window_id,i.iframeObj=n.createIframe(o,function(e){i.ri._didClose(1006,"Unable to load an iframe ("+e+")")}),i.onmessage_cb=n.bind(i.onmessage,i),n.attachMessage(i.onmessage_cb)},L.prototype.doCleanup=function(){var e=this;if(e.iframeObj){n.detachMessage(e.onmessage_cb);try{e.iframeObj.iframe.contentWindow&&e.postMessage("c")}catch(t){}e.iframeObj.cleanup(),e.iframeObj=null,e.onmessage_cb=e.iframeObj=null}},L.prototype.onmessage=function(e){var t=this;if(e.origin===t.origin){var n=e.data.slice(0,8),r=e.data.slice(8,9),i=e.data.slice(9);if(n===t.window_id)switch(r){case"s":t.iframeObj.loaded(),t.postMessage("s",JSON.stringify([T.version,t.protocol,t.trans_url,t.base_url]));break;case"t":t.ri._didMessage(i)}}},L.prototype.postMessage=function(e,t){var n=this;n.iframeObj.post(n.window_id+e+(t||""),n.origin)},L.prototype.doSend=function(e){this.postMessage("m",e)},L.enabled=function(){var e=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof t.postMessage||"object"==typeof t.postMessage)&&!e};var U,H=function(e,r){parent!==t?parent.postMessage(U+e+(r||""),"*"):n.log("Can't postMessage, no parent window.",e,r)},j=function(){};j.prototype._didClose=function(e,t){H("t",n.closeFrame(e,t))},j.prototype._didMessage=function(e){H("t",e)},j.prototype._doSend=function(e){this._transport.doSend(e)},j.prototype._doCleanup=function(){this._transport.doCleanup()},n.parent_origin=void 0,T.bootstrap_iframe=function(){var r;U=e.location.hash.slice(1);var i=function(e){if(e.source===parent&&("undefined"==typeof n.parent_origin&&(n.parent_origin=e.origin),e.origin===n.parent_origin)){var i=e.data.slice(0,8),o=e.data.slice(8,9),s=e.data.slice(9);if(i===U)switch(o){case"s":var a=JSON.parse(s),u=a[0],l=a[1],c=a[2],f=a[3];if(u!==T.version&&n.log('Incompatibile SockJS! Main site uses: "'+u+'", the iframe:'+' "'+T.version+'".'),!n.flatUrl(c)||!n.flatUrl(f))return n.log("Only basic urls are supported in SockJS"),void 0;if(!n.isSameOriginUrl(c)||!n.isSameOriginUrl(f))return n.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([t.location.href,c,f])+")"),void 0;r=new j,r._transport=new j[l](r,c,f);break;case"m":r._doSend(s);break;case"c":r&&r._doCleanup(),r=null}}};n.attachMessage(i),H("s")};var F=function(e,t){var r=this;n.delay(function(){r.doXhr(e,t)})};F.prototype=new o(["finish"]),F.prototype.doXhr=function(e,t){var r=this,i=(new Date).getTime(),o=new t("GET",e+"/info"),s=n.delay(8e3,function(){o.ontimeout()});o.onfinish=function(e,t){if(clearTimeout(s),s=null,200===e){var n=(new Date).getTime()-i,o=JSON.parse(t);"object"!=typeof o&&(o={}),r.emit("finish",o,n)}else r.emit("finish")},o.ontimeout=function(){o.close(),r.emit("finish")}};var q=function(t){var r=this,i=function(){var e=new L;e.protocol="w-iframe-info-receiver";var n=function(t){if("string"==typeof t&&"m"===t.substr(0,1)){var n=JSON.parse(t.substr(1)),i=n[0],o=n[1];r.emit("finish",i,o)}else r.emit("finish");e.doCleanup(),e=null},i={_options:{},_didClose:n,_didMessage:n};e.i_constructor(i,t,t)};e.body?i():n.attachEvent("load",i)};q.prototype=new o(["finish"]);var $=function(){var e=this;n.delay(function(){e.emit("finish",{},2e3)})};$.prototype=new o(["finish"]);var G=function(e){if(n.isSameOriginUrl(e))return new F(e,n.XHRLocalObject);switch(n.isXHRCorsCapable()){case 1:return new F(e,n.XHRCorsObject);case 2:return new F(e,n.XDRObject);case 3:return new q(e);default:return new $}},V=j["w-iframe-info-receiver"]=function(e,t,r){var i=new F(r,n.XHRLocalObject);i.onfinish=function(t,n){e._didMessage("m"+JSON.stringify([t,n])),e._didClose()}};V.prototype.doCleanup=function(){};var W=T["iframe-eventsource"]=function(){var e=this;e.protocol="w-iframe-eventsource",e.i_constructor.apply(e,arguments)};W.prototype=new L,W.enabled=function(){return"EventSource"in t&&L.enabled()},W.need_body=!0,W.roundTrips=3;var K=j["w-iframe-eventsource"]=function(e,t){this.run(e,t,"/eventsource",Y,n.XHRLocalObject)};K.prototype=new N;var J=T["iframe-xhr-polling"]=function(){var e=this;e.protocol="w-iframe-xhr-polling",e.i_constructor.apply(e,arguments)};J.prototype=new L,J.enabled=function(){return t.XMLHttpRequest&&L.enabled()},J.need_body=!0,J.roundTrips=3;var z=j["w-iframe-xhr-polling"]=function(e,t){this.run(e,t,"/xhr",rt,n.XHRLocalObject)};z.prototype=new N;var X=T["iframe-htmlfile"]=function(){var e=this;e.protocol="w-iframe-htmlfile",e.i_constructor.apply(e,arguments)};X.prototype=new L,X.enabled=function(){return L.enabled()},X.need_body=!0,X.roundTrips=3;var Z=j["w-iframe-htmlfile"]=function(e,t){this.run(e,t,"/htmlfile",nt,n.XHRLocalObject)};Z.prototype=new N;var Q=function(e,t,n,r){var i=this;i.ri=e,i.Receiver=t,i.recv_url=n,i.AjaxObject=r,i._scheduleRecv()};Q.prototype._scheduleRecv=function(){var e=this,t=e.poll=new e.Receiver(e.recv_url,e.AjaxObject),n=0;t.onmessage=function(t){n+=1,e.ri._didMessage(t.data)},t.onclose=function(n){e.poll=t=t.onmessage=t.onclose=null,e.poll_is_closing||("permanent"===n.reason?e.ri._didClose(1006,"Polling error ("+n.reason+")"):e._scheduleRecv())}},Q.prototype.abort=function(){var e=this;e.poll_is_closing=!0,e.poll&&e.poll.abort()};var Y=function(e){var t=this,r=new EventSource(e);r.onmessage=function(e){t.dispatchEvent(new i("message",{data:unescape(e.data)}))},t.es_close=r.onerror=function(e,o){var s=o?"user":2!==r.readyState?"network":"permanent";t.es_close=r.onmessage=r.onerror=null,r.close(),r=null,n.delay(200,function(){t.dispatchEvent(new i("close",{reason:s}))})}};Y.prototype=new r,Y.prototype.abort=function(){var e=this;e.es_close&&e.es_close({},!0)};var et,tt=function(){if(void 0===et)if("ActiveXObject"in t)try{et=!!new ActiveXObject("htmlfile")}catch(e){}else et=!1;return et},nt=function(e){var r=this;n.polluteGlobalNamespace(),r.id="a"+n.random_string(6,26),e+=(-1===e.indexOf("?")?"?":"&")+"c="+escape(a+"."+r.id);var o,s=tt()?n.createHtmlfile:n.createIframe;t[a][r.id]={start:function(){o.loaded()},message:function(e){r.dispatchEvent(new i("message",{data:e}))},stop:function(){r.iframe_close({},"network")}},r.iframe_close=function(e,n){o.cleanup(),r.iframe_close=o=null,delete t[a][r.id],r.dispatchEvent(new i("close",{reason:n}))},o=s(e,function(){r.iframe_close({},"permanent")})};nt.prototype=new r,nt.prototype.abort=function(){var e=this;e.iframe_close&&e.iframe_close({},"user")};var rt=function(e,t){var n=this,r=0;n.xo=new t("POST",e,null),n.xo.onchunk=function(e,t){if(200===e)for(;;){var o=t.slice(r),s=o.indexOf("\n");if(-1===s)break;r+=s+1;var a=o.slice(0,s);n.dispatchEvent(new i("message",{data:a}))}},n.xo.onfinish=function(e,t){n.xo.onchunk(e,t),n.xo=null;var r=200===e?"network":"permanent";n.dispatchEvent(new i("close",{reason:r}))}};return rt.prototype=new r,rt.prototype.abort=function(){var e=this;e.xo&&(e.xo.close(),e.dispatchEvent(new i("close",{reason:"user"})),e.xo=null)},T.getUtils=function(){return n},T.getIframeTransport=function(){return L},T}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS}),Library.string=sumeru.Library.create(function(e){return e.trim=function(e){return e.replace(/^\s|\s$/g,"")},e.escapeRegex=function(e){return(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},e}),Library.screenUtils=sumeru.Library.create(function(e){return e.fullScreen=function(){function e(){var e=document.documentElement,t=(window.innerHeight,window.outerHeight);window.devicePixelRatio,e.style.height="100%",t>scrollHeight&&(e.style.height=t/window.devicePixelRatio+"px"),setTimeout(function(){window.scrollTo(0,1)},0)}window.addEventListener("load",function(){e()}),window.addEventListener("orientationchange",function(){document.documentElement.style.height="auto",e(),setTimeout(function(){e()},800)})},e}),Library.cookie=sumeru.Library.create(function(e){var t="",n=e.addCookie=function(e,t,n){var r=e+"="+escape(t);if(n>0){var i=new Date;i.setTime(i.getTime()+1e3*3600*n),r=r+"; expires="+i.toGMTString()}document.cookie=r};return e.getCookie=function(e){for(var n=document.cookie,r=n.split("; "),i=0;i<r.length;i++){var o=r[i].split("=");if(o[0]==e)return o[1]}return t},e.deleteCookie=function(e){n(e,t)},e});var touch=Library.touch=sumeru.Library.create(function(e){function t(e,t){var n=c.get(e,"_touchEv");n||(n=new d(e),c.set(e,"_touchEv",n)),n["on"+t]=function(n){f.trigger(e,t,n)}}function n(e){var t=c.get(e,"_touchEv");t&&(c.set(e,"_touchEv",null),t.tearDown())}var r=function(e){if(!e||"object"!==o(e)||e.nodeType||e===e.window)return!1;var t=Object.prototype.hasOwnProperty;if(e.constructor&&!t.call(e,"constructor")&&!t.call(e.constructor.prototype,"isPrototypeOf"))return!1;var n;for(n in e);return void 0===n||t.call(e,n)},i={};"Boolean Number String Function Array Date RegExp Object".split(" ").forEach(function(e){i["[object "+e+"]"]=e.toLowerCase()});var o=function(e){return null==e?"null":i[Object.prototype.toString.call(e)]||"object"},s=function(e){return"array"===o(e)},a=function(e){return"function"===o(e)},u=function(){var e,t,n,i,o,l,c=arguments[0]||{},f=1,p=arguments.length,d=!1;if("boolean"==typeof c&&(d=c,c=arguments[1]||{},f=2),"object"==typeof c||a(c)||(c={}),p===f)return c;for(;p>f;f++)if(null!=(e=arguments[f]))for(t in e)n=c[t],i=e[t],c!==i&&(d&&i&&(r(i)||(o=s(i)))?(o?(o=!1,l=n&&s(n)?n:[]):l=n&&r(n)?n:{},c[t]=u(d,l,i)):void 0!==i&&(c[t]=i));return c},l=function(){var e="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ",t=e.length-1;return{query:function(e){return document.querySelectorAll(e)},randomStr:function(n){var r="";n="undefined"==typeof n?8:n;for(var i=0;n>i;i++)r+=e[Math.floor(Math.random()*(t+1))];return r},getElUID:function(e){var t=e.getAttribute("data-uid");return t||(t=this.randomStr(18),e.setAttribute("data-uid",t)),t},addEvents:function(e,t,n){t=t?t.split(" "):[];for(var r=0,i=t.length;i>r;r++)e.addEventListener&&n&&e.addEventListener(t[r],n,!1)},removeEvents:function(e,t,n){t=t?t.split(" "):[];for(var r=0,i=t.length;i>r;r++)e.removeEventListener&&e.removeEventListener(t[r],n,!1)},deepCopy:function(e,t){return t||(t=e,e={}),u(!0,e,t),e}}}(),c=function(){var e={};return{get:function(t,n){var r=l.getElUID(t);return e[r]=e[r]||{},1===arguments.length?e[r]:e[r][n]},set:function(t,n,r){var i=l.getElUID(t);e[i]=e[i]||{},e[i][n]=r}}}(),f=function(){var e={},t={};return{trigger:function(n,r,i){for(var o=l.getElUID(n),s=e[o][r].handler,a=w,u=[a.SWIPE_START,a.SWIPING,a.SWIPE_END,a.SWIPE_LEFT,a.SWIPE_RIGHT,a.SWIPE_UP,a.SWIPE_DOWN,a.SWIPE],c=function(e,n,r,i){r&&r.interval?(t[e]=t[e]||{},t[e].list=t[e].list||[],t[e].list.push(function(e,t,n){return function(){e.call(t,n)}}(e,n,i)),t[e].interval||(t[e].interval=setInterval(function(e){return function(){var n=t[e].list.shift();n?n():(clearInterval(t[e].interval),t[e].interval=null)}}(e),r.interval))):e.call(n,i)},f=0,p=s.length;p>f;f++){var d=s[f].options;if(-1!=u.indexOf(r)&&d&&d.swipeFactor){var h=i.duration/1e3;i.factor=10*(10-d.swipeFactor)*h*h}if(d&&d.__binding_live){var g=i.originEvent.target,_=l.query(d.__binding_live);_&&_.length>0&&(_=Array.prototype.slice.apply(_,[0]),_.forEach(function(e){e.contains(g)&&c(s[f],e,d,i)}))}else c(s[f],n,d,i)}},off:function(){if("undefined"!=typeof arguments[0]){var t=l.getElUID(arguments[0]);if("string"==typeof arguments[3]){var n=[];try{n=e[t][arguments[1]].handler}catch(r){n=[]}if(arguments[2]){var i=n.indexOf(arguments[2]);if(i>-1){var o=n.splice(i,1);delete o.options}}else for(var s=0;s<n.length;s++){var a=n[s].options;if(a&&a.__binding_live&&a.__binding_live===arguments[3]){var o=n.splice(s,1);delete o.options,s--}}return!1}if(1==arguments.length)e[t]=null;else if(2===arguments.length)e[t]&&(e[t][arguments[1]]=null);else if(e[t]&&e[t][arguments[1]]&&e[t][arguments[1]].handler){var n=e[t][arguments[1]].handler,i=n.indexOf(arguments[2]);if(i>-1){var o=n.splice(i,1);delete o.options}}}},add:function(t,n,r,i){var o=l.getElUID(t);e[o]=e[o]||{},e[o][n]=e[o][n]||{},e[o][n].handler=e[o][n].handler||[],!i||(r.options=i),"function"==typeof r?e[o][n].handler.push(r):null},hasHandler:function(t,n){try{var r=l.getElUID(t),i=e[r][n].handler;return i&&i.length>0?!0:!1}catch(o){return!1}},isEmpty:function(t){var n=l.getElUID(t),r=e[n];for(var i in r)if(r[i]&&r[i].handler&&0!==r[i].handler.length)return!1;return!0}}}(),p={tap:!0,doubleTap:!0,tapMaxDistance:10,hold:!0,holdTime:650,maxDoubleTapInterval:300,swipe:!0,swipeTime:300,swipeMinDistance:18,swipeFactor:5,drag:!0,pinch:!0,minScaleRate:0,minRotationAngle:0},d=function(){function e(e){if(u){for(var t=[],n=null,r=0,i=e.touches.length;i>r;r++)n=e.touches[r],t.push({x:n.pageX,y:n.pageY});return t}return[{x:e.pageX,y:e.pageY}]}function t(e,t){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)}function n(e){return e.touches?e.touches.length:1}function r(e,n){if(e.length>=2&&n.length>=2){var r=t(e[1],e[0]),i=t(n[1],n[0]);return i/r}return 1}function i(e,t){return 180*Math.atan2(t.y-e.y,t.x-e.x)/Math.PI}function o(e,t){var n=Math.atan(-1*(t.y-e.y)/(t.x-e.x))*(180/Math.PI);return 0>n?n+180:n}function s(e){var t={up:-45>e&&e>-135,down:e>=45&&135>e,left:e>=135||-135>=e,right:e>=-45&&45>=e};for(var n in t)if(t[n])return n;return null}function a(e){for(var t=0,n=0;e.offsetParent;)t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;return{left:t,top:n}}var u="ontouchstart"in window;return function(c){function d(e,t){"function"==typeof v["on"+e]&&v["on"+e](t)}function h(){S=E=T=null,P=O=k=M=!1,I=!1,b={},R=!1}function g(e){return"touchmove"===e.type||"mousemove"===e.type}function _(e){return"touchend"===e.type||"mouseup"===e.type||"touchcancel"===e.type}function m(e,t,n,r){f.hasHandler(e,t)&&(r="undefind"==typeof r?!0:r,r&&(n=l.deepCopy(n)),n.type=t,n.startRotate=function(){v.startRotate()},d(t,n))}var v=this,b={start:null,move:null,end:null},y=0,S=null,E=null,T=null,k=!1,M=!1,I=!1,C={},O=!1,x=null,P=!1,N=1,R=!1,A=[],D=0,B=0,L=0,U=null,H={_getAngleDiff:function(e){for(var t=parseInt(D-o(e[0],e[1]),10),n=0;Math.abs(t-B)>90&&n++<50;)0>B?t-=180:t+=180;return B=parseInt(t,10)},pinch:function(e){if(p.pinch){if(!O)return;if(n(e)<2&&!_(e))return;var t=r(b.start,b.move),i=this._getAngleDiff(b.move),o={type:"",originEvent:e,scale:t,rotation:i,direction:i>0?"right":"left",fingersCount:n(e),startRotate:function(){v.startRotate()}};if(M?g(e)?o.fingerStatus="move":_(e)&&(o.fingerStatus="end",m(c,w.PINCH_END,o)):(M=!0,o.fingerStatus="start",m(c,w.PINCH_START,o)),m(c,w.PINCH,o),Math.abs(1-t)>p.minScaleRate){var s=l.deepCopy(o),a=1e-11;t>N?(N=t-a,m(c,w.PINCH_OUT,s,!1)):N>t&&(N=t+a,m(c,w.PINCH_IN,s,!1)),_(e)&&(N=1)}if(Math.abs(i)>p.minRotationAngle){var u,f=l.deepCopy(o);u=i>0?w.ROTATION_RIGHT:w.ROTATION_LEFT,m(c,u,f,!1),m(c,w.ROTATION,o)}}},rotateSingleFinger:function(e){if(R&&n(e)<2){if(!b.move)return;if(A.length<2){var t=a(c);A=[{x:t.left+c.offsetWidth/2,y:t.top+c.offsetHeight/2},b.move[0]],D=parseInt(o(A[0],A[1]),10)}var r=[A[0],b.move[0]],i=this._getAngleDiff(r),s={type:"",originEvent:e,rotation:i,direction:i>0?"right":"left",fingersCount:n(e)};g(e)?s.fingerStatus="move":(_(e)||"mouseout"===e.type)&&(s.fingerStatus="end",m(c,w.PINCH_END,s)),eventType=i>0?w.ROTATION_RIGHT:w.ROTATION_LEFT,m(c,eventType,s),m(c,w.ROTATION,s)}},swipe:function(e){if(O&&b.move&&!(n(e)>1)){var r=Date.now(),o=r-y,a=t(b.start[0],b.move[0]),u={x:b.move[0].x-C.left,y:b.move[0].y-C.top},l=i(b.start[0],b.move[0]),f=s(l),d=o/1e3,h=10*(10-p.swipeFactor)*d*d,v={type:w.SWIPE,originEvent:e,position:u,direction:f,distance:a,distanceX:b.move[0].x-b.start[0].x,distanceY:b.move[0].y-b.start[0].y,angle:l,duration:o,fingersCount:n(e),factor:h};if(p.swipe){var S=function(){var e=w;switch(f){case"up":m(c,e.SWIPE_UP,v);break;case"down":m(c,e.SWIPE_DOWN,v);break;case"left":m(c,e.SWIPE_LEFT,v);break;case"right":m(c,e.SWIPE_RIGHT,v)}};k?g(e)?(v.fingerStatus=v.swipe="move",m(c,w.SWIPING,v),o>p.swipeTime&&o<p.swipeTime+50&&a>p.swipeMinDistance&&(S(),m(c,w.SWIPE,v,!1))):(_(e)||"mouseout"===e.type)&&(v.fingerStatus=v.swipe="end",m(c,w.SWIPE_END,v),p.swipeTime>o&&a>p.swipeMinDistance&&(S(),m(c,w.SWIPE,v,!1))):(v.fingerStatus=v.swipe="start",k=!0,m(c,w.SWIPE_START,v))}p.drag&&(I?g(e)?v.fingerStatus=v.swipe="move":_(e)&&(v.fingerStatus=v.swipe="end"):(v.fingerStatus=v.swipe="start",I=!0),m(c,w.DRAG,v))}},tap:function(e){if(p.tap){var r=f,i=Date.now(),o=i-y,s=t(b.start[0],b.move?b.move[0]:b.start[0]);clearTimeout(x);var a=function(){if(U&&p.doubleTap&&y-L<p.maxDoubleTapInterval){var e=t(U,b.start[0]);if(16>e)return!0}return!1}();if(a)return d(w.DOUBLE_TAP,{type:w.DOUBLE_TAP,originEvent:e,position:b.start[0]}),void 0;if(p.tapMaxDistance<s)return;p.holdTime>o&&n(e)<=1&&(P=!0,L=i,U=b.start[0],r.hasHandler(c,w.TAP)&&d(w.TAP,{type:w.TAP,originEvent:e,fingersCount:n(e),position:b.start[0]}),r.hasHandler(c,w.CLICK)&&d(w.CLICK,{type:w.CLICK,originEvent:e,fingersCount:n(e),position:b.start[0]}))}},hold:function(e){p.hold&&(clearTimeout(x),x=setTimeout(function(){if(b.start){var r=t(b.start[0],b.move?b.move[0]:b.start[0]);p.tapMaxDistance<r||P||d("hold",{type:"hold",originEvent:e,fingersCount:n(e),position:b.start[0]})}},p.holdTime))}},j=function(t){switch(t.type){case"touchstart":case"mousedown":R=!1,A=[],m(c,t.type,{originEvent:t}),O=!0,(!b.start||b.start.length<2)&&(b.start=e(t)),n(t)>=2&&(D=parseInt(o(b.start[0],b.start[1]),10)),y=Date.now(),S=t,C={};var r=c.getBoundingClientRect(),i=document.documentElement;C={top:r.top+(window.pageYOffset||i.scrollTop)-(i.clientTop||0),left:r.left+(window.pageXOffset||i.scrollLeft)-(i.clientLeft||0)},H.hold(t);break;case"touchmove":case"mousemove":if(m(c,t.type,{originEvent:t}),!O||!b.start)return;b.move=e(t),n(t)>=2?H.pinch(t):(R&&H.rotateSingleFinger(t),H.swipe(t));break;case"touchend":case"touchcancel":case"mouseup":case"mouseout":if(m(c,t.type,{originEvent:t}),!O)return;T=t,M?H.pinch(t):(R&&H.rotateSingleFinger(t),k&&H.swipe(t)),H.tap(t),h(),D=0,B=0,t.touches&&1===t.touches.length&&(O=!0,R=!0)}},F=u?"touchstart touchmove touchend touchcancel":"mouseup mousedown mousemove mouseout";l.addEvents(c,F,j),this.tearDown=function(){l.removeEvents(c,F,j)},this.startRotate=function(){R=!0}}}(),h=function(){if(typeof arguments.length<3)throw"Please specify complete argments";var e="string"==typeof arguments[0]?l.query(arguments[0]):[arguments[0]],t=arguments[1].split(" "),n=arguments[arguments.length-1],r=arguments.length>3?arguments[arguments.length-2]:void 0;e=Array.prototype.slice.apply(e,[0]),e.forEach(function(e){for(var i=0;i<t.length;i++){var o=b(t[i]);E.special[o]?(f.add(e,o,n,r),E.special[o].setUp.apply(this,[e,o])):l.addEvents(e,o,n)}})},g=function(){if(arguments.length<3)throw new Error("wrong argument");if("string"!=typeof arguments[0])return h.apply(e,arguments),void 0;var t=arguments.length>3?arguments[arguments.length-2]:{},n=arguments[1],r=arguments[arguments.length-1];t.__binding_live=arguments[0],h.apply(e,[document.body,n,t,r])},_=function(e,t,n,r){if("undefined"==typeof e)throw"Please specify the selector.";e="string"==typeof e?l.query(e):[e],e=Array.prototype.slice.apply(e,[0]),t?(t=t.split(" "),e.forEach(function(e){t.forEach(function(t){var i=[e,b(t)];n?i.push(n):null,r?i.push(r):null,E.special[t]?(f.off.apply(f,i),f.isEmpty(e,t)&&E.special[t].tearDown(e)):l.removeEvents.apply(this,i)})})):(f.off(e),l.removeEvents(e))},m=function(e,t,n){_(document.body,t,n,e)},v={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"},b=function(e){return"ontouchstart"in window||!v[e]?e:v[e]},y=function(e){"object"==typeof e&&(p=u(p,e))},S={setUp:t,tearDown:n},w={TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",TOUCH_CANCEL:"touchcancel",MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",MOUSE_UP:"mouseup",CLICK:"click",PINCH_START:"pinchstart",PINCH_END:"pinchend",PINCH:"pinch",PINCH_IN:"pinchin",PINCH_OUT:"pinchout",ROTATION_LEFT:"rotateleft",ROTATION_RIGHT:"rotateright",ROTATION:"rotate",SWIPE_START:"swipestart",SWIPING:"swiping",SWIPE_END:"swipeend",SWIPE_LEFT:"swipeleft",SWIPE_RIGHT:"swiperight",SWIPE_UP:"swipeup",SWIPE_DOWN:"swipedown",SWIPE:"swipe",DRAG:"drag",HOLD:"hold",TAP:"tap",DOUBLE_TAP:"doubletap"},E={};return E.special={},Object.keys(w).forEach(function(e){E.special[w[e]]=S}),e.live=g,e.die=m,e.on=h,e.off=_,e.config=y,e});!function(){Library.domUtils=sumeru.Library.create(function(e){e.on=function(e,t,n){e&&t&&n&&(0==t.indexOf("on")&&(t=t.substr(2)),e.addEventListener(t,n))},e.hasClass=function(e,t){if(""==e.className)return!1;if(e.classList&&e.classList.contains)return e.classList.contains(t);var n=e.className.split(" ");return-1!==n.indexOf(t)}})}();var runnable=function(e){Library.asyncCallbackHandler=e.Library.create(function(e){var t=function(e,t){this.counter=0,this.callbacked=!1,this.callback=function(){this.callbacked||(e(),this.callbacked=!0)},this._enableCallback=!1,t&&(this.timeout=t),this.timeoutFunc=null};return t.prototype={add:function(){this.counter++},decrease:function(){this.counter--,this._enableCallback&&0===this.counter&&this.callback()},enableCallback:function(){this._enableCallback=!0,this.timeout&&(this.timeoutFunc=setTimeout(function(e){e.callback()}(this),this.timeout)),this._enableCallback&&0===this.counter&&this.callback()}},e.create=function(e,n){return new t(e,n)},e})};"undefined"!=typeof module&&module.exports?module.exports=runnable:runnable(sumeru),Model=Model||{},Model.smrAuthModel=function(e){e.config={fields:[{name:"token",type:"string"},{name:"password",type:"string"},{name:"sessionId",type:"string"},{name:"info",type:"object"},{name:"status",type:"string",defaultValue:"0"},{name:"clientId",type:"string"},{name:"secretKey",type:"string"},{name:"passportType",type:"string",defaultValue:"local"},{name:"vCodeStr",type:"string"},{name:"verifyCode",type:"string"}]}},Model.smrLoginModel=function(e){e.config={fields:[{name:"clientId",type:"string"},{name:"token",type:"string"},{name:"sessionId",type:"string"},{name:"time",type:"string"},{name:"userId",type:"string"},{name:"lastRequestTime",type:"string"},{name:"isLogin",type:"string",defaultValue:"1"},{name:"info",type:"object"},{name:"expires",type:"int"}]}},function(e){var t=e.addSubPackage("auth");t.addSubPackage("tpa"),t.addSubPackage("baidu");var n=!1,r=!1,i=[],o={},s={},a=175200,u=new e.pubsub._pubsubObject;o.LOGOUT="0",o.LOGIN="1",o.LOGIN_UNKNOW="2",o.LOGIN_TIMEOUT="3",o.LOGIN_PASSWORD_UPDATE="4",o.LOGIN_VERIFY_CODE="5",o.UPSERT_SUCC="10",o.UPSERT_FAIL="11",o.UPSERT_REPEAT="12",s.local="LOCAL",s.baidu="BAIDU",s.tpa="tpa";var l=e.model.create("Model.smrAuthModel"),c="http://passport.baidu.com/cgi-bin/genimage?",f=function(e){var t=this,s=Library.cookie,c=s.getCookie("sessionId"),f=s.getCookie("clientId"),p=s.getCookie("passportType");c||l.set("status",o.LOGOUT),f&&l.set("clientId",f),u.subscribe("auth-init",c,f,p,function(s){var u=s.get(0);c&&c===u.get("sessionId")&&(l.set("status",o.LOGIN),l.set("token",u.get("token")),l.set("info",u.get("info")),l.set("passportType",u.get("passportType")),n=!0),f||Library.cookie.addCookie("clientId",u.get("clientId"),a),i&&i.length>0&&i.forEach(function(e){e()}),r=!0,e&&e.call(t,l.get("status"))})},p=function(e,t){var r=o.LOGOUT;if(e.length>0){var i=e.get(0);r=i.get("status"),l.set("status",r),sumeru.model._extend(l,i),r===o.LOGIN&&(n=!0,Library.cookie.addCookie("sessionId",i.get("sessionId"),a),Library.cookie.addCookie("passportType",i.get("passportType"),a)),i.get("passportType")===s.baidu&&l.set("verifyCode",c+i.get("vCodeStr"))}t&&t.call(this,{success:r===o.LOGIN,status:r})},d=function(){if(0===arguments.length)throw"Please specified local token or password.";var t,n,r,i,o=Library.cookie.getCookie("clientId");if(1===arguments.length&&"object"==typeof arguments[0]){var s=arguments[0];t=s.token,n=s.password,i=s.callback,r=s.expires}else t=arguments[0],n=arguments[1],arguments.length<=3?i=arguments[2]:(r=arguments[2],i=arguments[3]);u.prioritySubscribe("auth-login",t,n,o,r,function(t){p.call(e.auth,t,i)})},h=function(){if(0===arguments.length)throw"Please specify the token or password with baidu account";var t,n,r,i,o,s;if(t=Library.cookie.getCookie("clientId"),1===arguments.length&&"object"==typeof arguments[0]){var a=arguments[0];n=a.token,r=a.password,s=a.callback,o=a.expires,i=a.verifyCode}else n=arguments[0],r=arguments[1],3===arguments.length?s=arguments[2]:arguments.length>3&&(i=arguments[2],s=arguments[3]);u.prioritySubscribe("auth-login-baidu",t,n,r,l.get("vCodeStr"),i,o,function(t){p.call(e.auth,t,s)})},g=function(){var t,n,r,i,o=Library.cookie.getCookie("clientId");if(arguments.length<2)throw"Please specify the token or password with baidu account";t=arguments[0],n=arguments[1],3===arguments.length?(r="",i=arguments[2]):arguments.length>3&&(r=arguments[2],i=arguments[3]),u.prioritySubscribe("other-login",t,n,r,o,function(t){p.call(e.auth,t,i)})},_=function(t,n,r,i){var s=Library.cookie.getCookie("clientId");u.subscribe("auth-register",t,n,r,s,function(t){var n=t.get(0),r=n.get("status");i.call(e.auth,{success:r===o.UPSERT_SUCC,status:r})})},m=function(t,r){if(n){var i=Library.cookie.getCookie("clientId"),s=Library.cookie.getCookie("sessionId");u.subscribe("auth-update",s,i,t,function(t){var n=t.get(0),i=n.get("status");r.call(e.auth,{success:i===o.UPSERT_SUCC,status:i})})}},v=function(e,t,n,r){_(e,t,n,r)},b=function(t){var n=Library.cookie.getCookie("sessionId"),r=Library.cookie.getCookie("clientId");u.subscribe("auth-logout",n,r,function(n){var r=n.get(0);r.status===o.LOGOUT&&(l.status=o.LOGOUT,l.sessionId="",Library.cookie.deleteCookie("sessionId")),t&&t.call(e.auth,{success:r.status===o.LOGOUT,status:r.status})})},y=function(e){var t=this;return r?e&&e.call(this,l.get("status")):e&&i.push(function(){e.call(t,l.get("status"))}),l.get("status")===o.LOGIN},S=function(){return n?l.get("token"):""},w=function(){return sumeru.model._extend(sumeru.model.create("Model.smrAuthModel"),l)},E=function(){var e=l.get("status");return e===o.LOGIN_VERIFY_CODE?l.get("verifyCode"):null};e.auth.__reg("init",f,"private"),e.auth.__reg("login",d),e.auth.__reg("logout",b),e.auth.__reg("register",v),e.auth.__reg("update",m),e.auth.__reg("getToken",S),e.auth.__reg("getModel",w),e.auth.__reg("isLogin",y),e.auth.__reg("getVerifyCode",E),e.auth.tpa.__reg("login",g),e.auth.baidu.__reg("login",h)}(sumeru);